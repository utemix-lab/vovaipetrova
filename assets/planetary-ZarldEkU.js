import{i as Pa,j as Ga,k as Oa,U as Ia,l as Ba,M as ft,g as Tt,C as lt,e as ze,m as Na,V as Vt,n as za,o as Wa,p as ra,q as ja,T as Va,r as En,s as Ha,t as Dn,u as Xa,v as Ht,G as pr,S as Ya,O as Ka,_ as Ja,A as Qa,D as qa,R as Za,B as na,w as Rn,a as aa,b as $a,h as eo,x as to,y as ro,z as no,H as ao,J as oo,d as io,Q as Ln}from"./3d-force-graph-Qkr9Kv2e.js";import{V as je}from"./config-C8ziI3q8.js";import{l as so,G as Pn}from"./loadGraphConfig-g9rs-1sD.js";function gr(l){let r=0;const c={x:0,y:0,z:0};if(l.forEach(a=>{c.x+=a.x,c.y+=a.y,c.z+=a.z,r+=1}),!r)return l;const f=c.x/r,t=c.y/r,e=c.z/r;return l.forEach(a=>{a.x-=f,a.y-=t,a.z-=e}),l}function lo(l){const r=new Map,c=Array.from(new Set(l.map(o=>o.group).filter(Boolean))),f=c.length?c:["layer"],t=90,e=18,a=new Map;return f.forEach(o=>a.set(o,[])),l.forEach(o=>{const n=a.has(o.group)?o.group:f[0];a.get(n).push(o)}),f.forEach((o,n)=>{const i=a.get(o)||[];i.sort((s,u)=>(u.importance||0)-(s.importance||0)),i.forEach((s,u)=>{const h=(n-(f.length-1)/2)*t,d=(u-(i.length-1)/2)*e;r.set(s.id,{x:h,y:d,z:0})})}),l.forEach(o=>{r.has(o.id)||r.set(o.id,{x:0,y:0,z:0})}),gr(r)}function fo(l){const r=new Map,c=48,f=14,t=.55;return l.forEach((e,a)=>{const o=Math.floor(a/2),n=a%2,i=o*t+(n?Math.PI:0),s=Math.cos(i)*c,u=Math.sin(i)*c,h=(o-l.length/4)*f;r.set(e.id,{x:s,y:h,z:u})}),gr(r)}function co(l){const r=new Map,c=Array.from(new Set(l.map(o=>o.group).filter(Boolean))),f=c.length?c:["line"],t=70,e=22,a=new Map;return f.forEach(o=>a.set(o,[])),l.forEach(o=>{const n=a.has(o.group)?o.group:f[0];a.get(n).push(o)}),f.forEach((o,n)=>{const i=a.get(o)||[];i.sort((s,u)=>(u.importance||0)-(s.importance||0)),i.forEach((s,u)=>{const h=(n-(f.length-1)/2)*t,d=(u-(i.length-1)/2)*e;r.set(s.id,{x:h,y:d,z:0})})}),gr(r)}function uo(l){const r=new Map,c=26,f=Math.ceil(Math.cbrt(l.length));return l.forEach((t,e)=>{const a=e%f,o=Math.floor(e/f)%f,n=Math.floor(e/(f*f)),i=(a-(f-1)/2)*c,s=(o-(f-1)/2)*c,u=(n-(f-1)/2)*c;r.set(t.id,{x:i,y:s,z:u})}),gr(r)}function ho(l){const r=new Map;return l.forEach(c=>{r.set(c.id,{x:c.x??0,y:c.y??0,z:c.z??0})}),r}const po=Math.PI*2;function vo(l){let r=0;for(let c=0;c<l.length;c+=1)r=r*31+l.charCodeAt(c)|0;return Math.abs(r)}function zr(l){return vo(l)%1e3/1e3}function oa(l,r){const c=new Map(l.map(f=>[f.id,new Set]));return r.forEach(f=>{const t=typeof f.source=="object"?f.source.id:f.source,e=typeof f.target=="object"?f.target.id:f.target;c.has(t)||c.set(t,new Set),c.has(e)||c.set(e,new Set),c.get(t).add(e),c.get(e).add(t)}),c}function go(l,r){const c=oa(l,r);let f=l[0],t=-1/0;return l.forEach(e=>{const a=c.get(e.id)?.size||0,o=e.importance||0,n=a*1.2+o*2;n>t&&(t=n,f=e)}),f?.id}function ia(l,r,c={}){const f=c.hubId||go(l,r),t=oa(l,r),e=c.maxDepth??4,a=Math.min(c.ringCount??8,12),o=c.baseRadius??42,n=c.ringSpacing??22,i=Array.from({length:a+1},(v,g)=>o+g*n),s=new Map,u=[];for(s.set(f,0),u.push(f);u.length;){const v=u.shift(),g=s.get(v);if(g>=e)continue;const m=t.get(v);m&&m.forEach(E=>{s.has(E)||(s.set(E,g+1),u.push(E))})}const h=new Map,d=new Map;return l.forEach(v=>{if(v.id===f){h.set(v.id,{ring:0,radius:0,speed:0,phase:0,incline:0}),d.set(v.id,{x:0,y:0,z:0});return}const g=s.get(v.id)??e+1,m=Math.min(a,Math.max(1,g)),E=i[m],x=zr(`${v.id}:phase`)*po,_=25e-5+m*5e-5+zr(`${v.id}:speed`)*12e-5,w=(zr(`${v.id}:incline`)-.5)*.6;h.set(v.id,{ring:m,radius:E,speed:_,phase:x,incline:w}),d.set(v.id,{x:E*Math.cos(x),y:E*.2,z:E*Math.sin(x)})}),{hubId:f,ringCount:a,ringRadii:i,orbitData:h,positions:d}}function mo(l,r,c){const f=r.orbitData.get(l);if(!f)return{x:0,y:0,z:0};if(f.ring===0)return{x:0,y:0,z:0};const t=c*f.speed+f.phase,e=f.radius*Math.cos(t),a=f.radius*Math.sin(t),o=Math.sin(t)*f.radius*f.incline;return{x:e,y:o,z:a}}function yo(l){return l<.5?4*l*l*l:1-Math.pow(-2*l+2,3)/2}function bo(l,r,c){return{fromPositions:l,toPositions:r,t0:performance.now(),duration:c}}function xo(l,r,c){const f=r-l.t0,t=Math.min(1,Math.max(0,f/l.duration)),e=yo(t);return l.toPositions.forEach((a,o)=>{const n=l.fromPositions.get(o)||{x:0,y:0,z:0};c.set(o,{x:n.x+(a.x-n.x)*e,y:n.y+(a.y-n.y)*e,z:n.z+(a.z-n.z)*e})}),{progress:t,done:t>=1}}function wo(){var l=Object.create(null);function r(t,e){var a=t.id,o=t.name,n=t.dependencies;n===void 0&&(n=[]);var i=t.init;i===void 0&&(i=function(){});var s=t.getTransferables;if(s===void 0&&(s=null),!l[a])try{n=n.map(function(h){return h&&h.isWorkerModule&&(r(h,function(d){if(d instanceof Error)throw d}),h=l[h.id].value),h}),i=f("<"+o+">.init",i),s&&(s=f("<"+o+">.getTransferables",s));var u=null;typeof i=="function"?u=i.apply(void 0,n):console.error("worker module init function failed to rehydrate"),l[a]={id:a,value:u,getTransferables:s},e(u)}catch(h){h&&h.noLog||console.error(h),e(h)}}function c(t,e){var a,o=t.id,n=t.args;(!l[o]||typeof l[o].value!="function")&&e(new Error("Worker module "+o+": not found or its 'init' did not return a function"));try{var i=(a=l[o]).value.apply(a,n);i&&typeof i.then=="function"?i.then(s,function(u){return e(u instanceof Error?u:new Error(""+u))}):s(i)}catch(u){e(u)}function s(u){try{var h=l[o].getTransferables&&l[o].getTransferables(u);(!h||!Array.isArray(h)||!h.length)&&(h=void 0),e(u,h)}catch(d){console.error(d),e(d)}}}function f(t,e){var a=void 0;self.troikaDefine=function(n){return a=n};var o=URL.createObjectURL(new Blob(["/** "+t.replace(/\*/g,"")+` **/

troikaDefine(
`+e+`
)`],{type:"application/javascript"}));try{importScripts(o)}catch(n){console.error(n)}return URL.revokeObjectURL(o),delete self.troikaDefine,a}self.addEventListener("message",function(t){var e=t.data,a=e.messageId,o=e.action,n=e.data;try{o==="registerModule"&&r(n,function(i){i instanceof Error?postMessage({messageId:a,success:!1,error:i.message}):postMessage({messageId:a,success:!0,result:{isCallable:typeof i=="function"}})}),o==="callModule"&&c(n,function(i,s){i instanceof Error?postMessage({messageId:a,success:!1,error:i.message}):postMessage({messageId:a,success:!0,result:i},s||void 0)})}catch(i){postMessage({messageId:a,success:!1,error:i.stack})}})}function So(l){var r=function(){for(var c=[],f=arguments.length;f--;)c[f]=arguments[f];return r._getInitResult().then(function(t){if(typeof t=="function")return t.apply(void 0,c);throw new Error("Worker module function was called but `init` did not return a callable function")})};return r._getInitResult=function(){var c=l.dependencies,f=l.init;c=Array.isArray(c)?c.map(function(e){return e&&(e=e.onMainThread||e,e._getInitResult&&(e=e._getInitResult())),e}):[];var t=Promise.all(c).then(function(e){return f.apply(null,e)});return r._getInitResult=function(){return t},t},r}var sa=function(){var l=!1;if(typeof window<"u"&&typeof window.document<"u")try{var r=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));r.terminate(),l=!0}catch(c){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+c.message+"]")}return sa=function(){return l},l},Uo=0,_o=0,Wr=!1,zt=Object.create(null),Wt=Object.create(null),Yr=Object.create(null);function At(l){if((!l||typeof l.init!="function")&&!Wr)throw new Error("requires `options.init` function");var r=l.dependencies,c=l.init,f=l.getTransferables,t=l.workerId,e=So(l);t==null&&(t="#default");var a="workerModule"+ ++Uo,o=l.name||a,n=null;r=r&&r.map(function(s){return typeof s=="function"&&!s.workerModuleData&&(Wr=!0,s=At({workerId:t,name:"<"+o+"> function dependency: "+s.name,init:`function(){return (
`+ur(s)+`
)}`}),Wr=!1),s&&s.workerModuleData&&(s=s.workerModuleData),s});function i(){for(var s=[],u=arguments.length;u--;)s[u]=arguments[u];if(!sa())return e.apply(void 0,s);if(!n){n=Gn(t,"registerModule",i.workerModuleData);var h=function(){n=null,Wt[t].delete(h)};(Wt[t]||(Wt[t]=new Set)).add(h)}return n.then(function(d){var v=d.isCallable;if(v)return Gn(t,"callModule",{id:a,args:s});throw new Error("Worker module function was called but `init` did not return a callable function")})}return i.workerModuleData={isWorkerModule:!0,id:a,name:o,dependencies:r,init:ur(c),getTransferables:f&&ur(f)},i.onMainThread=e,i}function To(l){Wt[l]&&Wt[l].forEach(function(r){r()}),zt[l]&&(zt[l].terminate(),delete zt[l])}function ur(l){var r=l.toString();return!/^function/.test(r)&&/^\w+\s*\(/.test(r)&&(r="function "+r),r}function ko(l){var r=zt[l];if(!r){var c=ur(wo);r=zt[l]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+l.replace(/\*/g,"")+` **/

;(`+c+")()"],{type:"application/javascript"}))),r.onmessage=function(f){var t=f.data,e=t.messageId,a=Yr[e];if(!a)throw new Error("WorkerModule response with empty or unknown messageId");delete Yr[e],a(t)}}return r}function Gn(l,r,c){return new Promise(function(f,t){var e=++_o;Yr[e]=function(a){a.success?f(a.result):t(new Error("Error in worker "+r+" call: "+a.error))},ko(l).postMessage({messageId:e,action:r,data:c})})}function la(){var l=function(r){function c(F,L,p,b,M,C,k,N){var P=1-k;N.x=P*P*F+2*P*k*p+k*k*M,N.y=P*P*L+2*P*k*b+k*k*C}function f(F,L,p,b,M,C,k,N,P,B){var Y=1-P;B.x=Y*Y*Y*F+3*Y*Y*P*p+3*Y*P*P*M+P*P*P*k,B.y=Y*Y*Y*L+3*Y*Y*P*b+3*Y*P*P*C+P*P*P*N}function t(F,L){for(var p=/([MLQCZ])([^MLQCZ]*)/g,b,M,C,k,N;b=p.exec(F);){var P=b[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(B){return parseFloat(B)});switch(b[1]){case"M":k=M=P[0],N=C=P[1];break;case"L":(P[0]!==k||P[1]!==N)&&L("L",k,N,k=P[0],N=P[1]);break;case"Q":{L("Q",k,N,k=P[2],N=P[3],P[0],P[1]);break}case"C":{L("C",k,N,k=P[4],N=P[5],P[0],P[1],P[2],P[3]);break}case"Z":(k!==M||N!==C)&&L("L",k,N,M,C);break}}}function e(F,L,p){p===void 0&&(p=16);var b={x:0,y:0};t(F,function(M,C,k,N,P,B,Y,$,H){switch(M){case"L":L(C,k,N,P);break;case"Q":{for(var W=C,he=k,ce=1;ce<p;ce++)c(C,k,B,Y,N,P,ce/(p-1),b),L(W,he,b.x,b.y),W=b.x,he=b.y;break}case"C":{for(var Z=C,te=k,se=1;se<p;se++)f(C,k,B,Y,$,H,N,P,se/(p-1),b),L(Z,te,b.x,b.y),Z=b.x,te=b.y;break}}})}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",o="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",n=new WeakMap,i={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function s(F,L){var p=F.getContext?F.getContext("webgl",i):F,b=n.get(p);if(!b){let Y=function(Z){var te=C[Z];if(!te&&(te=C[Z]=p.getExtension(Z),!te))throw new Error(Z+" not supported");return te},$=function(Z,te){var se=p.createShader(te);return p.shaderSource(se,Z),p.compileShader(se),se},H=function(Z,te,se,V){if(!k[Z]){var re={},ee={},I=p.createProgram();p.attachShader(I,$(te,p.VERTEX_SHADER)),p.attachShader(I,$(se,p.FRAGMENT_SHADER)),p.linkProgram(I),k[Z]={program:I,transaction:function(Q){p.useProgram(I),Q({setUniform:function(J,be){for(var ne=[],oe=arguments.length-2;oe-- >0;)ne[oe]=arguments[oe+2];var fe=ee[be]||(ee[be]=p.getUniformLocation(I,be));p["uniform"+J].apply(p,[fe].concat(ne))},setAttribute:function(J,be,ne,oe,fe){var pe=re[J];pe||(pe=re[J]={buf:p.createBuffer(),loc:p.getAttribLocation(I,J),data:null}),p.bindBuffer(p.ARRAY_BUFFER,pe.buf),p.vertexAttribPointer(pe.loc,be,p.FLOAT,!1,0,0),p.enableVertexAttribArray(pe.loc),M?p.vertexAttribDivisor(pe.loc,oe):Y("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(pe.loc,oe),fe!==pe.data&&(p.bufferData(p.ARRAY_BUFFER,fe,ne),pe.data=fe)}})}}}k[Z].transaction(V)},W=function(Z,te){P++;try{p.activeTexture(p.TEXTURE0+P);var se=N[Z];se||(se=N[Z]=p.createTexture(),p.bindTexture(p.TEXTURE_2D,se),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST)),p.bindTexture(p.TEXTURE_2D,se),te(se,P)}finally{P--}},he=function(Z,te,se){var V=p.createFramebuffer();B.push(V),p.bindFramebuffer(p.FRAMEBUFFER,V),p.activeTexture(p.TEXTURE0+te),p.bindTexture(p.TEXTURE_2D,Z),p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,Z,0);try{se(V)}finally{p.deleteFramebuffer(V),p.bindFramebuffer(p.FRAMEBUFFER,B[--B.length-1]||null)}},ce=function(){C={},k={},N={},P=-1,B.length=0};var M=typeof WebGL2RenderingContext<"u"&&p instanceof WebGL2RenderingContext,C={},k={},N={},P=-1,B=[];p.canvas.addEventListener("webglcontextlost",function(Z){ce(),Z.preventDefault()},!1),n.set(p,b={gl:p,isWebGL2:M,getExtension:Y,withProgram:H,withTexture:W,withTextureFramebuffer:he,handleContextLoss:ce})}L(b)}function u(F,L,p,b,M,C,k,N){k===void 0&&(k=15),N===void 0&&(N=null),s(F,function(P){var B=P.gl,Y=P.withProgram,$=P.withTexture;$("copy",function(H,W){B.texImage2D(B.TEXTURE_2D,0,B.RGBA,M,C,0,B.RGBA,B.UNSIGNED_BYTE,L),Y("copy",a,o,function(he){var ce=he.setUniform,Z=he.setAttribute;Z("aUV",2,B.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),ce("1i","image",W),B.bindFramebuffer(B.FRAMEBUFFER,N||null),B.disable(B.BLEND),B.colorMask(k&8,k&4,k&2,k&1),B.viewport(p,b,M,C),B.scissor(p,b,M,C),B.drawArrays(B.TRIANGLES,0,3)})})})}function h(F,L,p){var b=F.width,M=F.height;s(F,function(C){var k=C.gl,N=new Uint8Array(b*M*4);k.readPixels(0,0,b,M,k.RGBA,k.UNSIGNED_BYTE,N),F.width=L,F.height=p,u(k,N,0,0,b,M)})}var d=Object.freeze({__proto__:null,withWebGLContext:s,renderImageData:u,resizeWebGLCanvasWithoutClearing:h});function v(F,L,p,b,M,C){C===void 0&&(C=1);var k=new Uint8Array(F*L),N=b[2]-b[0],P=b[3]-b[1],B=[];e(p,function(Z,te,se,V){B.push({x1:Z,y1:te,x2:se,y2:V,minX:Math.min(Z,se),minY:Math.min(te,V),maxX:Math.max(Z,se),maxY:Math.max(te,V)})}),B.sort(function(Z,te){return Z.maxX-te.maxX});for(var Y=0;Y<F;Y++)for(var $=0;$<L;$++){var H=he(b[0]+N*(Y+.5)/F,b[1]+P*($+.5)/L),W=Math.pow(1-Math.abs(H)/M,C)/2;H<0&&(W=1-W),W=Math.max(0,Math.min(255,Math.round(W*255))),k[$*F+Y]=W}return k;function he(Z,te){for(var se=1/0,V=1/0,re=B.length;re--;){var ee=B[re];if(ee.maxX+V<=Z)break;if(Z+V>ee.minX&&te-V<ee.maxY&&te+V>ee.minY){var I=E(Z,te,ee.x1,ee.y1,ee.x2,ee.y2);I<se&&(se=I,V=Math.sqrt(se))}}return ce(Z,te)&&(V=-V),V}function ce(Z,te){for(var se=0,V=B.length;V--;){var re=B[V];if(re.maxX<=Z)break;var ee=re.y1>te!=re.y2>te&&Z<(re.x2-re.x1)*(te-re.y1)/(re.y2-re.y1)+re.x1;ee&&(se+=re.y1<re.y2?1:-1)}return se!==0}}function g(F,L,p,b,M,C,k,N,P,B){C===void 0&&(C=1),N===void 0&&(N=0),P===void 0&&(P=0),B===void 0&&(B=0),m(F,L,p,b,M,C,k,null,N,P,B)}function m(F,L,p,b,M,C,k,N,P,B,Y){C===void 0&&(C=1),P===void 0&&(P=0),B===void 0&&(B=0),Y===void 0&&(Y=0);for(var $=v(F,L,p,b,M,C),H=new Uint8Array($.length*4),W=0;W<$.length;W++)H[W*4+Y]=$[W];u(k,H,P,B,F,L,1<<3-Y,N)}function E(F,L,p,b,M,C){var k=M-p,N=C-b,P=k*k+N*N,B=P?Math.max(0,Math.min(1,((F-p)*k+(L-b)*N)/P)):0,Y=F-(p+B*k),$=L-(b+B*N);return Y*Y+$*$}var x=Object.freeze({__proto__:null,generate:v,generateIntoCanvas:g,generateIntoFramebuffer:m}),_="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",w="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",U="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",D=new Float32Array([0,0,2,0,0,2]),S=null,T=!1,O={},G=new WeakMap;function K(F){if(!T&&!j(F))throw new Error("WebGL generation not supported")}function y(F,L,p,b,M,C,k){if(C===void 0&&(C=1),k===void 0&&(k=null),!k&&(k=S,!k)){var N=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!N)throw new Error("OffscreenCanvas or DOM canvas not supported");k=S=N.getContext("webgl",{depth:!1})}K(k);var P=new Uint8Array(F*L*4);s(k,function(H){var W=H.gl,he=H.withTexture,ce=H.withTextureFramebuffer;he("readable",function(Z,te){W.texImage2D(W.TEXTURE_2D,0,W.RGBA,F,L,0,W.RGBA,W.UNSIGNED_BYTE,null),ce(Z,te,function(se){A(F,L,p,b,M,C,W,se,0,0,0),W.readPixels(0,0,F,L,W.RGBA,W.UNSIGNED_BYTE,P)})})});for(var B=new Uint8Array(F*L),Y=0,$=0;Y<P.length;Y+=4)B[$++]=P[Y];return B}function R(F,L,p,b,M,C,k,N,P,B){C===void 0&&(C=1),N===void 0&&(N=0),P===void 0&&(P=0),B===void 0&&(B=0),A(F,L,p,b,M,C,k,null,N,P,B)}function A(F,L,p,b,M,C,k,N,P,B,Y){C===void 0&&(C=1),P===void 0&&(P=0),B===void 0&&(B=0),Y===void 0&&(Y=0),K(k);var $=[];e(p,function(H,W,he,ce){$.push(H,W,he,ce)}),$=new Float32Array($),s(k,function(H){var W=H.gl,he=H.isWebGL2,ce=H.getExtension,Z=H.withProgram,te=H.withTexture,se=H.withTextureFramebuffer,V=H.handleContextLoss;if(te("rawDistances",function(re,ee){(F!==re._lastWidth||L!==re._lastHeight)&&W.texImage2D(W.TEXTURE_2D,0,W.RGBA,re._lastWidth=F,re._lastHeight=L,0,W.RGBA,W.UNSIGNED_BYTE,null),Z("main",_,w,function(I){var de=I.setAttribute,Q=I.setUniform,ae=!he&&ce("ANGLE_instanced_arrays"),J=!he&&ce("EXT_blend_minmax");de("aUV",2,W.STATIC_DRAW,0,D),de("aLineSegment",4,W.DYNAMIC_DRAW,1,$),Q.apply(void 0,["4f","uGlyphBounds"].concat(b)),Q("1f","uMaxDistance",M),Q("1f","uExponent",C),se(re,ee,function(be){W.enable(W.BLEND),W.colorMask(!0,!0,!0,!0),W.viewport(0,0,F,L),W.scissor(0,0,F,L),W.blendFunc(W.ONE,W.ONE),W.blendEquationSeparate(W.FUNC_ADD,he?W.MAX:J.MAX_EXT),W.clear(W.COLOR_BUFFER_BIT),he?W.drawArraysInstanced(W.TRIANGLES,0,3,$.length/4):ae.drawArraysInstancedANGLE(W.TRIANGLES,0,3,$.length/4)})}),Z("post",a,U,function(I){I.setAttribute("aUV",2,W.STATIC_DRAW,0,D),I.setUniform("1i","tex",ee),W.bindFramebuffer(W.FRAMEBUFFER,N),W.disable(W.BLEND),W.colorMask(Y===0,Y===1,Y===2,Y===3),W.viewport(P,B,F,L),W.scissor(P,B,F,L),W.drawArrays(W.TRIANGLES,0,3)})}),W.isContextLost())throw V(),new Error("webgl context lost")})}function j(F){var L=!F||F===S?O:F.canvas||F,p=G.get(L);if(p===void 0){T=!0;var b=null;try{var M=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],C=y(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,F);p=C&&M.length===C.length&&C.every(function(k,N){return k===M[N]}),p||(b="bad trial run results",console.info(M,C))}catch(k){p=!1,b=k.message}b&&console.warn("WebGL SDF generation not supported:",b),T=!1,G.set(L,p)}return p}var z=Object.freeze({__proto__:null,generate:y,generateIntoCanvas:R,generateIntoFramebuffer:A,isSupported:j});function X(F,L,p,b,M,C){M===void 0&&(M=Math.max(b[2]-b[0],b[3]-b[1])/2),C===void 0&&(C=1);try{return y.apply(z,arguments)}catch(k){return console.info("WebGL SDF generation failed, falling back to JS",k),v.apply(x,arguments)}}function q(F,L,p,b,M,C,k,N,P,B){M===void 0&&(M=Math.max(b[2]-b[0],b[3]-b[1])/2),C===void 0&&(C=1),N===void 0&&(N=0),P===void 0&&(P=0),B===void 0&&(B=0);try{return R.apply(z,arguments)}catch(Y){return console.info("WebGL SDF generation failed, falling back to JS",Y),g.apply(x,arguments)}}return r.forEachPathCommand=t,r.generate=X,r.generateIntoCanvas=q,r.javascript=x,r.pathToLineSegments=e,r.webgl=z,r.webglUtils=d,Object.defineProperty(r,"__esModule",{value:!0}),r}({});return l}function Mo(){var l=function(r){var c={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},f={},t={};f.L=1,t[1]="L",Object.keys(c).forEach(function(V,re){f[V]=1<<re+1,t[f[V]]=V}),Object.freeze(f);var e=f.LRI|f.RLI|f.FSI,a=f.L|f.R|f.AL,o=f.B|f.S|f.WS|f.ON|f.FSI|f.LRI|f.RLI|f.PDI,n=f.BN|f.RLE|f.LRE|f.RLO|f.LRO|f.PDF,i=f.S|f.WS|f.B|e|f.PDI|n,s=null;function u(){if(!s){s=new Map;var V=function(ee){if(c.hasOwnProperty(ee)){var I=0;c[ee].split(",").forEach(function(de){var Q=de.split("+"),ae=Q[0],J=Q[1];ae=parseInt(ae,36),J=J?parseInt(J,36):0,s.set(I+=ae,f[ee]);for(var be=0;be<J;be++)s.set(++I,f[ee])})}};for(var re in c)V(re)}}function h(V){return u(),s.get(V.codePointAt(0))||f.L}function d(V){return t[h(V)]}var v={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function g(V,re){var ee=36,I=0,de=new Map,Q=re&&new Map,ae;return V.split(",").forEach(function J(be){if(be.indexOf("+")!==-1)for(var ne=+be;ne--;)J(ae);else{ae=be;var oe=be.split(">"),fe=oe[0],pe=oe[1];fe=String.fromCodePoint(I+=parseInt(fe,ee)),pe=String.fromCodePoint(I+=parseInt(pe,ee)),de.set(fe,pe),re&&Q.set(pe,fe)}}),{map:de,reverseMap:Q}}var m,E,x;function _(){if(!m){var V=g(v.pairs,!0),re=V.map,ee=V.reverseMap;m=re,E=ee,x=g(v.canonical,!1).map}}function w(V){return _(),m.get(V)||null}function U(V){return _(),E.get(V)||null}function D(V){return _(),x.get(V)||null}var S=f.L,T=f.R,O=f.EN,G=f.ES,K=f.ET,y=f.AN,R=f.CS,A=f.B,j=f.S,z=f.ON,X=f.BN,q=f.NSM,F=f.AL,L=f.LRO,p=f.RLO,b=f.LRE,M=f.RLE,C=f.PDF,k=f.LRI,N=f.RLI,P=f.FSI,B=f.PDI;function Y(V,re){for(var ee=125,I=new Uint32Array(V.length),de=0;de<V.length;de++)I[de]=h(V[de]);var Q=new Map;function ae(Ie,Ye){var Be=I[Ie];I[Ie]=Ye,Q.set(Be,Q.get(Be)-1),Be&o&&Q.set(o,Q.get(o)-1),Q.set(Ye,(Q.get(Ye)||0)+1),Ye&o&&Q.set(o,(Q.get(o)||0)+1)}for(var J=new Uint8Array(V.length),be=new Map,ne=[],oe=null,fe=0;fe<V.length;fe++)oe||ne.push(oe={start:fe,end:V.length-1,level:re==="rtl"?1:re==="ltr"?0:Cn(fe,!1)}),I[fe]&A&&(oe.end=fe,oe=null);for(var pe=M|b|p|L|e|B|C|A,Se=function(Ie){return Ie+(Ie&1?1:2)},Me=function(Ie){return Ie+(Ie&1?2:1)},ge=0;ge<ne.length;ge++){oe=ne[ge];var me=[{_level:oe.level,_override:0,_isolate:0}],le=void 0,Ae=0,_e=0,Oe=0;Q.clear();for(var Ue=oe.start;Ue<=oe.end;Ue++){var ue=I[Ue];if(le=me[me.length-1],Q.set(ue,(Q.get(ue)||0)+1),ue&o&&Q.set(o,(Q.get(o)||0)+1),ue&pe)if(ue&(M|b)){J[Ue]=le._level;var xe=(ue===M?Me:Se)(le._level);xe<=ee&&!Ae&&!_e?me.push({_level:xe,_override:0,_isolate:0}):Ae||_e++}else if(ue&(p|L)){J[Ue]=le._level;var et=(ue===p?Me:Se)(le._level);et<=ee&&!Ae&&!_e?me.push({_level:et,_override:ue&p?T:S,_isolate:0}):Ae||_e++}else if(ue&e){ue&P&&(ue=Cn(Ue+1,!0)===1?N:k),J[Ue]=le._level,le._override&&ae(Ue,le._override);var we=(ue===N?Me:Se)(le._level);we<=ee&&Ae===0&&_e===0?(Oe++,me.push({_level:we,_override:0,_isolate:1,_isolInitIndex:Ue})):Ae++}else if(ue&B){if(Ae>0)Ae--;else if(Oe>0){for(_e=0;!me[me.length-1]._isolate;)me.pop();var ye=me[me.length-1]._isolInitIndex;ye!=null&&(be.set(ye,Ue),be.set(Ue,ye)),me.pop(),Oe--}le=me[me.length-1],J[Ue]=le._level,le._override&&ae(Ue,le._override)}else ue&C?(Ae===0&&(_e>0?_e--:!le._isolate&&me.length>1&&(me.pop(),le=me[me.length-1])),J[Ue]=le._level):ue&A&&(J[Ue]=oe.level);else J[Ue]=le._level,le._override&&ue!==X&&ae(Ue,le._override)}for(var Fe=[],Te=null,ve=oe.start;ve<=oe.end;ve++){var ke=I[ve];if(!(ke&n)){var Pe=J[ve],Le=ke&e,Ee=ke===B;Te&&Pe===Te._level?(Te._end=ve,Te._endsWithIsolInit=Le):Fe.push(Te={_start:ve,_end:ve,_level:Pe,_startsWithPDI:Ee,_endsWithIsolInit:Le})}}for(var He=[],tt=0;tt<Fe.length;tt++){var qe=Fe[tt];if(!qe._startsWithPDI||qe._startsWithPDI&&!be.has(qe._start)){for(var rt=[Te=qe],ut=void 0;Te&&Te._endsWithIsolInit&&(ut=be.get(Te._end))!=null;)for(var Ze=tt+1;Ze<Fe.length;Ze++)if(Fe[Ze]._start===ut){rt.push(Te=Fe[Ze]);break}for(var Ge=[],ht=0;ht<rt.length;ht++)for(var fn=rt[ht],wr=fn._start;wr<=fn._end;wr++)Ge.push(wr);for(var Ca=J[Ge[0]],cn=oe.level,Jt=Ge[0]-1;Jt>=0;Jt--)if(!(I[Jt]&n)){cn=J[Jt];break}var Sr=Ge[Ge.length-1],Fa=J[Sr],un=oe.level;if(!(I[Sr]&e)){for(var Qt=Sr+1;Qt<=oe.end;Qt++)if(!(I[Qt]&n)){un=J[Qt];break}}He.push({_seqIndices:Ge,_sosType:Math.max(cn,Ca)%2?T:S,_eosType:Math.max(un,Fa)%2?T:S})}}for(var Ur=0;Ur<He.length;Ur++){var _r=He[Ur],ie=_r._seqIndices,Ct=_r._sosType,Ea=_r._eosType,gt=J[ie[0]]&1?T:S;if(Q.get(q))for(var qt=0;qt<ie.length;qt++){var hn=ie[qt];if(I[hn]&q){for(var Tr=Ct,Zt=qt-1;Zt>=0;Zt--)if(!(I[ie[Zt]]&n)){Tr=I[ie[Zt]];break}ae(hn,Tr&(e|B)?z:Tr)}}if(Q.get(O))for(var $t=0;$t<ie.length;$t++){var dn=ie[$t];if(I[dn]&O)for(var er=$t-1;er>=-1;er--){var pn=er===-1?Ct:I[ie[er]];if(pn&a){pn===F&&ae(dn,y);break}}}if(Q.get(F))for(var kr=0;kr<ie.length;kr++){var vn=ie[kr];I[vn]&F&&ae(vn,T)}if(Q.get(G)||Q.get(R))for(var Ft=1;Ft<ie.length-1;Ft++){var Mr=ie[Ft];if(I[Mr]&(G|R)){for(var mt=0,Ar=0,Cr=Ft-1;Cr>=0&&(mt=I[ie[Cr]],!!(mt&n));Cr--);for(var Fr=Ft+1;Fr<ie.length&&(Ar=I[ie[Fr]],!!(Ar&n));Fr++);mt===Ar&&(I[Mr]===G?mt===O:mt&(O|y))&&ae(Mr,mt)}}if(Q.get(O))for(var Ke=0;Ke<ie.length;Ke++){var Da=ie[Ke];if(I[Da]&O){for(var tr=Ke-1;tr>=0&&I[ie[tr]]&(K|n);tr--)ae(ie[tr],O);for(Ke++;Ke<ie.length&&I[ie[Ke]]&(K|n|O);Ke++)I[ie[Ke]]!==O&&ae(ie[Ke],O)}}if(Q.get(K)||Q.get(G)||Q.get(R))for(var Et=0;Et<ie.length;Et++){var gn=ie[Et];if(I[gn]&(K|G|R)){ae(gn,z);for(var rr=Et-1;rr>=0&&I[ie[rr]]&n;rr--)ae(ie[rr],z);for(var nr=Et+1;nr<ie.length&&I[ie[nr]]&n;nr++)ae(ie[nr],z)}}if(Q.get(O))for(var Er=0,mn=Ct;Er<ie.length;Er++){var yn=ie[Er],Dr=I[yn];Dr&O?mn===S&&ae(yn,S):Dr&a&&(mn=Dr)}if(Q.get(o)){var Dt=T|O|y,bn=Dt|S,ar=[];{for(var yt=[],bt=0;bt<ie.length;bt++)if(I[ie[bt]]&o){var Rt=V[ie[bt]],xn=void 0;if(w(Rt)!==null)if(yt.length<63)yt.push({char:Rt,seqIndex:bt});else break;else if((xn=U(Rt))!==null)for(var Lt=yt.length-1;Lt>=0;Lt--){var Rr=yt[Lt].char;if(Rr===xn||Rr===U(D(Rt))||w(D(Rr))===Rt){ar.push([yt[Lt].seqIndex,bt]),yt.length=Lt;break}}}ar.sort(function(Ie,Ye){return Ie[0]-Ye[0]})}for(var Lr=0;Lr<ar.length;Lr++){for(var wn=ar[Lr],or=wn[0],Pr=wn[1],Sn=!1,Xe=0,Gr=or+1;Gr<Pr;Gr++){var Un=ie[Gr];if(I[Un]&bn){Sn=!0;var _n=I[Un]&Dt?T:S;if(_n===gt){Xe=_n;break}}}if(Sn&&!Xe){Xe=Ct;for(var Or=or-1;Or>=0;Or--){var Tn=ie[Or];if(I[Tn]&bn){var kn=I[Tn]&Dt?T:S;kn!==gt?Xe=kn:Xe=gt;break}}}if(Xe){if(I[ie[or]]=I[ie[Pr]]=Xe,Xe!==gt){for(var Pt=or+1;Pt<ie.length;Pt++)if(!(I[ie[Pt]]&n)){h(V[ie[Pt]])&q&&(I[ie[Pt]]=Xe);break}}if(Xe!==gt){for(var Gt=Pr+1;Gt<ie.length;Gt++)if(!(I[ie[Gt]]&n)){h(V[ie[Gt]])&q&&(I[ie[Gt]]=Xe);break}}}}for(var nt=0;nt<ie.length;nt++)if(I[ie[nt]]&o){for(var Mn=nt,Ir=nt,Br=Ct,Ot=nt-1;Ot>=0;Ot--)if(I[ie[Ot]]&n)Mn=Ot;else{Br=I[ie[Ot]]&Dt?T:S;break}for(var An=Ea,It=nt+1;It<ie.length;It++)if(I[ie[It]]&(o|n))Ir=It;else{An=I[ie[It]]&Dt?T:S;break}for(var Nr=Mn;Nr<=Ir;Nr++)I[ie[Nr]]=Br===An?Br:gt;nt=Ir}}}for(var Ne=oe.start;Ne<=oe.end;Ne++){var Ra=J[Ne],ir=I[Ne];if(Ra&1?ir&(S|O|y)&&J[Ne]++:ir&T?J[Ne]++:ir&(y|O)&&(J[Ne]+=2),ir&n&&(J[Ne]=Ne===0?oe.level:J[Ne-1]),Ne===oe.end||h(V[Ne])&(j|A))for(var sr=Ne;sr>=0&&h(V[sr])&i;sr--)J[sr]=oe.level}}return{levels:J,paragraphs:ne};function Cn(Ie,Ye){for(var Be=Ie;Be<V.length;Be++){var at=I[Be];if(at&(T|F))return 1;if(at&(A|S)||Ye&&at===B)return 0;if(at&e){var Fn=La(Be);Be=Fn===-1?V.length:Fn}}return 0}function La(Ie){for(var Ye=1,Be=Ie+1;Be<V.length;Be++){var at=I[Be];if(at&A)break;if(at&B){if(--Ye===0)return Be}else at&e&&Ye++}return-1}}var $="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",H;function W(){if(!H){var V=g($,!0),re=V.map,ee=V.reverseMap;ee.forEach(function(I,de){re.set(de,I)}),H=re}}function he(V){return W(),H.get(V)||null}function ce(V,re,ee,I){var de=V.length;ee=Math.max(0,ee==null?0:+ee),I=Math.min(de-1,I==null?de-1:+I);for(var Q=new Map,ae=ee;ae<=I;ae++)if(re[ae]&1){var J=he(V[ae]);J!==null&&Q.set(ae,J)}return Q}function Z(V,re,ee,I){var de=V.length;ee=Math.max(0,ee==null?0:+ee),I=Math.min(de-1,I==null?de-1:+I);var Q=[];return re.paragraphs.forEach(function(ae){var J=Math.max(ee,ae.start),be=Math.min(I,ae.end);if(J<be){for(var ne=re.levels.slice(J,be+1),oe=be;oe>=J&&h(V[oe])&i;oe--)ne[oe]=ae.level;for(var fe=ae.level,pe=1/0,Se=0;Se<ne.length;Se++){var Me=ne[Se];Me>fe&&(fe=Me),Me<pe&&(pe=Me|1)}for(var ge=fe;ge>=pe;ge--)for(var me=0;me<ne.length;me++)if(ne[me]>=ge){for(var le=me;me+1<ne.length&&ne[me+1]>=ge;)me++;me>le&&Q.push([le+J,me+J])}}}),Q}function te(V,re,ee,I){var de=se(V,re,ee,I),Q=[].concat(V);return de.forEach(function(ae,J){Q[J]=(re.levels[ae]&1?he(V[ae]):null)||V[ae]}),Q.join("")}function se(V,re,ee,I){for(var de=Z(V,re,ee,I),Q=[],ae=0;ae<V.length;ae++)Q[ae]=ae;return de.forEach(function(J){for(var be=J[0],ne=J[1],oe=Q.slice(be,ne+1),fe=oe.length;fe--;)Q[ne-fe]=oe[fe]}),Q}return r.closingToOpeningBracket=U,r.getBidiCharType=h,r.getBidiCharTypeName=d,r.getCanonicalBracket=D,r.getEmbeddingLevels=Y,r.getMirroredCharacter=he,r.getMirroredCharactersMap=ce,r.getReorderSegments=Z,r.getReorderedIndices=se,r.getReorderedString=te,r.openingToClosingBracket=w,Object.defineProperty(r,"__esModule",{value:!0}),r}({});return l}const fa=/\bvoid\s+main\s*\(\s*\)\s*{/g;function Kr(l){const r=/^[ \t]*#include +<([\w\d./]+)>/gm;function c(f,t){let e=Ba[t];return e?Kr(e):f}return l.replace(r,c)}const Re=[];for(let l=0;l<256;l++)Re[l]=(l<16?"0":"")+l.toString(16);function Ao(){const l=Math.random()*4294967295|0,r=Math.random()*4294967295|0,c=Math.random()*4294967295|0,f=Math.random()*4294967295|0;return(Re[l&255]+Re[l>>8&255]+Re[l>>16&255]+Re[l>>24&255]+"-"+Re[r&255]+Re[r>>8&255]+"-"+Re[r>>16&15|64]+Re[r>>24&255]+"-"+Re[c&63|128]+Re[c>>8&255]+"-"+Re[c>>16&255]+Re[c>>24&255]+Re[f&255]+Re[f>>8&255]+Re[f>>16&255]+Re[f>>24&255]).toUpperCase()}const dt=Object.assign||function(){let l=arguments[0];for(let r=1,c=arguments.length;r<c;r++){let f=arguments[r];if(f)for(let t in f)Object.prototype.hasOwnProperty.call(f,t)&&(l[t]=f[t])}return l},Co=Date.now(),On=new WeakMap,In=new Map;let Fo=1e10;function Jr(l,r){const c=Lo(r);let f=On.get(l);if(f||On.set(l,f=Object.create(null)),f[c])return new f[c];const t=`_onBeforeCompile${c}`,e=function(i,s){l.onBeforeCompile.call(this,i,s);const u=this.customProgramCacheKey()+"|"+i.vertexShader+"|"+i.fragmentShader;let h=In[u];if(!h){const d=Eo(this,i,r,c);h=In[u]=d}i.vertexShader=h.vertexShader,i.fragmentShader=h.fragmentShader,dt(i.uniforms,this.uniforms),r.timeUniform&&(i.uniforms[r.timeUniform]={get value(){return Date.now()-Co}}),this[t]&&this[t](i)},a=function(){return o(r.chained?l:l.clone())},o=function(i){const s=Object.create(i,n);return Object.defineProperty(s,"baseMaterial",{value:l}),Object.defineProperty(s,"id",{value:Fo++}),s.uuid=Ao(),s.uniforms=dt({},i.uniforms,r.uniforms),s.defines=dt({},i.defines,r.defines),s.defines[`TROIKA_DERIVED_MATERIAL_${c}`]="",s.extensions=dt({},i.extensions,r.extensions),s._listeners=void 0,s},n={constructor:{value:a},isDerivedMaterial:{value:!0},type:{get:()=>l.type,set:i=>{l.type=i}},isDerivedFrom:{writable:!0,configurable:!0,value:function(i){const s=this.baseMaterial;return i===s||s.isDerivedMaterial&&s.isDerivedFrom(i)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return l.customProgramCacheKey()+"|"+c}},onBeforeCompile:{get(){return e},set(i){this[t]=i}},copy:{writable:!0,configurable:!0,value:function(i){return l.copy.call(this,i),!l.isShaderMaterial&&!l.isDerivedMaterial&&(dt(this.extensions,i.extensions),dt(this.defines,i.defines),dt(this.uniforms,Ia.clone(i.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const i=new l.constructor;return o(i).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let i=this._depthMaterial;return i||(i=this._depthMaterial=Jr(l.isDerivedMaterial?l.getDepthMaterial():new Ga({depthPacking:Oa}),r),i.defines.IS_DEPTH_MATERIAL="",i.uniforms=this.uniforms),i}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let i=this._distanceMaterial;return i||(i=this._distanceMaterial=Jr(l.isDerivedMaterial?l.getDistanceMaterial():new Pa,r),i.defines.IS_DISTANCE_MATERIAL="",i.uniforms=this.uniforms),i}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:i,_distanceMaterial:s}=this;i&&i.dispose(),s&&s.dispose(),l.dispose.call(this)}}};return f[c]=a,new a}function Eo(l,{vertexShader:r,fragmentShader:c},f,t){let{vertexDefs:e,vertexMainIntro:a,vertexMainOutro:o,vertexTransform:n,fragmentDefs:i,fragmentMainIntro:s,fragmentMainOutro:u,fragmentColorTransform:h,customRewriter:d,timeUniform:v}=f;if(e=e||"",a=a||"",o=o||"",i=i||"",s=s||"",u=u||"",(n||d)&&(r=Kr(r)),(h||d)&&(c=c.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),c=Kr(c)),d){let g=d({vertexShader:r,fragmentShader:c});r=g.vertexShader,c=g.fragmentShader}if(h){let g=[];c=c.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,m=>(g.push(m),"")),u=`${h}
${g.join(`
`)}
${u}`}if(v){const g=`
uniform float ${v};
`;e=g+e,i=g+i}return n&&(r=`vec3 troika_position_${t};
vec3 troika_normal_${t};
vec2 troika_uv_${t};
${r}
`,e=`${e}
void troikaVertexTransform${t}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${n}
}
`,a=`
troika_position_${t} = vec3(position);
troika_normal_${t} = vec3(normal);
troika_uv_${t} = vec2(uv);
troikaVertexTransform${t}(troika_position_${t}, troika_normal_${t}, troika_uv_${t});
${a}
`,r=r.replace(/\b(position|normal|uv)\b/g,(g,m,E,x)=>/\battribute\s+vec[23]\s+$/.test(x.substr(0,E))?m:`troika_${m}_${t}`),l.map&&l.map.channel>0||(r=r.replace(/\bMAP_UV\b/g,`troika_uv_${t}`))),r=Bn(r,t,e,a,o),c=Bn(c,t,i,s,u),{vertexShader:r,fragmentShader:c}}function Bn(l,r,c,f,t){return(f||t||c)&&(l=l.replace(fa,`
${c}
void troikaOrigMain${r}() {`),l+=`
void main() {
  ${f}
  troikaOrigMain${r}();
  ${t}
}`),l}function Do(l,r){return l==="uniforms"?void 0:typeof r=="function"?r.toString():r}let Ro=0;const Nn=new Map;function Lo(l){const r=JSON.stringify(l,Do);let c=Nn.get(r);return c==null&&Nn.set(r,c=++Ro),c}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function Po(){return typeof window>"u"&&(self.window=self),function(l){var r={parse:function(t){var e=r._bin,a=new Uint8Array(t);if(e.readASCII(a,0,4)=="ttcf"){var o=4;e.readUshort(a,o),o+=2,e.readUshort(a,o),o+=2;var n=e.readUint(a,o);o+=4;for(var i=[],s=0;s<n;s++){var u=e.readUint(a,o);o+=4,i.push(r._readFont(a,u))}return i}return[r._readFont(a,0)]},_readFont:function(t,e){var a=r._bin,o=e;a.readFixed(t,e),e+=4;var n=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2;for(var i=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],s={_data:t,_offset:o},u={},h=0;h<n;h++){var d=a.readASCII(t,e,4);e+=4,a.readUint(t,e),e+=4;var v=a.readUint(t,e);e+=4;var g=a.readUint(t,e);e+=4,u[d]={offset:v,length:g}}for(h=0;h<i.length;h++){var m=i[h];u[m]&&(s[m.trim()]=r[m.trim()].parse(t,u[m].offset,u[m].length,s))}return s},_tabOffset:function(t,e,a){for(var o=r._bin,n=o.readUshort(t,a+4),i=a+12,s=0;s<n;s++){var u=o.readASCII(t,i,4);i+=4,o.readUint(t,i),i+=4;var h=o.readUint(t,i);if(i+=4,o.readUint(t,i),i+=4,u==e)return h}return 0}};r._bin={readFixed:function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<8|t[e+3])/65540},readF2dot14:function(t,e){return r._bin.readShort(t,e)/16384},readInt:function(t,e){return r._bin._view(t).getInt32(e)},readInt8:function(t,e){return r._bin._view(t).getInt8(e)},readShort:function(t,e){return r._bin._view(t).getInt16(e)},readUshort:function(t,e){return r._bin._view(t).getUint16(e)},readUshorts:function(t,e,a){for(var o=[],n=0;n<a;n++)o.push(r._bin.readUshort(t,e+2*n));return o},readUint:function(t,e){return r._bin._view(t).getUint32(e)},readUint64:function(t,e){return 4294967296*r._bin.readUint(t,e)+r._bin.readUint(t,e+4)},readASCII:function(t,e,a){for(var o="",n=0;n<a;n++)o+=String.fromCharCode(t[e+n]);return o},readUnicode:function(t,e,a){for(var o="",n=0;n<a;n++){var i=t[e++]<<8|t[e++];o+=String.fromCharCode(i)}return o},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(t,e,a){var o=r._bin._tdec;return o&&e==0&&a==t.length?o.decode(t):r._bin.readASCII(t,e,a)},readBytes:function(t,e,a){for(var o=[],n=0;n<a;n++)o.push(t[e+n]);return o},readASCIIArray:function(t,e,a){for(var o=[],n=0;n<a;n++)o.push(String.fromCharCode(t[e+n]));return o},_view:function(t){return t._dataView||(t._dataView=t.buffer?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(new Uint8Array(t).buffer))}},r._lctf={},r._lctf.parse=function(t,e,a,o,n){var i=r._bin,s={},u=e;i.readFixed(t,e),e+=4;var h=i.readUshort(t,e);e+=2;var d=i.readUshort(t,e);e+=2;var v=i.readUshort(t,e);return e+=2,s.scriptList=r._lctf.readScriptList(t,u+h),s.featureList=r._lctf.readFeatureList(t,u+d),s.lookupList=r._lctf.readLookupList(t,u+v,n),s},r._lctf.readLookupList=function(t,e,a){var o=r._bin,n=e,i=[],s=o.readUshort(t,e);e+=2;for(var u=0;u<s;u++){var h=o.readUshort(t,e);e+=2;var d=r._lctf.readLookupTable(t,n+h,a);i.push(d)}return i},r._lctf.readLookupTable=function(t,e,a){var o=r._bin,n=e,i={tabs:[]};i.ltype=o.readUshort(t,e),e+=2,i.flag=o.readUshort(t,e),e+=2;var s=o.readUshort(t,e);e+=2;for(var u=i.ltype,h=0;h<s;h++){var d=o.readUshort(t,e);e+=2;var v=a(t,u,n+d,i);i.tabs.push(v)}return i},r._lctf.numOfOnes=function(t){for(var e=0,a=0;a<32;a++)t>>>a&1&&e++;return e},r._lctf.readClassDef=function(t,e){var a=r._bin,o=[],n=a.readUshort(t,e);if(e+=2,n==1){var i=a.readUshort(t,e);e+=2;var s=a.readUshort(t,e);e+=2;for(var u=0;u<s;u++)o.push(i+u),o.push(i+u),o.push(a.readUshort(t,e)),e+=2}if(n==2){var h=a.readUshort(t,e);for(e+=2,u=0;u<h;u++)o.push(a.readUshort(t,e)),e+=2,o.push(a.readUshort(t,e)),e+=2,o.push(a.readUshort(t,e)),e+=2}return o},r._lctf.getInterval=function(t,e){for(var a=0;a<t.length;a+=3){var o=t[a],n=t[a+1];if(t[a+2],o<=e&&e<=n)return a}return-1},r._lctf.readCoverage=function(t,e){var a=r._bin,o={};o.fmt=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);return e+=2,o.fmt==1&&(o.tab=a.readUshorts(t,e,n)),o.fmt==2&&(o.tab=a.readUshorts(t,e,3*n)),o},r._lctf.coverageIndex=function(t,e){var a=t.tab;if(t.fmt==1)return a.indexOf(e);if(t.fmt==2){var o=r._lctf.getInterval(a,e);if(o!=-1)return a[o+2]+(e-a[o])}return-1},r._lctf.readFeatureList=function(t,e){var a=r._bin,o=e,n=[],i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var u=a.readASCII(t,e,4);e+=4;var h=a.readUshort(t,e);e+=2;var d=r._lctf.readFeatureTable(t,o+h);d.tag=u.trim(),n.push(d)}return n},r._lctf.readFeatureTable=function(t,e){var a=r._bin,o=e,n={},i=a.readUshort(t,e);e+=2,i>0&&(n.featureParams=o+i);var s=a.readUshort(t,e);e+=2,n.tab=[];for(var u=0;u<s;u++)n.tab.push(a.readUshort(t,e+2*u));return n},r._lctf.readScriptList=function(t,e){var a=r._bin,o=e,n={},i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var u=a.readASCII(t,e,4);e+=4;var h=a.readUshort(t,e);e+=2,n[u.trim()]=r._lctf.readScriptTable(t,o+h)}return n},r._lctf.readScriptTable=function(t,e){var a=r._bin,o=e,n={},i=a.readUshort(t,e);e+=2,i>0&&(n.default=r._lctf.readLangSysTable(t,o+i));var s=a.readUshort(t,e);e+=2;for(var u=0;u<s;u++){var h=a.readASCII(t,e,4);e+=4;var d=a.readUshort(t,e);e+=2,n[h.trim()]=r._lctf.readLangSysTable(t,o+d)}return n},r._lctf.readLangSysTable=function(t,e){var a=r._bin,o={};a.readUshort(t,e),e+=2,o.reqFeature=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);return e+=2,o.features=a.readUshorts(t,e,n),o},r.CFF={},r.CFF.parse=function(t,e,a){var o=r._bin;(t=new Uint8Array(t.buffer,e,a))[e=0],t[++e],t[++e],t[++e],e++;var n=[];e=r.CFF.readIndex(t,e,n);for(var i=[],s=0;s<n.length-1;s++)i.push(o.readASCII(t,e+n[s],n[s+1]-n[s]));e+=n[n.length-1];var u=[];e=r.CFF.readIndex(t,e,u);var h=[];for(s=0;s<u.length-1;s++)h.push(r.CFF.readDict(t,e+u[s],e+u[s+1]));e+=u[u.length-1];var d=h[0],v=[];e=r.CFF.readIndex(t,e,v);var g=[];for(s=0;s<v.length-1;s++)g.push(o.readASCII(t,e+v[s],v[s+1]-v[s]));if(e+=v[v.length-1],r.CFF.readSubrs(t,e,d),d.CharStrings){e=d.CharStrings,v=[],e=r.CFF.readIndex(t,e,v);var m=[];for(s=0;s<v.length-1;s++)m.push(o.readBytes(t,e+v[s],v[s+1]-v[s]));d.CharStrings=m}if(d.ROS){e=d.FDArray;var E=[];for(e=r.CFF.readIndex(t,e,E),d.FDArray=[],s=0;s<E.length-1;s++){var x=r.CFF.readDict(t,e+E[s],e+E[s+1]);r.CFF._readFDict(t,x,g),d.FDArray.push(x)}e+=E[E.length-1],e=d.FDSelect,d.FDSelect=[];var _=t[e];if(e++,_!=3)throw _;var w=o.readUshort(t,e);for(e+=2,s=0;s<w+1;s++)d.FDSelect.push(o.readUshort(t,e),t[e+2]),e+=3}return d.Encoding&&(d.Encoding=r.CFF.readEncoding(t,d.Encoding,d.CharStrings.length)),d.charset&&(d.charset=r.CFF.readCharset(t,d.charset,d.CharStrings.length)),r.CFF._readFDict(t,d,g),d},r.CFF._readFDict=function(t,e,a){var o;for(var n in e.Private&&(o=e.Private[1],e.Private=r.CFF.readDict(t,o,o+e.Private[0]),e.Private.Subrs&&r.CFF.readSubrs(t,o+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(n)!=-1&&(e[n]=a[e[n]-426+35])},r.CFF.readSubrs=function(t,e,a){var o=r._bin,n=[];e=r.CFF.readIndex(t,e,n);var i,s=n.length;i=s<1240?107:s<33900?1131:32768,a.Bias=i,a.Subrs=[];for(var u=0;u<n.length-1;u++)a.Subrs.push(o.readBytes(t,e+n[u],n[u+1]-n[u]))},r.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],r.CFF.glyphByUnicode=function(t,e){for(var a=0;a<t.charset.length;a++)if(t.charset[a]==e)return a;return-1},r.CFF.glyphBySE=function(t,e){return e<0||e>255?-1:r.CFF.glyphByUnicode(t,r.CFF.tableSE[e])},r.CFF.readEncoding=function(t,e,a){r._bin;var o=[".notdef"],n=t[e];if(e++,n!=0)throw"error: unknown encoding format: "+n;var i=t[e];e++;for(var s=0;s<i;s++)o.push(t[e+s]);return o},r.CFF.readCharset=function(t,e,a){var o=r._bin,n=[".notdef"],i=t[e];if(e++,i==0)for(var s=0;s<a;s++){var u=o.readUshort(t,e);e+=2,n.push(u)}else{if(i!=1&&i!=2)throw"error: format: "+i;for(;n.length<a;){u=o.readUshort(t,e),e+=2;var h=0;for(i==1?(h=t[e],e++):(h=o.readUshort(t,e),e+=2),s=0;s<=h;s++)n.push(u),u++}}return n},r.CFF.readIndex=function(t,e,a){var o=r._bin,n=o.readUshort(t,e)+1,i=t[e+=2];if(e++,i==1)for(var s=0;s<n;s++)a.push(t[e+s]);else if(i==2)for(s=0;s<n;s++)a.push(o.readUshort(t,e+2*s));else if(i==3)for(s=0;s<n;s++)a.push(16777215&o.readUint(t,e+3*s-1));else if(n!=1)throw"unsupported offset size: "+i+", count: "+n;return(e+=n*i)-1},r.CFF.getCharString=function(t,e,a){var o=r._bin,n=t[e],i=t[e+1];t[e+2],t[e+3],t[e+4];var s=1,u=null,h=null;n<=20&&(u=n,s=1),n==12&&(u=100*n+i,s=2),21<=n&&n<=27&&(u=n,s=1),n==28&&(h=o.readShort(t,e+1),s=3),29<=n&&n<=31&&(u=n,s=1),32<=n&&n<=246&&(h=n-139,s=1),247<=n&&n<=250&&(h=256*(n-247)+i+108,s=2),251<=n&&n<=254&&(h=256*-(n-251)-i-108,s=2),n==255&&(h=o.readInt(t,e+1)/65535,s=5),a.val=h??"o"+u,a.size=s},r.CFF.readCharString=function(t,e,a){for(var o=e+a,n=r._bin,i=[];e<o;){var s=t[e],u=t[e+1];t[e+2],t[e+3],t[e+4];var h=1,d=null,v=null;s<=20&&(d=s,h=1),s==12&&(d=100*s+u,h=2),s!=19&&s!=20||(d=s,h=2),21<=s&&s<=27&&(d=s,h=1),s==28&&(v=n.readShort(t,e+1),h=3),29<=s&&s<=31&&(d=s,h=1),32<=s&&s<=246&&(v=s-139,h=1),247<=s&&s<=250&&(v=256*(s-247)+u+108,h=2),251<=s&&s<=254&&(v=256*-(s-251)-u-108,h=2),s==255&&(v=n.readInt(t,e+1)/65535,h=5),i.push(v??"o"+d),e+=h}return i},r.CFF.readDict=function(t,e,a){for(var o=r._bin,n={},i=[];e<a;){var s=t[e],u=t[e+1];t[e+2],t[e+3],t[e+4];var h=1,d=null,v=null;if(s==28&&(v=o.readShort(t,e+1),h=3),s==29&&(v=o.readInt(t,e+1),h=5),32<=s&&s<=246&&(v=s-139,h=1),247<=s&&s<=250&&(v=256*(s-247)+u+108,h=2),251<=s&&s<=254&&(v=256*-(s-251)-u-108,h=2),s==255)throw v=o.readInt(t,e+1)/65535,h=5,"unknown number";if(s==30){var g=[];for(h=1;;){var m=t[e+h];h++;var E=m>>4,x=15&m;if(E!=15&&g.push(E),x!=15&&g.push(x),x==15)break}for(var _="",w=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],U=0;U<g.length;U++)_+=w[g[U]];v=parseFloat(_)}s<=21&&(d=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],h=1,s==12&&(d=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][u],h=2)),d!=null?(n[d]=i.length==1?i[0]:i,i=[]):i.push(v),e+=h}return n},r.cmap={},r.cmap.parse=function(t,e,a){t=new Uint8Array(t.buffer,e,a),e=0;var o=r._bin,n={};o.readUshort(t,e),e+=2;var i=o.readUshort(t,e);e+=2;var s=[];n.tables=[];for(var u=0;u<i;u++){var h=o.readUshort(t,e);e+=2;var d=o.readUshort(t,e);e+=2;var v=o.readUint(t,e);e+=4;var g="p"+h+"e"+d,m=s.indexOf(v);if(m==-1){var E;m=n.tables.length,s.push(v);var x=o.readUshort(t,v);x==0?E=r.cmap.parse0(t,v):x==4?E=r.cmap.parse4(t,v):x==6?E=r.cmap.parse6(t,v):x==12?E=r.cmap.parse12(t,v):console.debug("unknown format: "+x,h,d,v),n.tables.push(E)}if(n[g]!=null)throw"multiple tables for one platform+encoding";n[g]=m}return n},r.cmap.parse0=function(t,e){var a=r._bin,o={};o.format=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,o.map=[];for(var i=0;i<n-6;i++)o.map.push(t[e+i]);return o},r.cmap.parse4=function(t,e){var a=r._bin,o=e,n={};n.format=a.readUshort(t,e),e+=2;var i=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2;var s=a.readUshort(t,e);e+=2;var u=s/2;n.searchRange=a.readUshort(t,e),e+=2,n.entrySelector=a.readUshort(t,e),e+=2,n.rangeShift=a.readUshort(t,e),e+=2,n.endCount=a.readUshorts(t,e,u),e+=2*u,e+=2,n.startCount=a.readUshorts(t,e,u),e+=2*u,n.idDelta=[];for(var h=0;h<u;h++)n.idDelta.push(a.readShort(t,e)),e+=2;for(n.idRangeOffset=a.readUshorts(t,e,u),e+=2*u,n.glyphIdArray=[];e<o+i;)n.glyphIdArray.push(a.readUshort(t,e)),e+=2;return n},r.cmap.parse6=function(t,e){var a=r._bin,o={};o.format=a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,o.firstCode=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2,o.glyphIdArray=[];for(var i=0;i<n;i++)o.glyphIdArray.push(a.readUshort(t,e)),e+=2;return o},r.cmap.parse12=function(t,e){var a=r._bin,o={};o.format=a.readUshort(t,e),e+=2,e+=2,a.readUint(t,e),e+=4,a.readUint(t,e),e+=4;var n=a.readUint(t,e);e+=4,o.groups=[];for(var i=0;i<n;i++){var s=e+12*i,u=a.readUint(t,s+0),h=a.readUint(t,s+4),d=a.readUint(t,s+8);o.groups.push([u,h,d])}return o},r.glyf={},r.glyf.parse=function(t,e,a,o){for(var n=[],i=0;i<o.maxp.numGlyphs;i++)n.push(null);return n},r.glyf._parseGlyf=function(t,e){var a=r._bin,o=t._data,n=r._tabOffset(o,"glyf",t._offset)+t.loca[e];if(t.loca[e]==t.loca[e+1])return null;var i={};if(i.noc=a.readShort(o,n),n+=2,i.xMin=a.readShort(o,n),n+=2,i.yMin=a.readShort(o,n),n+=2,i.xMax=a.readShort(o,n),n+=2,i.yMax=a.readShort(o,n),n+=2,i.xMin>=i.xMax||i.yMin>=i.yMax)return null;if(i.noc>0){i.endPts=[];for(var s=0;s<i.noc;s++)i.endPts.push(a.readUshort(o,n)),n+=2;var u=a.readUshort(o,n);if(n+=2,o.length-n<u)return null;i.instructions=a.readBytes(o,n,u),n+=u;var h=i.endPts[i.noc-1]+1;for(i.flags=[],s=0;s<h;s++){var d=o[n];if(n++,i.flags.push(d),(8&d)!=0){var v=o[n];n++;for(var g=0;g<v;g++)i.flags.push(d),s++}}for(i.xs=[],s=0;s<h;s++){var m=(2&i.flags[s])!=0,E=(16&i.flags[s])!=0;m?(i.xs.push(E?o[n]:-o[n]),n++):E?i.xs.push(0):(i.xs.push(a.readShort(o,n)),n+=2)}for(i.ys=[],s=0;s<h;s++)m=(4&i.flags[s])!=0,E=(32&i.flags[s])!=0,m?(i.ys.push(E?o[n]:-o[n]),n++):E?i.ys.push(0):(i.ys.push(a.readShort(o,n)),n+=2);var x=0,_=0;for(s=0;s<h;s++)x+=i.xs[s],_+=i.ys[s],i.xs[s]=x,i.ys[s]=_}else{var w;i.parts=[];do{w=a.readUshort(o,n),n+=2;var U={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(i.parts.push(U),U.glyphIndex=a.readUshort(o,n),n+=2,1&w){var D=a.readShort(o,n);n+=2;var S=a.readShort(o,n);n+=2}else D=a.readInt8(o,n),n++,S=a.readInt8(o,n),n++;2&w?(U.m.tx=D,U.m.ty=S):(U.p1=D,U.p2=S),8&w?(U.m.a=U.m.d=a.readF2dot14(o,n),n+=2):64&w?(U.m.a=a.readF2dot14(o,n),n+=2,U.m.d=a.readF2dot14(o,n),n+=2):128&w&&(U.m.a=a.readF2dot14(o,n),n+=2,U.m.b=a.readF2dot14(o,n),n+=2,U.m.c=a.readF2dot14(o,n),n+=2,U.m.d=a.readF2dot14(o,n),n+=2)}while(32&w);if(256&w){var T=a.readUshort(o,n);for(n+=2,i.instr=[],s=0;s<T;s++)i.instr.push(o[n]),n++}}return i},r.GDEF={},r.GDEF.parse=function(t,e,a,o){var n=e;e+=4;var i=r._bin.readUshort(t,e);return{glyphClassDef:i===0?null:r._lctf.readClassDef(t,n+i)}},r.GPOS={},r.GPOS.parse=function(t,e,a,o){return r._lctf.parse(t,e,a,o,r.GPOS.subt)},r.GPOS.subt=function(t,e,a,o){var n=r._bin,i=a,s={};if(s.fmt=n.readUshort(t,a),a+=2,e==1||e==2||e==3||e==7||e==8&&s.fmt<=2){var u=n.readUshort(t,a);a+=2,s.coverage=r._lctf.readCoverage(t,u+i)}if(e==1&&s.fmt==1){var h=n.readUshort(t,a);a+=2,h!=0&&(s.pos=r.GPOS.readValueRecord(t,a,h))}else if(e==2&&s.fmt>=1&&s.fmt<=2){h=n.readUshort(t,a),a+=2;var d=n.readUshort(t,a);a+=2;var v=r._lctf.numOfOnes(h),g=r._lctf.numOfOnes(d);if(s.fmt==1){s.pairsets=[];var m=n.readUshort(t,a);a+=2;for(var E=0;E<m;E++){var x=i+n.readUshort(t,a);a+=2;var _=n.readUshort(t,x);x+=2;for(var w=[],U=0;U<_;U++){var D=n.readUshort(t,x);x+=2,h!=0&&(y=r.GPOS.readValueRecord(t,x,h),x+=2*v),d!=0&&(R=r.GPOS.readValueRecord(t,x,d),x+=2*g),w.push({gid2:D,val1:y,val2:R})}s.pairsets.push(w)}}if(s.fmt==2){var S=n.readUshort(t,a);a+=2;var T=n.readUshort(t,a);a+=2;var O=n.readUshort(t,a);a+=2;var G=n.readUshort(t,a);for(a+=2,s.classDef1=r._lctf.readClassDef(t,i+S),s.classDef2=r._lctf.readClassDef(t,i+T),s.matrix=[],E=0;E<O;E++){var K=[];for(U=0;U<G;U++){var y=null,R=null;h!=0&&(y=r.GPOS.readValueRecord(t,a,h),a+=2*v),d!=0&&(R=r.GPOS.readValueRecord(t,a,d),a+=2*g),K.push({val1:y,val2:R})}s.matrix.push(K)}}}else if(e==4&&s.fmt==1)s.markCoverage=r._lctf.readCoverage(t,n.readUshort(t,a)+i),s.baseCoverage=r._lctf.readCoverage(t,n.readUshort(t,a+2)+i),s.markClassCount=n.readUshort(t,a+4),s.markArray=r.GPOS.readMarkArray(t,n.readUshort(t,a+6)+i),s.baseArray=r.GPOS.readBaseArray(t,n.readUshort(t,a+8)+i,s.markClassCount);else if(e==6&&s.fmt==1)s.mark1Coverage=r._lctf.readCoverage(t,n.readUshort(t,a)+i),s.mark2Coverage=r._lctf.readCoverage(t,n.readUshort(t,a+2)+i),s.markClassCount=n.readUshort(t,a+4),s.mark1Array=r.GPOS.readMarkArray(t,n.readUshort(t,a+6)+i),s.mark2Array=r.GPOS.readBaseArray(t,n.readUshort(t,a+8)+i,s.markClassCount);else{if(e==9&&s.fmt==1){var A=n.readUshort(t,a);a+=2;var j=n.readUint(t,a);if(a+=4,o.ltype==9)o.ltype=A;else if(o.ltype!=A)throw"invalid extension substitution";return r.GPOS.subt(t,o.ltype,i+j)}console.debug("unsupported GPOS table LookupType",e,"format",s.fmt)}return s},r.GPOS.readValueRecord=function(t,e,a){var o=r._bin,n=[];return n.push(1&a?o.readShort(t,e):0),e+=1&a?2:0,n.push(2&a?o.readShort(t,e):0),e+=2&a?2:0,n.push(4&a?o.readShort(t,e):0),e+=4&a?2:0,n.push(8&a?o.readShort(t,e):0),e+=8&a?2:0,n},r.GPOS.readBaseArray=function(t,e,a){var o=r._bin,n=[],i=e,s=o.readUshort(t,e);e+=2;for(var u=0;u<s;u++){for(var h=[],d=0;d<a;d++)h.push(r.GPOS.readAnchorRecord(t,i+o.readUshort(t,e))),e+=2;n.push(h)}return n},r.GPOS.readMarkArray=function(t,e){var a=r._bin,o=[],n=e,i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var u=r.GPOS.readAnchorRecord(t,a.readUshort(t,e+2)+n);u.markClass=a.readUshort(t,e),o.push(u),e+=4}return o},r.GPOS.readAnchorRecord=function(t,e){var a=r._bin,o={};return o.fmt=a.readUshort(t,e),o.x=a.readShort(t,e+2),o.y=a.readShort(t,e+4),o},r.GSUB={},r.GSUB.parse=function(t,e,a,o){return r._lctf.parse(t,e,a,o,r.GSUB.subt)},r.GSUB.subt=function(t,e,a,o){var n=r._bin,i=a,s={};if(s.fmt=n.readUshort(t,a),a+=2,e!=1&&e!=2&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==2||e==4||e==5&&s.fmt<=2||e==6&&s.fmt<=2){var u=n.readUshort(t,a);a+=2,s.coverage=r._lctf.readCoverage(t,i+u)}if(e==1&&s.fmt>=1&&s.fmt<=2){if(s.fmt==1)s.delta=n.readShort(t,a),a+=2;else if(s.fmt==2){var h=n.readUshort(t,a);a+=2,s.newg=n.readUshorts(t,a,h),a+=2*s.newg.length}}else if(e==2&&s.fmt==1){h=n.readUshort(t,a),a+=2,s.seqs=[];for(var d=0;d<h;d++){var v=n.readUshort(t,a)+i;a+=2;var g=n.readUshort(t,v);s.seqs.push(n.readUshorts(t,v+2,g))}}else if(e==4)for(s.vals=[],h=n.readUshort(t,a),a+=2,d=0;d<h;d++){var m=n.readUshort(t,a);a+=2,s.vals.push(r.GSUB.readLigatureSet(t,i+m))}else if(e==5&&s.fmt==2){if(s.fmt==2){var E=n.readUshort(t,a);a+=2,s.cDef=r._lctf.readClassDef(t,i+E),s.scset=[];var x=n.readUshort(t,a);for(a+=2,d=0;d<x;d++){var _=n.readUshort(t,a);a+=2,s.scset.push(_==0?null:r.GSUB.readSubClassSet(t,i+_))}}}else if(e==6&&s.fmt==3){if(s.fmt==3){for(d=0;d<3;d++){h=n.readUshort(t,a),a+=2;for(var w=[],U=0;U<h;U++)w.push(r._lctf.readCoverage(t,i+n.readUshort(t,a+2*U)));a+=2*h,d==0&&(s.backCvg=w),d==1&&(s.inptCvg=w),d==2&&(s.ahedCvg=w)}h=n.readUshort(t,a),a+=2,s.lookupRec=r.GSUB.readSubstLookupRecords(t,a,h)}}else{if(e==7&&s.fmt==1){var D=n.readUshort(t,a);a+=2;var S=n.readUint(t,a);if(a+=4,o.ltype==9)o.ltype=D;else if(o.ltype!=D)throw"invalid extension substitution";return r.GSUB.subt(t,o.ltype,i+S)}console.debug("unsupported GSUB table LookupType",e,"format",s.fmt)}return s},r.GSUB.readSubClassSet=function(t,e){var a=r._bin.readUshort,o=e,n=[],i=a(t,e);e+=2;for(var s=0;s<i;s++){var u=a(t,e);e+=2,n.push(r.GSUB.readSubClassRule(t,o+u))}return n},r.GSUB.readSubClassRule=function(t,e){var a=r._bin.readUshort,o={},n=a(t,e),i=a(t,e+=2);e+=2,o.input=[];for(var s=0;s<n-1;s++)o.input.push(a(t,e)),e+=2;return o.substLookupRecords=r.GSUB.readSubstLookupRecords(t,e,i),o},r.GSUB.readSubstLookupRecords=function(t,e,a){for(var o=r._bin.readUshort,n=[],i=0;i<a;i++)n.push(o(t,e),o(t,e+2)),e+=4;return n},r.GSUB.readChainSubClassSet=function(t,e){var a=r._bin,o=e,n=[],i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var u=a.readUshort(t,e);e+=2,n.push(r.GSUB.readChainSubClassRule(t,o+u))}return n},r.GSUB.readChainSubClassRule=function(t,e){for(var a=r._bin,o={},n=["backtrack","input","lookahead"],i=0;i<n.length;i++){var s=a.readUshort(t,e);e+=2,i==1&&s--,o[n[i]]=a.readUshorts(t,e,s),e+=2*o[n[i]].length}return s=a.readUshort(t,e),e+=2,o.subst=a.readUshorts(t,e,2*s),e+=2*o.subst.length,o},r.GSUB.readLigatureSet=function(t,e){var a=r._bin,o=e,n=[],i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var u=a.readUshort(t,e);e+=2,n.push(r.GSUB.readLigature(t,o+u))}return n},r.GSUB.readLigature=function(t,e){var a=r._bin,o={chain:[]};o.nglyph=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2;for(var i=0;i<n-1;i++)o.chain.push(a.readUshort(t,e)),e+=2;return o},r.head={},r.head.parse=function(t,e,a){var o=r._bin,n={};return o.readFixed(t,e),e+=4,n.fontRevision=o.readFixed(t,e),e+=4,o.readUint(t,e),e+=4,o.readUint(t,e),e+=4,n.flags=o.readUshort(t,e),e+=2,n.unitsPerEm=o.readUshort(t,e),e+=2,n.created=o.readUint64(t,e),e+=8,n.modified=o.readUint64(t,e),e+=8,n.xMin=o.readShort(t,e),e+=2,n.yMin=o.readShort(t,e),e+=2,n.xMax=o.readShort(t,e),e+=2,n.yMax=o.readShort(t,e),e+=2,n.macStyle=o.readUshort(t,e),e+=2,n.lowestRecPPEM=o.readUshort(t,e),e+=2,n.fontDirectionHint=o.readShort(t,e),e+=2,n.indexToLocFormat=o.readShort(t,e),e+=2,n.glyphDataFormat=o.readShort(t,e),e+=2,n},r.hhea={},r.hhea.parse=function(t,e,a){var o=r._bin,n={};return o.readFixed(t,e),e+=4,n.ascender=o.readShort(t,e),e+=2,n.descender=o.readShort(t,e),e+=2,n.lineGap=o.readShort(t,e),e+=2,n.advanceWidthMax=o.readUshort(t,e),e+=2,n.minLeftSideBearing=o.readShort(t,e),e+=2,n.minRightSideBearing=o.readShort(t,e),e+=2,n.xMaxExtent=o.readShort(t,e),e+=2,n.caretSlopeRise=o.readShort(t,e),e+=2,n.caretSlopeRun=o.readShort(t,e),e+=2,n.caretOffset=o.readShort(t,e),e+=2,e+=8,n.metricDataFormat=o.readShort(t,e),e+=2,n.numberOfHMetrics=o.readUshort(t,e),e+=2,n},r.hmtx={},r.hmtx.parse=function(t,e,a,o){for(var n=r._bin,i={aWidth:[],lsBearing:[]},s=0,u=0,h=0;h<o.maxp.numGlyphs;h++)h<o.hhea.numberOfHMetrics&&(s=n.readUshort(t,e),e+=2,u=n.readShort(t,e),e+=2),i.aWidth.push(s),i.lsBearing.push(u);return i},r.kern={},r.kern.parse=function(t,e,a,o){var n=r._bin,i=n.readUshort(t,e);if(e+=2,i==1)return r.kern.parseV1(t,e-2,a,o);var s=n.readUshort(t,e);e+=2;for(var u={glyph1:[],rval:[]},h=0;h<s;h++){e+=2,a=n.readUshort(t,e),e+=2;var d=n.readUshort(t,e);e+=2;var v=d>>>8;if((v&=15)!=0)throw"unknown kern table format: "+v;e=r.kern.readFormat0(t,e,u)}return u},r.kern.parseV1=function(t,e,a,o){var n=r._bin;n.readFixed(t,e),e+=4;var i=n.readUint(t,e);e+=4;for(var s={glyph1:[],rval:[]},u=0;u<i;u++){n.readUint(t,e),e+=4;var h=n.readUshort(t,e);e+=2,n.readUshort(t,e),e+=2;var d=h>>>8;if((d&=15)!=0)throw"unknown kern table format: "+d;e=r.kern.readFormat0(t,e,s)}return s},r.kern.readFormat0=function(t,e,a){var o=r._bin,n=-1,i=o.readUshort(t,e);e+=2,o.readUshort(t,e),e+=2,o.readUshort(t,e),e+=2,o.readUshort(t,e),e+=2;for(var s=0;s<i;s++){var u=o.readUshort(t,e);e+=2;var h=o.readUshort(t,e);e+=2;var d=o.readShort(t,e);e+=2,u!=n&&(a.glyph1.push(u),a.rval.push({glyph2:[],vals:[]}));var v=a.rval[a.rval.length-1];v.glyph2.push(h),v.vals.push(d),n=u}return e},r.loca={},r.loca.parse=function(t,e,a,o){var n=r._bin,i=[],s=o.head.indexToLocFormat,u=o.maxp.numGlyphs+1;if(s==0)for(var h=0;h<u;h++)i.push(n.readUshort(t,e+(h<<1))<<1);if(s==1)for(h=0;h<u;h++)i.push(n.readUint(t,e+(h<<2)));return i},r.maxp={},r.maxp.parse=function(t,e,a){var o=r._bin,n={},i=o.readUint(t,e);return e+=4,n.numGlyphs=o.readUshort(t,e),e+=2,i==65536&&(n.maxPoints=o.readUshort(t,e),e+=2,n.maxContours=o.readUshort(t,e),e+=2,n.maxCompositePoints=o.readUshort(t,e),e+=2,n.maxCompositeContours=o.readUshort(t,e),e+=2,n.maxZones=o.readUshort(t,e),e+=2,n.maxTwilightPoints=o.readUshort(t,e),e+=2,n.maxStorage=o.readUshort(t,e),e+=2,n.maxFunctionDefs=o.readUshort(t,e),e+=2,n.maxInstructionDefs=o.readUshort(t,e),e+=2,n.maxStackElements=o.readUshort(t,e),e+=2,n.maxSizeOfInstructions=o.readUshort(t,e),e+=2,n.maxComponentElements=o.readUshort(t,e),e+=2,n.maxComponentDepth=o.readUshort(t,e),e+=2),n},r.name={},r.name.parse=function(t,e,a){var o=r._bin,n={};o.readUshort(t,e),e+=2;var i=o.readUshort(t,e);e+=2,o.readUshort(t,e);for(var s,u=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],h=e+=2,d=0;d<i;d++){var v=o.readUshort(t,e);e+=2;var g=o.readUshort(t,e);e+=2;var m=o.readUshort(t,e);e+=2;var E=o.readUshort(t,e);e+=2;var x=o.readUshort(t,e);e+=2;var _=o.readUshort(t,e);e+=2;var w,U=u[E],D=h+12*i+_;if(v==0)w=o.readUnicode(t,D,x/2);else if(v==3&&g==0)w=o.readUnicode(t,D,x/2);else if(g==0)w=o.readASCII(t,D,x);else if(g==1)w=o.readUnicode(t,D,x/2);else if(g==3)w=o.readUnicode(t,D,x/2);else{if(v!=1)throw"unknown encoding "+g+", platformID: "+v;w=o.readASCII(t,D,x),console.debug("reading unknown MAC encoding "+g+" as ASCII")}var S="p"+v+","+m.toString(16);n[S]==null&&(n[S]={}),n[S][U!==void 0?U:E]=w,n[S]._lang=m}for(var T in n)if(n[T].postScriptName!=null&&n[T]._lang==1033)return n[T];for(var T in n)if(n[T].postScriptName!=null&&n[T]._lang==0)return n[T];for(var T in n)if(n[T].postScriptName!=null&&n[T]._lang==3084)return n[T];for(var T in n)if(n[T].postScriptName!=null)return n[T];for(var T in n){s=T;break}return console.debug("returning name table with languageID "+n[s]._lang),n[s]},r["OS/2"]={},r["OS/2"].parse=function(t,e,a){var o=r._bin.readUshort(t,e);e+=2;var n={};if(o==0)r["OS/2"].version0(t,e,n);else if(o==1)r["OS/2"].version1(t,e,n);else if(o==2||o==3||o==4)r["OS/2"].version2(t,e,n);else{if(o!=5)throw"unknown OS/2 table version: "+o;r["OS/2"].version5(t,e,n)}return n},r["OS/2"].version0=function(t,e,a){var o=r._bin;return a.xAvgCharWidth=o.readShort(t,e),e+=2,a.usWeightClass=o.readUshort(t,e),e+=2,a.usWidthClass=o.readUshort(t,e),e+=2,a.fsType=o.readUshort(t,e),e+=2,a.ySubscriptXSize=o.readShort(t,e),e+=2,a.ySubscriptYSize=o.readShort(t,e),e+=2,a.ySubscriptXOffset=o.readShort(t,e),e+=2,a.ySubscriptYOffset=o.readShort(t,e),e+=2,a.ySuperscriptXSize=o.readShort(t,e),e+=2,a.ySuperscriptYSize=o.readShort(t,e),e+=2,a.ySuperscriptXOffset=o.readShort(t,e),e+=2,a.ySuperscriptYOffset=o.readShort(t,e),e+=2,a.yStrikeoutSize=o.readShort(t,e),e+=2,a.yStrikeoutPosition=o.readShort(t,e),e+=2,a.sFamilyClass=o.readShort(t,e),e+=2,a.panose=o.readBytes(t,e,10),e+=10,a.ulUnicodeRange1=o.readUint(t,e),e+=4,a.ulUnicodeRange2=o.readUint(t,e),e+=4,a.ulUnicodeRange3=o.readUint(t,e),e+=4,a.ulUnicodeRange4=o.readUint(t,e),e+=4,a.achVendID=[o.readInt8(t,e),o.readInt8(t,e+1),o.readInt8(t,e+2),o.readInt8(t,e+3)],e+=4,a.fsSelection=o.readUshort(t,e),e+=2,a.usFirstCharIndex=o.readUshort(t,e),e+=2,a.usLastCharIndex=o.readUshort(t,e),e+=2,a.sTypoAscender=o.readShort(t,e),e+=2,a.sTypoDescender=o.readShort(t,e),e+=2,a.sTypoLineGap=o.readShort(t,e),e+=2,a.usWinAscent=o.readUshort(t,e),e+=2,a.usWinDescent=o.readUshort(t,e),e+=2},r["OS/2"].version1=function(t,e,a){var o=r._bin;return e=r["OS/2"].version0(t,e,a),a.ulCodePageRange1=o.readUint(t,e),e+=4,a.ulCodePageRange2=o.readUint(t,e),e+=4},r["OS/2"].version2=function(t,e,a){var o=r._bin;return e=r["OS/2"].version1(t,e,a),a.sxHeight=o.readShort(t,e),e+=2,a.sCapHeight=o.readShort(t,e),e+=2,a.usDefault=o.readUshort(t,e),e+=2,a.usBreak=o.readUshort(t,e),e+=2,a.usMaxContext=o.readUshort(t,e),e+=2},r["OS/2"].version5=function(t,e,a){var o=r._bin;return e=r["OS/2"].version2(t,e,a),a.usLowerOpticalPointSize=o.readUshort(t,e),e+=2,a.usUpperOpticalPointSize=o.readUshort(t,e),e+=2},r.post={},r.post.parse=function(t,e,a){var o=r._bin,n={};return n.version=o.readFixed(t,e),e+=4,n.italicAngle=o.readFixed(t,e),e+=4,n.underlinePosition=o.readShort(t,e),e+=2,n.underlineThickness=o.readShort(t,e),e+=2,n},r==null&&(r={}),r.U==null&&(r.U={}),r.U.codeToGlyph=function(t,e){var a=t.cmap,o=-1;if(a.p0e4!=null?o=a.p0e4:a.p3e1!=null?o=a.p3e1:a.p1e0!=null?o=a.p1e0:a.p0e3!=null&&(o=a.p0e3),o==-1)throw"no familiar platform and encoding!";var n=a.tables[o];if(n.format==0)return e>=n.map.length?0:n.map[e];if(n.format==4){for(var i=-1,s=0;s<n.endCount.length;s++)if(e<=n.endCount[s]){i=s;break}return i==-1||n.startCount[i]>e?0:65535&(n.idRangeOffset[i]!=0?n.glyphIdArray[e-n.startCount[i]+(n.idRangeOffset[i]>>1)-(n.idRangeOffset.length-i)]:e+n.idDelta[i])}if(n.format==12){if(e>n.groups[n.groups.length-1][1])return 0;for(s=0;s<n.groups.length;s++){var u=n.groups[s];if(u[0]<=e&&e<=u[1])return u[2]+(e-u[0])}return 0}throw"unknown cmap table format "+n.format},r.U.glyphToPath=function(t,e){var a={cmds:[],crds:[]};if(t.SVG&&t.SVG.entries[e]){var o=t.SVG.entries[e];return o==null?a:(typeof o=="string"&&(o=r.SVG.toPath(o),t.SVG.entries[e]=o),o)}if(t.CFF){var n={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:t.CFF.Private?t.CFF.Private.defaultWidthX:0,open:!1},i=t.CFF,s=t.CFF.Private;if(i.ROS){for(var u=0;i.FDSelect[u+2]<=e;)u+=2;s=i.FDArray[i.FDSelect[u+1]].Private}r.U._drawCFF(t.CFF.CharStrings[e],n,i,s,a)}else t.glyf&&r.U._drawGlyf(e,t,a);return a},r.U._drawGlyf=function(t,e,a){var o=e.glyf[t];o==null&&(o=e.glyf[t]=r.glyf._parseGlyf(e,t)),o!=null&&(o.noc>-1?r.U._simpleGlyph(o,a):r.U._compoGlyph(o,e,a))},r.U._simpleGlyph=function(t,e){for(var a=0;a<t.noc;a++){for(var o=a==0?0:t.endPts[a-1]+1,n=t.endPts[a],i=o;i<=n;i++){var s=i==o?n:i-1,u=i==n?o:i+1,h=1&t.flags[i],d=1&t.flags[s],v=1&t.flags[u],g=t.xs[i],m=t.ys[i];if(i==o)if(h){if(!d){r.U.P.moveTo(e,g,m);continue}r.U.P.moveTo(e,t.xs[s],t.ys[s])}else d?r.U.P.moveTo(e,t.xs[s],t.ys[s]):r.U.P.moveTo(e,(t.xs[s]+g)/2,(t.ys[s]+m)/2);h?d&&r.U.P.lineTo(e,g,m):v?r.U.P.qcurveTo(e,g,m,t.xs[u],t.ys[u]):r.U.P.qcurveTo(e,g,m,(g+t.xs[u])/2,(m+t.ys[u])/2)}r.U.P.closePath(e)}},r.U._compoGlyph=function(t,e,a){for(var o=0;o<t.parts.length;o++){var n={cmds:[],crds:[]},i=t.parts[o];r.U._drawGlyf(i.glyphIndex,e,n);for(var s=i.m,u=0;u<n.crds.length;u+=2){var h=n.crds[u],d=n.crds[u+1];a.crds.push(h*s.a+d*s.b+s.tx),a.crds.push(h*s.c+d*s.d+s.ty)}for(u=0;u<n.cmds.length;u++)a.cmds.push(n.cmds[u])}},r.U._getGlyphClass=function(t,e){var a=r._lctf.getInterval(e,t);return a==-1?0:e[a+2]},r.U._applySubs=function(t,e,a,o){for(var n=t.length-e-1,i=0;i<a.tabs.length;i++)if(a.tabs[i]!=null){var s,u=a.tabs[i];if(!u.coverage||(s=r._lctf.coverageIndex(u.coverage,t[e]))!=-1){if(a.ltype==1)t[e],u.fmt==1?t[e]=t[e]+u.delta:t[e]=u.newg[s];else if(a.ltype==4)for(var h=u.vals[s],d=0;d<h.length;d++){var v=h[d],g=v.chain.length;if(!(g>n)){for(var m=!0,E=0,x=0;x<g;x++){for(;t[e+E+(1+x)]==-1;)E++;v.chain[x]!=t[e+E+(1+x)]&&(m=!1)}if(m){for(t[e]=v.nglyph,x=0;x<g+E;x++)t[e+x+1]=-1;break}}}else if(a.ltype==5&&u.fmt==2)for(var _=r._lctf.getInterval(u.cDef,t[e]),w=u.cDef[_+2],U=u.scset[w],D=0;D<U.length;D++){var S=U[D],T=S.input;if(!(T.length>n)){for(m=!0,x=0;x<T.length;x++){var O=r._lctf.getInterval(u.cDef,t[e+1+x]);if(_==-1&&u.cDef[O+2]!=T[x]){m=!1;break}}if(m){var G=S.substLookupRecords;for(d=0;d<G.length;d+=2)G[d],G[d+1]}}}else if(a.ltype==6&&u.fmt==3){if(!r.U._glsCovered(t,u.backCvg,e-u.backCvg.length)||!r.U._glsCovered(t,u.inptCvg,e)||!r.U._glsCovered(t,u.ahedCvg,e+u.inptCvg.length))continue;var K=u.lookupRec;for(D=0;D<K.length;D+=2){_=K[D];var y=o[K[D+1]];r.U._applySubs(t,e+_,y,o)}}}}},r.U._glsCovered=function(t,e,a){for(var o=0;o<e.length;o++)if(r._lctf.coverageIndex(e[o],t[a+o])==-1)return!1;return!0},r.U.glyphsToPath=function(t,e,a){for(var o={cmds:[],crds:[]},n=0,i=0;i<e.length;i++){var s=e[i];if(s!=-1){for(var u=i<e.length-1&&e[i+1]!=-1?e[i+1]:0,h=r.U.glyphToPath(t,s),d=0;d<h.crds.length;d+=2)o.crds.push(h.crds[d]+n),o.crds.push(h.crds[d+1]);for(a&&o.cmds.push(a),d=0;d<h.cmds.length;d++)o.cmds.push(h.cmds[d]);a&&o.cmds.push("X"),n+=t.hmtx.aWidth[s],i<e.length-1&&(n+=r.U.getPairAdjustment(t,s,u))}}return o},r.U.P={},r.U.P.moveTo=function(t,e,a){t.cmds.push("M"),t.crds.push(e,a)},r.U.P.lineTo=function(t,e,a){t.cmds.push("L"),t.crds.push(e,a)},r.U.P.curveTo=function(t,e,a,o,n,i,s){t.cmds.push("C"),t.crds.push(e,a,o,n,i,s)},r.U.P.qcurveTo=function(t,e,a,o,n){t.cmds.push("Q"),t.crds.push(e,a,o,n)},r.U.P.closePath=function(t){t.cmds.push("Z")},r.U._drawCFF=function(t,e,a,o,n){for(var i=e.stack,s=e.nStems,u=e.haveWidth,h=e.width,d=e.open,v=0,g=e.x,m=e.y,E=0,x=0,_=0,w=0,U=0,D=0,S=0,T=0,O=0,G=0,K={val:0,size:0};v<t.length;){r.CFF.getCharString(t,v,K);var y=K.val;if(v+=K.size,y=="o1"||y=="o18")i.length%2!=0&&!u&&(h=i.shift()+o.nominalWidthX),s+=i.length>>1,i.length=0,u=!0;else if(y=="o3"||y=="o23")i.length%2!=0&&!u&&(h=i.shift()+o.nominalWidthX),s+=i.length>>1,i.length=0,u=!0;else if(y=="o4")i.length>1&&!u&&(h=i.shift()+o.nominalWidthX,u=!0),d&&r.U.P.closePath(n),m+=i.pop(),r.U.P.moveTo(n,g,m),d=!0;else if(y=="o5")for(;i.length>0;)g+=i.shift(),m+=i.shift(),r.U.P.lineTo(n,g,m);else if(y=="o6"||y=="o7")for(var R=i.length,A=y=="o6",j=0;j<R;j++){var z=i.shift();A?g+=z:m+=z,A=!A,r.U.P.lineTo(n,g,m)}else if(y=="o8"||y=="o24"){R=i.length;for(var X=0;X+6<=R;)E=g+i.shift(),x=m+i.shift(),_=E+i.shift(),w=x+i.shift(),g=_+i.shift(),m=w+i.shift(),r.U.P.curveTo(n,E,x,_,w,g,m),X+=6;y=="o24"&&(g+=i.shift(),m+=i.shift(),r.U.P.lineTo(n,g,m))}else{if(y=="o11")break;if(y=="o1234"||y=="o1235"||y=="o1236"||y=="o1237")y=="o1234"&&(x=m,_=(E=g+i.shift())+i.shift(),G=w=x+i.shift(),D=w,T=m,g=(S=(U=(O=_+i.shift())+i.shift())+i.shift())+i.shift(),r.U.P.curveTo(n,E,x,_,w,O,G),r.U.P.curveTo(n,U,D,S,T,g,m)),y=="o1235"&&(E=g+i.shift(),x=m+i.shift(),_=E+i.shift(),w=x+i.shift(),O=_+i.shift(),G=w+i.shift(),U=O+i.shift(),D=G+i.shift(),S=U+i.shift(),T=D+i.shift(),g=S+i.shift(),m=T+i.shift(),i.shift(),r.U.P.curveTo(n,E,x,_,w,O,G),r.U.P.curveTo(n,U,D,S,T,g,m)),y=="o1236"&&(E=g+i.shift(),x=m+i.shift(),_=E+i.shift(),G=w=x+i.shift(),D=w,S=(U=(O=_+i.shift())+i.shift())+i.shift(),T=D+i.shift(),g=S+i.shift(),r.U.P.curveTo(n,E,x,_,w,O,G),r.U.P.curveTo(n,U,D,S,T,g,m)),y=="o1237"&&(E=g+i.shift(),x=m+i.shift(),_=E+i.shift(),w=x+i.shift(),O=_+i.shift(),G=w+i.shift(),U=O+i.shift(),D=G+i.shift(),S=U+i.shift(),T=D+i.shift(),Math.abs(S-g)>Math.abs(T-m)?g=S+i.shift():m=T+i.shift(),r.U.P.curveTo(n,E,x,_,w,O,G),r.U.P.curveTo(n,U,D,S,T,g,m));else if(y=="o14"){if(i.length>0&&!u&&(h=i.shift()+a.nominalWidthX,u=!0),i.length==4){var q=i.shift(),F=i.shift(),L=i.shift(),p=i.shift(),b=r.CFF.glyphBySE(a,L),M=r.CFF.glyphBySE(a,p);r.U._drawCFF(a.CharStrings[b],e,a,o,n),e.x=q,e.y=F,r.U._drawCFF(a.CharStrings[M],e,a,o,n)}d&&(r.U.P.closePath(n),d=!1)}else if(y=="o19"||y=="o20")i.length%2!=0&&!u&&(h=i.shift()+o.nominalWidthX),s+=i.length>>1,i.length=0,u=!0,v+=s+7>>3;else if(y=="o21")i.length>2&&!u&&(h=i.shift()+o.nominalWidthX,u=!0),m+=i.pop(),g+=i.pop(),d&&r.U.P.closePath(n),r.U.P.moveTo(n,g,m),d=!0;else if(y=="o22")i.length>1&&!u&&(h=i.shift()+o.nominalWidthX,u=!0),g+=i.pop(),d&&r.U.P.closePath(n),r.U.P.moveTo(n,g,m),d=!0;else if(y=="o25"){for(;i.length>6;)g+=i.shift(),m+=i.shift(),r.U.P.lineTo(n,g,m);E=g+i.shift(),x=m+i.shift(),_=E+i.shift(),w=x+i.shift(),g=_+i.shift(),m=w+i.shift(),r.U.P.curveTo(n,E,x,_,w,g,m)}else if(y=="o26")for(i.length%2&&(g+=i.shift());i.length>0;)E=g,x=m+i.shift(),g=_=E+i.shift(),m=(w=x+i.shift())+i.shift(),r.U.P.curveTo(n,E,x,_,w,g,m);else if(y=="o27")for(i.length%2&&(m+=i.shift());i.length>0;)x=m,_=(E=g+i.shift())+i.shift(),w=x+i.shift(),g=_+i.shift(),m=w,r.U.P.curveTo(n,E,x,_,w,g,m);else if(y=="o10"||y=="o29"){var C=y=="o10"?o:a;if(i.length==0)console.debug("error: empty stack");else{var k=i.pop(),N=C.Subrs[k+C.Bias];e.x=g,e.y=m,e.nStems=s,e.haveWidth=u,e.width=h,e.open=d,r.U._drawCFF(N,e,a,o,n),g=e.x,m=e.y,s=e.nStems,u=e.haveWidth,h=e.width,d=e.open}}else if(y=="o30"||y=="o31"){var P=i.length,B=(X=0,y=="o31");for(X+=P-(R=-3&P);X<R;)B?(x=m,_=(E=g+i.shift())+i.shift(),m=(w=x+i.shift())+i.shift(),R-X==5?(g=_+i.shift(),X++):g=_,B=!1):(E=g,x=m+i.shift(),_=E+i.shift(),w=x+i.shift(),g=_+i.shift(),R-X==5?(m=w+i.shift(),X++):m=w,B=!0),r.U.P.curveTo(n,E,x,_,w,g,m),X+=4}else{if((y+"").charAt(0)=="o")throw console.debug("Unknown operation: "+y,t),y;i.push(y)}}}e.x=g,e.y=m,e.nStems=s,e.haveWidth=u,e.width=h,e.open=d};var c=r,f={Typr:c};return l.Typr=c,l.default=f,Object.defineProperty(l,"__esModule",{value:!0}),l}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function Go(){return function(l){var r=Uint8Array,c=Uint16Array,f=Uint32Array,t=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(y,R){for(var A=new c(31),j=0;j<31;++j)A[j]=R+=1<<y[j-1];var z=new f(A[30]);for(j=1;j<30;++j)for(var X=A[j];X<A[j+1];++X)z[X]=X-A[j]<<5|j;return[A,z]},n=o(t,2),i=n[0],s=n[1];i[28]=258,s[258]=28;for(var u=o(e,0)[0],h=new c(32768),d=0;d<32768;++d){var v=(43690&d)>>>1|(21845&d)<<1;v=(61680&(v=(52428&v)>>>2|(13107&v)<<2))>>>4|(3855&v)<<4,h[d]=((65280&v)>>>8|(255&v)<<8)>>>1}var g=function(y,R,A){for(var j=y.length,z=0,X=new c(R);z<j;++z)++X[y[z]-1];var q,F=new c(R);for(z=0;z<R;++z)F[z]=F[z-1]+X[z-1]<<1;{q=new c(1<<R);var L=15-R;for(z=0;z<j;++z)if(y[z])for(var p=z<<4|y[z],b=R-y[z],M=F[y[z]-1]++<<b,C=M|(1<<b)-1;M<=C;++M)q[h[M]>>>L]=p}return q},m=new r(288);for(d=0;d<144;++d)m[d]=8;for(d=144;d<256;++d)m[d]=9;for(d=256;d<280;++d)m[d]=7;for(d=280;d<288;++d)m[d]=8;var E=new r(32);for(d=0;d<32;++d)E[d]=5;var x=g(m,9),_=g(E,5),w=function(y){for(var R=y[0],A=1;A<y.length;++A)y[A]>R&&(R=y[A]);return R},U=function(y,R,A){var j=R/8|0;return(y[j]|y[j+1]<<8)>>(7&R)&A},D=function(y,R){var A=R/8|0;return(y[A]|y[A+1]<<8|y[A+2]<<16)>>(7&R)},S=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],T=function(y,R,A){var j=new Error(R||S[y]);if(j.code=y,Error.captureStackTrace&&Error.captureStackTrace(j,T),!A)throw j;return j},O=function(y,R,A){var j=y.length;if(!j||A&&!A.l&&j<5)return R||new r(0);var z=!R||A,X=!A||A.i;A||(A={}),R||(R=new r(3*j));var q,F=function(le){var Ae=R.length;if(le>Ae){var _e=new r(Math.max(2*Ae,le));_e.set(R),R=_e}},L=A.f||0,p=A.p||0,b=A.b||0,M=A.l,C=A.d,k=A.m,N=A.n,P=8*j;do{if(!M){A.f=L=U(y,p,1);var B=U(y,p+1,3);if(p+=3,!B){var Y=y[(ee=((q=p)/8|0)+(7&q&&1)+4)-4]|y[ee-3]<<8,$=ee+Y;if($>j){X&&T(0);break}z&&F(b+Y),R.set(y.subarray(ee,$),b),A.b=b+=Y,A.p=p=8*$;continue}if(B==1)M=x,C=_,k=9,N=5;else if(B==2){var H=U(y,p,31)+257,W=U(y,p+10,15)+4,he=H+U(y,p+5,31)+1;p+=14;for(var ce=new r(he),Z=new r(19),te=0;te<W;++te)Z[a[te]]=U(y,p+3*te,7);p+=3*W;var se=w(Z),V=(1<<se)-1,re=g(Z,se);for(te=0;te<he;){var ee,I=re[U(y,p,V)];if(p+=15&I,(ee=I>>>4)<16)ce[te++]=ee;else{var de=0,Q=0;for(ee==16?(Q=3+U(y,p,3),p+=2,de=ce[te-1]):ee==17?(Q=3+U(y,p,7),p+=3):ee==18&&(Q=11+U(y,p,127),p+=7);Q--;)ce[te++]=de}}var ae=ce.subarray(0,H),J=ce.subarray(H);k=w(ae),N=w(J),M=g(ae,k),C=g(J,N)}else T(1);if(p>P){X&&T(0);break}}z&&F(b+131072);for(var be=(1<<k)-1,ne=(1<<N)-1,oe=p;;oe=p){var fe=(de=M[D(y,p)&be])>>>4;if((p+=15&de)>P){X&&T(0);break}if(de||T(2),fe<256)R[b++]=fe;else{if(fe==256){oe=p,M=null;break}var pe=fe-254;if(fe>264){var Se=t[te=fe-257];pe=U(y,p,(1<<Se)-1)+i[te],p+=Se}var Me=C[D(y,p)&ne],ge=Me>>>4;if(Me||T(3),p+=15&Me,J=u[ge],ge>3&&(Se=e[ge],J+=D(y,p)&(1<<Se)-1,p+=Se),p>P){X&&T(0);break}z&&F(b+131072);for(var me=b+pe;b<me;b+=4)R[b]=R[b-J],R[b+1]=R[b+1-J],R[b+2]=R[b+2-J],R[b+3]=R[b+3-J];b=me}}A.l=M,A.p=oe,A.b=b,M&&(L=1,A.m=k,A.d=C,A.n=N)}while(!L);return b==R.length?R:function(le,Ae,_e){(_e==null||_e>le.length)&&(_e=le.length);var Oe=new(le instanceof c?c:le instanceof f?f:r)(_e-Ae);return Oe.set(le.subarray(Ae,_e)),Oe}(R,0,b)},G=new r(0),K=typeof TextDecoder<"u"&&new TextDecoder;try{K.decode(G,{stream:!0})}catch{}return l.convert_streams=function(y){var R=new DataView(y),A=0;function j(){var H=R.getUint16(A);return A+=2,H}function z(){var H=R.getUint32(A);return A+=4,H}function X(H){Y.setUint16($,H),$+=2}function q(H){Y.setUint32($,H),$+=4}for(var F={signature:z(),flavor:z(),length:z(),numTables:j(),reserved:j(),totalSfntSize:z(),majorVersion:j(),minorVersion:j(),metaOffset:z(),metaLength:z(),metaOrigLength:z(),privOffset:z(),privLength:z()},L=0;Math.pow(2,L)<=F.numTables;)L++;L--;for(var p=16*Math.pow(2,L),b=16*F.numTables-p,M=12,C=[],k=0;k<F.numTables;k++)C.push({tag:z(),offset:z(),compLength:z(),origLength:z(),origChecksum:z()}),M+=16;var N,P=new Uint8Array(12+16*C.length+C.reduce(function(H,W){return H+W.origLength+4},0)),B=P.buffer,Y=new DataView(B),$=0;return q(F.flavor),X(F.numTables),X(p),X(L),X(b),C.forEach(function(H){q(H.tag),q(H.origChecksum),q(M),q(H.origLength),H.outOffset=M,(M+=H.origLength)%4!=0&&(M+=4-M%4)}),C.forEach(function(H){var W,he=y.slice(H.offset,H.offset+H.compLength);if(H.compLength!=H.origLength){var ce=new Uint8Array(H.origLength);W=new Uint8Array(he,2),O(W,ce)}else ce=new Uint8Array(he);P.set(ce,H.outOffset);var Z=0;(M=H.outOffset+H.origLength)%4!=0&&(Z=4-M%4),P.set(new Uint8Array(Z).buffer,H.outOffset+H.origLength),N=M+Z}),B.slice(0,N)},Object.defineProperty(l,"__esModule",{value:!0}),l}({}).convert_streams}function Oo(l,r){const c={M:2,L:2,Q:4,C:6,Z:0},f={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},t=1,e=2,a=4,o=8,n=16,i=32;let s;function u(S){if(!s){const T={R:e,L:t,D:a,C:n,U:i,T:o};s=new Map;for(let O in f){let G=0;f[O].split(",").forEach(K=>{let[y,R]=K.split("+");y=parseInt(y,36),R=R?parseInt(R,36):0,s.set(G+=y,T[O]);for(let A=R;A--;)s.set(++G,T[O])})}}return s.get(S)||i}const h=1,d=2,v=3,g=4,m=[null,"isol","init","fina","medi"];function E(S){const T=new Uint8Array(S.length);let O=i,G=h,K=-1;for(let y=0;y<S.length;y++){const R=S.codePointAt(y);let A=u(R)|0,j=h;A&o||(O&(t|a|n)?A&(e|a|n)?(j=v,(G===h||G===v)&&T[K]++):A&(t|i)&&(G===d||G===g)&&T[K]--:O&(e|i)&&(G===d||G===g)&&T[K]--,G=T[y]=j,O=A,K=y,R>65535&&y++)}return T}function x(S,T){const O=[];for(let K=0;K<T.length;K++){const y=T.codePointAt(K);y>65535&&K++,O.push(l.U.codeToGlyph(S,y))}const G=S.GSUB;if(G){const{lookupList:K,featureList:y}=G;let R;const A=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,j=[];y.forEach(z=>{if(A.test(z.tag))for(let X=0;X<z.tab.length;X++){if(j[z.tab[X]])continue;j[z.tab[X]]=!0;const q=K[z.tab[X]],F=/^(isol|init|fina|medi)$/.test(z.tag);F&&!R&&(R=E(T));for(let L=0;L<O.length;L++)(!R||!F||m[R[L]]===z.tag)&&l.U._applySubs(O,L,q,K)}})}return O}function _(S,T){const O=new Int16Array(T.length*3);let G=0;for(;G<T.length;G++){const A=T[G];if(A===-1)continue;O[G*3+2]=S.hmtx.aWidth[A];const j=S.GPOS;if(j){const z=j.lookupList;for(let X=0;X<z.length;X++){const q=z[X];for(let F=0;F<q.tabs.length;F++){const L=q.tabs[F];if(q.ltype===1){if(l._lctf.coverageIndex(L.coverage,A)!==-1&&L.pos){R(L.pos,G);break}}else if(q.ltype===2){let p=null,b=K();if(b!==-1){const M=l._lctf.coverageIndex(L.coverage,T[b]);if(M!==-1){if(L.fmt===1){const C=L.pairsets[M];for(let k=0;k<C.length;k++)C[k].gid2===A&&(p=C[k])}else if(L.fmt===2){const C=l.U._getGlyphClass(T[b],L.classDef1),k=l.U._getGlyphClass(A,L.classDef2);p=L.matrix[C][k]}if(p){p.val1&&R(p.val1,b),p.val2&&R(p.val2,G);break}}}}else if(q.ltype===4){const p=l._lctf.coverageIndex(L.markCoverage,A);if(p!==-1){const b=K(y),M=b===-1?-1:l._lctf.coverageIndex(L.baseCoverage,T[b]);if(M!==-1){const C=L.markArray[p],k=L.baseArray[M][C.markClass];O[G*3]=k.x-C.x+O[b*3]-O[b*3+2],O[G*3+1]=k.y-C.y+O[b*3+1];break}}}else if(q.ltype===6){const p=l._lctf.coverageIndex(L.mark1Coverage,A);if(p!==-1){const b=K();if(b!==-1){const M=T[b];if(w(S,M)===3){const C=l._lctf.coverageIndex(L.mark2Coverage,M);if(C!==-1){const k=L.mark1Array[p],N=L.mark2Array[C][k.markClass];O[G*3]=N.x-k.x+O[b*3]-O[b*3+2],O[G*3+1]=N.y-k.y+O[b*3+1];break}}}}}}}}else if(S.kern&&!S.cff){const z=K();if(z!==-1){const X=S.kern.glyph1.indexOf(T[z]);if(X!==-1){const q=S.kern.rval[X].glyph2.indexOf(A);q!==-1&&(O[z*3+2]+=S.kern.rval[X].vals[q])}}}}return O;function K(A){for(let j=G-1;j>=0;j--)if(T[j]!==-1&&(!A||A(T[j])))return j;return-1}function y(A){return w(S,A)===1}function R(A,j){for(let z=0;z<3;z++)O[j*3+z]+=A[z]||0}}function w(S,T){const O=S.GDEF&&S.GDEF.glyphClassDef;return O?l.U._getGlyphClass(T,O):0}function U(...S){for(let T=0;T<S.length;T++)if(typeof S[T]=="number")return S[T]}function D(S){const T=Object.create(null),O=S["OS/2"],G=S.hhea,K=S.head.unitsPerEm,y=U(O&&O.sTypoAscender,G&&G.ascender,K),R={unitsPerEm:K,ascender:y,descender:U(O&&O.sTypoDescender,G&&G.descender,0),capHeight:U(O&&O.sCapHeight,y),xHeight:U(O&&O.sxHeight,y),lineGap:U(O&&O.sTypoLineGap,G&&G.lineGap),supportsCodePoint(A){return l.U.codeToGlyph(S,A)>0},forEachGlyph(A,j,z,X){let q=0;const F=1/R.unitsPerEm*j,L=x(S,A);let p=0;const b=_(S,L);return L.forEach((M,C)=>{if(M!==-1){let k=T[M];if(!k){const{cmds:N,crds:P}=l.U.glyphToPath(S,M);let B="",Y=0;for(let ce=0,Z=N.length;ce<Z;ce++){const te=c[N[ce]];B+=N[ce];for(let se=1;se<=te;se++)B+=(se>1?",":"")+P[Y++]}let $,H,W,he;if(P.length){$=H=1/0,W=he=-1/0;for(let ce=0,Z=P.length;ce<Z;ce+=2){let te=P[ce],se=P[ce+1];te<$&&($=te),se<H&&(H=se),te>W&&(W=te),se>he&&(he=se)}}else $=W=H=he=0;k=T[M]={index:M,advanceWidth:S.hmtx.aWidth[M],xMin:$,yMin:H,xMax:W,yMax:he,path:B}}X.call(null,k,q+b[C*3]*F,b[C*3+1]*F,p),q+=b[C*3+2]*F,z&&(q+=z*j)}p+=A.codePointAt(p)>65535?2:1}),q}};return R}return function(T){const O=new Uint8Array(T,0,4),G=l._bin.readASCII(O,0,4);if(G==="wOFF")T=r(T);else if(G==="wOF2")throw new Error("woff2 fonts not supported");return D(l.parse(T)[0])}}const Io=At({name:"Typr Font Parser",dependencies:[Po,Go,Oo],init(l,r,c){const f=l(),t=r();return c(f,t)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function Bo(){return function(l){var r=function(){this.buckets=new Map};r.prototype.add=function(_){var w=_>>5;this.buckets.set(w,(this.buckets.get(w)||0)|1<<(31&_))},r.prototype.has=function(_){var w=this.buckets.get(_>>5);return w!==void 0&&(w&1<<(31&_))!=0},r.prototype.serialize=function(){var _=[];return this.buckets.forEach(function(w,U){_.push((+U).toString(36)+":"+w.toString(36))}),_.join(",")},r.prototype.deserialize=function(_){var w=this;this.buckets.clear(),_.split(",").forEach(function(U){var D=U.split(":");w.buckets.set(parseInt(D[0],36),parseInt(D[1],36))})};var c=Math.pow(2,8),f=c-1,t=~f;function e(_){var w=function(D){return D&t}(_).toString(16),U=function(D){return(D&t)+c-1}(_).toString(16);return"codepoint-index/plane"+(_>>16)+"/"+w+"-"+U+".json"}function a(_,w){var U=_&f,D=w.codePointAt(U/6|0);return((D=(D||48)-48)&1<<U%6)!=0}function o(_,w){var U;(U=_,U.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(D){return D.split("-").map(function(S){return parseInt(S.trim(),16)})})).forEach(function(D){var S=D[0],T=D[1];T===void 0&&(T=S),w(S,T)})}function n(_,w){o(_,function(U,D){for(var S=U;S<=D;S++)w(S)})}var i={},s={},u=new WeakMap,h="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function d(_){var w=u.get(_);return w||(w=new r,n(_.ranges,function(U){return w.add(U)}),u.set(_,w)),w}var v,g=new Map;function m(_,w,U){return _[w]?w:_[U]?U:function(D){for(var S in D)return S}(_)}function E(_,w){var U=w;if(!_.includes(U)){U=1/0;for(var D=0;D<_.length;D++)Math.abs(_[D]-w)<Math.abs(U-w)&&(U=_[D])}return U}function x(_){return v||(v=new Set,n("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(w){v.add(w)})),v.has(_)}return l.CodePointSet=r,l.clearCache=function(){i={},s={}},l.getFontsForString=function(_,w){w===void 0&&(w={});var U,D=w.lang;D===void 0&&(D=/\p{Script=Hangul}/u.test(U=_)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(U)?"ja":"en");var S=w.category;S===void 0&&(S="sans-serif");var T=w.style;T===void 0&&(T="normal");var O=w.weight;O===void 0&&(O=400);var G=(w.dataUrl||h).replace(/\/$/g,""),K=new Map,y=new Uint8Array(_.length),R={},A={},j=new Array(_.length),z=new Map,X=!1;function q(p){var b=g.get(p);return b||(b=fetch(G+"/"+p).then(function(M){if(!M.ok)throw new Error(M.statusText);return M.json().then(function(C){if(!Array.isArray(C)||C[0]!==1)throw new Error("Incorrect schema version; need 1, got "+C[0]);return C[1]})}).catch(function(M){if(G!==h)return X||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+G+'", trying default CDN. '+M.message),X=!0),G=h,g.delete(p),q(p);throw M}),g.set(p,b)),b}for(var F=function(p){var b=_.codePointAt(p),M=e(b);j[p]=M,i[M]||z.has(M)||z.set(M,q(M).then(function(C){i[M]=C})),b>65535&&(p++,L=p)},L=0;L<_.length;L++)F(L);return Promise.all(z.values()).then(function(){z.clear();for(var p=function(M){var C=_.codePointAt(M),k=null,N=i[j[M]],P=void 0;for(var B in N){var Y=A[B];if(Y===void 0&&(Y=A[B]=new RegExp(B).test(D||"en")),Y){for(var $ in P=B,N[B])if(a(C,N[B][$])){k=$;break}break}}if(!k){e:for(var H in N)if(H!==P){for(var W in N[H])if(a(C,N[H][W])){k=W;break e}}}k||(console.debug("No font coverage for U+"+C.toString(16)),k="latin"),j[M]=k,s[k]||z.has(k)||z.set(k,q("font-meta/"+k+".json").then(function(he){s[k]=he})),C>65535&&(M++,b=M)},b=0;b<_.length;b++)p(b);return Promise.all(z.values())}).then(function(){for(var p,b=null,M=0;M<_.length;M++){var C=_.codePointAt(M);if(b&&(x(C)||d(b).has(C)))y[M]=y[M-1];else{b=s[j[M]];var k=R[b.id];if(!k){var N=b.typeforms,P=m(N,S,"sans-serif"),B=m(N[P],T,"normal"),Y=E((p=N[P])===null||p===void 0?void 0:p[B],O);k=R[b.id]=G+"/font-files/"+b.id+"/"+P+"."+B+"."+Y+".woff"}var $=K.get(k);$==null&&($=K.size,K.set(k,$)),y[M]=$}C>65535&&(M++,y[M]=y[M-1])}return{fontUrls:Array.from(K.keys()),chars:y}})},Object.defineProperty(l,"__esModule",{value:!0}),l}({})}function No(l,r){const c=Object.create(null),f=Object.create(null);function t(a,o){const n=i=>{console.error(`Failure loading font ${a}`,i)};try{const i=new XMLHttpRequest;i.open("get",a,!0),i.responseType="arraybuffer",i.onload=function(){if(i.status>=400)n(new Error(i.statusText));else if(i.status>0)try{const s=l(i.response);s.src=a,o(s)}catch(s){n(s)}},i.onerror=n,i.send()}catch(i){n(i)}}function e(a,o){let n=c[a];n?o(n):f[a]?f[a].push(o):(f[a]=[o],t(a,i=>{i.src=a,c[a]=i,f[a].forEach(s=>s(i)),delete f[a]}))}return function(a,o,{lang:n,fonts:i=[],style:s="normal",weight:u="normal",unicodeFontsURL:h}={}){const d=new Uint8Array(a.length),v=[];a.length||x();const g=new Map,m=[];if(s!=="italic"&&(s="normal"),typeof u!="number"&&(u=u==="bold"?700:400),i&&!Array.isArray(i)&&(i=[i]),i=i.slice().filter(w=>!w.lang||w.lang.test(n)).reverse(),i.length){let S=0;(function T(O=0){for(let G=O,K=a.length;G<K;G++){const y=a.codePointAt(G);if(S===1&&v[d[G-1]].supportsCodePoint(y)||G>0&&/\s/.test(a[G]))d[G]=d[G-1],S===2&&(m[m.length-1][1]=G);else for(let R=d[G],A=i.length;R<=A;R++)if(R===A){const j=S===2?m[m.length-1]:m[m.length]=[G,G];j[1]=G,S=2}else{d[G]=R;const{src:j,unicodeRange:z}=i[R];if(!z||_(y,z)){const X=c[j];if(!X){e(j,()=>{T(G)});return}if(X.supportsCodePoint(y)){let q=g.get(X);typeof q!="number"&&(q=v.length,v.push(X),g.set(X,q)),d[G]=q,S=1;break}}}y>65535&&G+1<K&&(d[G+1]=d[G],G++,S===2&&(m[m.length-1][1]=G))}E()})()}else m.push([0,a.length-1]),E();function E(){if(m.length){const w=m.map(U=>a.substring(U[0],U[1]+1)).join(`
`);r.getFontsForString(w,{lang:n||void 0,style:s,weight:u,dataUrl:h}).then(({fontUrls:U,chars:D})=>{const S=v.length;let T=0;m.forEach(G=>{for(let K=0,y=G[1]-G[0];K<=y;K++)d[G[0]+K]=D[T++]+S;T++});let O=0;U.forEach((G,K)=>{e(G,y=>{v[K+S]=y,++O===U.length&&x()})})})}else x()}function x(){o({chars:d,fonts:v})}function _(w,U){for(let D=0;D<U.length;D++){const[S,T=S]=U[D];if(S<=w&&w<=T)return!0}return!1}}}const zo=At({name:"FontResolver",dependencies:[No,Io,Bo],init(l,r,c){return l(r,c())}});function Wo(l,r){const f=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,t="[^\\S\\u00A0]",e=new RegExp(`${t}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:v,lang:g,fonts:m,style:E,weight:x,preResolvedFonts:_,unicodeFontsURL:w},U){const D=({chars:S,fonts:T})=>{let O,G;const K=[];for(let y=0;y<S.length;y++)S[y]!==G?(G=S[y],K.push(O={start:y,end:y,fontObj:T[S[y]]})):O.end=y;U(K)};_?D(_):l(v,D,{lang:g,fonts:m,style:E,weight:x,unicodeFontsURL:w})}function o({text:v="",font:g,lang:m,sdfGlyphSize:E=64,fontSize:x=400,fontWeight:_=1,fontStyle:w="normal",letterSpacing:U=0,lineHeight:D="normal",maxWidth:S=1/0,direction:T,textAlign:O="left",textIndent:G=0,whiteSpace:K="normal",overflowWrap:y="normal",anchorX:R=0,anchorY:A=0,metricsOnly:j=!1,unicodeFontsURL:z,preResolvedFonts:X=null,includeCaretPositions:q=!1,chunkedBoundsSize:F=8192,colorRanges:L=null},p){const b=u(),M={fontLoad:0,typesetting:0};v.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),v=v.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),x=+x,U=+U,S=+S,D=D||"normal",G=+G,a({text:v,lang:m,style:w,weight:_,fonts:typeof g=="string"?[{src:g}]:g,unicodeFontsURL:z,preResolvedFonts:X},C=>{M.fontLoad=u()-b;const k=isFinite(S);let N=null,P=null,B=null,Y=null,$=null,H=null,W=null,he=null,ce=0,Z=0,te=K!=="nowrap";const se=new Map,V=u();let re=G,ee=0,I=new h;const de=[I];C.forEach(ne=>{const{fontObj:oe}=ne,{ascender:fe,descender:pe,unitsPerEm:Se,lineGap:Me,capHeight:ge,xHeight:me}=oe;let le=se.get(oe);if(!le){const ue=x/Se,xe=D==="normal"?(fe-pe+Me)*ue:D*x,et=(xe-(fe-pe)*ue)/2,we=Math.min(xe,(fe-pe)*ue),ye=(fe+pe)/2*ue+we/2;le={index:se.size,src:oe.src,fontObj:oe,fontSizeMult:ue,unitsPerEm:Se,ascender:fe*ue,descender:pe*ue,capHeight:ge*ue,xHeight:me*ue,lineHeight:xe,baseline:-et-fe*ue,caretTop:ye,caretBottom:ye-we},se.set(oe,le)}const{fontSizeMult:Ae}=le,_e=v.slice(ne.start,ne.end+1);let Oe,Ue;oe.forEachGlyph(_e,x,U,(ue,xe,et,we)=>{xe+=ee,we+=ne.start,Oe=xe,Ue=ue;const ye=v.charAt(we),Fe=ue.advanceWidth*Ae,Te=I.count;let ve;if("isEmpty"in ue||(ue.isWhitespace=!!ye&&new RegExp(t).test(ye),ue.canBreakAfter=!!ye&&e.test(ye),ue.isEmpty=ue.xMin===ue.xMax||ue.yMin===ue.yMax||f.test(ye)),!ue.isWhitespace&&!ue.isEmpty&&Z++,te&&k&&!ue.isWhitespace&&xe+Fe+re>S&&Te){if(I.glyphAt(Te-1).glyphObj.canBreakAfter)ve=new h,re=-xe;else for(let Pe=Te;Pe--;)if(Pe===0&&y==="break-word"){ve=new h,re=-xe;break}else if(I.glyphAt(Pe).glyphObj.canBreakAfter){ve=I.splitAt(Pe+1);const Le=ve.glyphAt(0).x;re-=Le;for(let Ee=ve.count;Ee--;)ve.glyphAt(Ee).x-=Le;break}ve&&(I.isSoftWrapped=!0,I=ve,de.push(I),ce=S)}let ke=I.glyphAt(I.count);ke.glyphObj=ue,ke.x=xe+re,ke.y=et,ke.width=Fe,ke.charIndex=we,ke.fontData=le,ye===`
`&&(I=new h,de.push(I),re=-(xe+Fe+U*x)+G)}),ee=Oe+Ue.advanceWidth*Ae+U*x});let Q=0;de.forEach(ne=>{let oe=!0;for(let fe=ne.count;fe--;){const pe=ne.glyphAt(fe);oe&&!pe.glyphObj.isWhitespace&&(ne.width=pe.x+pe.width,ne.width>ce&&(ce=ne.width),oe=!1);let{lineHeight:Se,capHeight:Me,xHeight:ge,baseline:me}=pe.fontData;Se>ne.lineHeight&&(ne.lineHeight=Se);const le=me-ne.baseline;le<0&&(ne.baseline+=le,ne.cap+=le,ne.ex+=le),ne.cap=Math.max(ne.cap,ne.baseline+Me),ne.ex=Math.max(ne.ex,ne.baseline+ge)}ne.baseline-=Q,ne.cap-=Q,ne.ex-=Q,Q+=ne.lineHeight});let ae=0,J=0;if(R&&(typeof R=="number"?ae=-R:typeof R=="string"&&(ae=-ce*(R==="left"?0:R==="center"?.5:R==="right"?1:i(R)))),A&&(typeof A=="number"?J=-A:typeof A=="string"&&(J=A==="top"?0:A==="top-baseline"?-de[0].baseline:A==="top-cap"?-de[0].cap:A==="top-ex"?-de[0].ex:A==="middle"?Q/2:A==="bottom"?Q:A==="bottom-baseline"?-de[de.length-1].baseline:i(A)*Q)),!j){const ne=r.getEmbeddingLevels(v,T);N=new Uint16Array(Z),P=new Uint8Array(Z),B=new Float32Array(Z*2),Y={},W=[1/0,1/0,-1/0,-1/0],he=[],q&&(H=new Float32Array(v.length*4)),L&&($=new Uint8Array(Z*3));let oe=0,fe=-1,pe=-1,Se,Me;if(de.forEach((ge,me)=>{let{count:le,width:Ae}=ge;if(le>0){let _e=0;for(let we=le;we--&&ge.glyphAt(we).glyphObj.isWhitespace;)_e++;let Oe=0,Ue=0;if(O==="center")Oe=(ce-Ae)/2;else if(O==="right")Oe=ce-Ae;else if(O==="justify"&&ge.isSoftWrapped){let we=0;for(let ye=le-_e;ye--;)ge.glyphAt(ye).glyphObj.isWhitespace&&we++;Ue=(ce-Ae)/we}if(Ue||Oe){let we=0;for(let ye=0;ye<le;ye++){let Fe=ge.glyphAt(ye);const Te=Fe.glyphObj;Fe.x+=Oe+we,Ue!==0&&Te.isWhitespace&&ye<le-_e&&(we+=Ue,Fe.width+=Ue)}}const ue=r.getReorderSegments(v,ne,ge.glyphAt(0).charIndex,ge.glyphAt(ge.count-1).charIndex);for(let we=0;we<ue.length;we++){const[ye,Fe]=ue[we];let Te=1/0,ve=-1/0;for(let ke=0;ke<le;ke++)if(ge.glyphAt(ke).charIndex>=ye){let Pe=ke,Le=ke;for(;Le<le;Le++){let Ee=ge.glyphAt(Le);if(Ee.charIndex>Fe)break;Le<le-_e&&(Te=Math.min(Te,Ee.x),ve=Math.max(ve,Ee.x+Ee.width))}for(let Ee=Pe;Ee<Le;Ee++){const He=ge.glyphAt(Ee);He.x=ve-(He.x+He.width-Te)}break}}let xe;const et=we=>xe=we;for(let we=0;we<le;we++){const ye=ge.glyphAt(we);xe=ye.glyphObj;const Fe=xe.index,Te=ne.levels[ye.charIndex]&1;if(Te){const ve=r.getMirroredCharacter(v[ye.charIndex]);ve&&ye.fontData.fontObj.forEachGlyph(ve,0,0,et)}if(q){const{charIndex:ve,fontData:ke}=ye,Pe=ye.x+ae,Le=ye.x+ye.width+ae;H[ve*4]=Te?Le:Pe,H[ve*4+1]=Te?Pe:Le,H[ve*4+2]=ge.baseline+ke.caretBottom+J,H[ve*4+3]=ge.baseline+ke.caretTop+J;const Ee=ve-fe;Ee>1&&s(H,fe,Ee),fe=ve}if(L){const{charIndex:ve}=ye;for(;ve>pe;)pe++,L.hasOwnProperty(pe)&&(Me=L[pe])}if(!xe.isWhitespace&&!xe.isEmpty){const ve=oe++,{fontSizeMult:ke,src:Pe,index:Le}=ye.fontData,Ee=Y[Pe]||(Y[Pe]={});Ee[Fe]||(Ee[Fe]={path:xe.path,pathBounds:[xe.xMin,xe.yMin,xe.xMax,xe.yMax]});const He=ye.x+ae,tt=ye.y+ge.baseline+J;B[ve*2]=He,B[ve*2+1]=tt;const qe=He+xe.xMin*ke,rt=tt+xe.yMin*ke,ut=He+xe.xMax*ke,Ze=tt+xe.yMax*ke;qe<W[0]&&(W[0]=qe),rt<W[1]&&(W[1]=rt),ut>W[2]&&(W[2]=ut),Ze>W[3]&&(W[3]=Ze),ve%F===0&&(Se={start:ve,end:ve,rect:[1/0,1/0,-1/0,-1/0]},he.push(Se)),Se.end++;const Ge=Se.rect;if(qe<Ge[0]&&(Ge[0]=qe),rt<Ge[1]&&(Ge[1]=rt),ut>Ge[2]&&(Ge[2]=ut),Ze>Ge[3]&&(Ge[3]=Ze),N[ve]=Fe,P[ve]=Le,L){const ht=ve*3;$[ht]=Me>>16&255,$[ht+1]=Me>>8&255,$[ht+2]=Me&255}}}}}),H){const ge=v.length-fe;ge>1&&s(H,fe,ge)}}const be=[];se.forEach(({index:ne,src:oe,unitsPerEm:fe,ascender:pe,descender:Se,lineHeight:Me,capHeight:ge,xHeight:me})=>{be[ne]={src:oe,unitsPerEm:fe,ascender:pe,descender:Se,lineHeight:Me,capHeight:ge,xHeight:me}}),M.typesetting=u()-V,p({glyphIds:N,glyphFontIndices:P,glyphPositions:B,glyphData:Y,fontData:be,caretPositions:H,glyphColors:$,chunkedBounds:he,fontSize:x,topBaseline:J+de[0].baseline,blockBounds:[ae,J-Q,ae+ce,J],visibleBounds:W,timings:M})})}function n(v,g){o({...v,metricsOnly:!0},m=>{const[E,x,_,w]=m.blockBounds;g({width:_-E,height:w-x})})}function i(v){let g=v.match(/^([\d.]+)%$/),m=g?parseFloat(g[1]):NaN;return isNaN(m)?0:m/100}function s(v,g,m){const E=v[g*4],x=v[g*4+1],_=v[g*4+2],w=v[g*4+3],U=(x-E)/m;for(let D=0;D<m;D++){const S=(g+D)*4;v[S]=E+U*D,v[S+1]=E+U*(D+1),v[S+2]=_,v[S+3]=w}}function u(){return(self.performance||Date).now()}function h(){this.data=[]}const d=["glyphObj","x","y","width","charIndex","fontData"];return h.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/d.length)},glyphAt(v){let g=h.flyweight;return g.data=this.data,g.index=v,g},splitAt(v){let g=new h;return g.data=this.data.splice(v*d.length),g}},h.flyweight=d.reduce((v,g,m,E)=>(Object.defineProperty(v,g,{get(){return this.data[this.index*d.length+m]},set(x){this.data[this.index*d.length+m]=x}}),v),{data:null,index:0}),{typeset:o,measure:n}}const vt=()=>(self.performance||Date).now(),mr=la();let zn;function jo(l,r,c,f,t,e,a,o,n,i,s=!0){return s?Ho(l,r,c,f,t,e,a,o,n,i).then(null,u=>(zn||(console.warn("WebGL SDF generation failed, falling back to JS",u),zn=!0),jn(l,r,c,f,t,e,a,o,n,i))):jn(l,r,c,f,t,e,a,o,n,i)}const hr=[],Vo=5;let Qr=0;function ca(){const l=vt();for(;hr.length&&vt()-l<Vo;)hr.shift()();Qr=hr.length?setTimeout(ca,0):0}const Ho=(...l)=>new Promise((r,c)=>{hr.push(()=>{const f=vt();try{mr.webgl.generateIntoCanvas(...l),r({timing:vt()-f})}catch(t){c(t)}}),Qr||(Qr=setTimeout(ca,0))}),Xo=4,Yo=2e3,Wn={};let Ko=0;function jn(l,r,c,f,t,e,a,o,n,i){const s="TroikaTextSDFGenerator_JS_"+Ko++%Xo;let u=Wn[s];return u||(u=Wn[s]={workerModule:At({name:s,workerId:s,dependencies:[la,vt],init(h,d){const v=h().javascript.generate;return function(...g){const m=d();return{textureData:v(...g),timing:d()-m}}},getTransferables(h){return[h.textureData.buffer]}}),requests:0,idleTimer:null}),u.requests++,clearTimeout(u.idleTimer),u.workerModule(l,r,c,f,t,e).then(({textureData:h,timing:d})=>{const v=vt(),g=new Uint8Array(h.length*4);for(let m=0;m<h.length;m++)g[m*4+i]=h[m];return mr.webglUtils.renderImageData(a,g,o,n,l,r,1<<3-i),d+=vt()-v,--u.requests===0&&(u.idleTimer=setTimeout(()=>{To(s)},Yo)),{timing:d}})}function Jo(l){l._warm||(mr.webgl.isSupported(l),l._warm=!0)}const Qo=mr.webglUtils.resizeWebGLCanvasWithoutClearing,Nt={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},qo=new lt;function xt(){return(self.performance||Date).now()}const Vn=Object.create(null);function Zo(l,r){l=ei({},l);const c=xt(),f=[];if(l.font&&f.push({label:"user",src:ti(l.font)}),l.font=f,l.text=""+l.text,l.sdfGlyphSize=l.sdfGlyphSize||Nt.sdfGlyphSize,l.unicodeFontsURL=l.unicodeFontsURL||Nt.unicodeFontsURL,l.colorRanges!=null){let h={};for(let d in l.colorRanges)if(l.colorRanges.hasOwnProperty(d)){let v=l.colorRanges[d];typeof v!="number"&&(v=qo.set(v).getHex()),h[d]=v}l.colorRanges=h}Object.freeze(l);const{textureWidth:t,sdfExponent:e}=Nt,{sdfGlyphSize:a}=l,o=t/a*4;let n=Vn[a];if(!n){const h=document.createElement("canvas");h.width=t,h.height=a*256/o,n=Vn[a]={glyphCount:0,sdfGlyphSize:a,sdfCanvas:h,sdfTexture:new Va(h,void 0,void 0,void 0,En,En),contextLost:!1,glyphsByFont:new Map},n.sdfTexture.generateMipmaps=!1,$o(n)}const{sdfTexture:i,sdfCanvas:s}=n;da(l).then(h=>{const{glyphIds:d,glyphFontIndices:v,fontData:g,glyphPositions:m,fontSize:E,timings:x}=h,_=[],w=new Float32Array(d.length*4);let U=0,D=0;const S=xt(),T=g.map(R=>{let A=n.glyphsByFont.get(R.src);return A||n.glyphsByFont.set(R.src,A=new Map),A});d.forEach((R,A)=>{const j=v[A],{src:z,unitsPerEm:X}=g[j];let q=T[j].get(R);if(!q){const{path:M,pathBounds:C}=h.glyphData[z][R],k=Math.max(C[2]-C[0],C[3]-C[1])/a*(Nt.sdfMargin*a+.5),N=n.glyphCount++,P=[C[0]-k,C[1]-k,C[2]+k,C[3]+k];T[j].set(R,q={path:M,atlasIndex:N,sdfViewBox:P}),_.push(q)}const{sdfViewBox:F}=q,L=m[D++],p=m[D++],b=E/X;w[U++]=L+F[0]*b,w[U++]=p+F[1]*b,w[U++]=L+F[2]*b,w[U++]=p+F[3]*b,d[A]=q.atlasIndex}),x.quads=(x.quads||0)+(xt()-S);const O=xt();x.sdf={};const G=s.height,K=Math.ceil(n.glyphCount/o),y=Math.pow(2,Math.ceil(Math.log2(K*a)));y>G&&(console.info(`Increasing SDF texture size ${G}->${y}`),Qo(s,t,y),i.dispose()),Promise.all(_.map(R=>ua(R,n,l.gpuAccelerateSDF).then(({timing:A})=>{x.sdf[R.atlasIndex]=A}))).then(()=>{_.length&&!n.contextLost&&(ha(n),i.needsUpdate=!0),x.sdfTotal=xt()-O,x.total=xt()-c,r(Object.freeze({parameters:l,sdfTexture:i,sdfGlyphSize:a,sdfExponent:e,glyphBounds:w,glyphAtlasIndices:d,glyphColors:h.glyphColors,caretPositions:h.caretPositions,chunkedBounds:h.chunkedBounds,ascender:h.ascender,descender:h.descender,lineHeight:h.lineHeight,capHeight:h.capHeight,xHeight:h.xHeight,topBaseline:h.topBaseline,blockBounds:h.blockBounds,visibleBounds:h.visibleBounds,timings:h.timings}))})}),Promise.resolve().then(()=>{n.contextLost||Jo(s)})}function ua({path:l,atlasIndex:r,sdfViewBox:c},{sdfGlyphSize:f,sdfCanvas:t,contextLost:e},a){if(e)return Promise.resolve({timing:-1});const{textureWidth:o,sdfExponent:n}=Nt,i=Math.max(c[2]-c[0],c[3]-c[1]),s=Math.floor(r/4),u=s%(o/f)*f,h=Math.floor(s/(o/f))*f,d=r%4;return jo(f,f,l,c,i,n,t,u,h,d,a)}function $o(l){const r=l.sdfCanvas;r.addEventListener("webglcontextlost",c=>{console.log("Context Lost",c),c.preventDefault(),l.contextLost=!0}),r.addEventListener("webglcontextrestored",c=>{console.log("Context Restored",c),l.contextLost=!1;const f=[];l.glyphsByFont.forEach(t=>{t.forEach(e=>{f.push(ua(e,l,!0))})}),Promise.all(f).then(()=>{ha(l),l.sdfTexture.needsUpdate=!0})})}function ei(l,r){for(let c in r)r.hasOwnProperty(c)&&(l[c]=r[c]);return l}let lr;function ti(l){return lr||(lr=typeof document>"u"?{}:document.createElement("a")),lr.href=l,lr.href}function ha(l){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:r,sdfTexture:c}=l,{width:f,height:t}=r,e=l.sdfCanvas.getContext("webgl");let a=c.image.data;(!a||a.length!==f*t*4)&&(a=new Uint8Array(f*t*4),c.image={width:f,height:t,data:a},c.flipY=!1,c.isDataTexture=!0),e.readPixels(0,0,f,t,e.RGBA,e.UNSIGNED_BYTE,a)}}const ri=At({name:"Typesetter",dependencies:[Wo,zo,Mo],init(l,r,c){return l(r,c())}}),da=At({name:"Typesetter",dependencies:[ri],init(l){return function(r){return new Promise(c=>{l.typeset(r,c)})}},getTransferables(l){const r=[];for(let c in l)l[c]&&l[c].buffer&&r.push(l[c].buffer);return r}});da.onMainThread;const Hn={};function ni(l){let r=Hn[l];return r||(r=Hn[l]=new Ht(1,1,l,l).translate(.5,.5,0)),r}const ai="aTroikaGlyphBounds",Xn="aTroikaGlyphIndex",oi="aTroikaGlyphColor";class ii extends za{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Wa,this.boundingBox=new ra}computeBoundingSphere(){}computeBoundingBox(){}set detail(r){if(r!==this._detail){this._detail=r,(typeof r!="number"||r<1)&&(r=1);let c=ni(r);["position","normal","uv"].forEach(f=>{this.attributes[f]=c.attributes[f].clone()}),this.setIndex(c.getIndex().clone())}}get detail(){return this._detail}set curveRadius(r){r!==this._curveRadius&&(this._curveRadius=r,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(r,c,f,t,e){this.updateAttributeData(ai,r,4),this.updateAttributeData(Xn,c,1),this.updateAttributeData(oi,e,3),this._blockBounds=f,this._chunkedBounds=t,this.instanceCount=c.length,this._updateBounds()}_updateBounds(){const r=this._blockBounds;if(r){const{curveRadius:c,boundingBox:f}=this;if(c){const{PI:t,floor:e,min:a,max:o,sin:n,cos:i}=Math,s=t/2,u=t*2,h=Math.abs(c),d=r[0]/h,v=r[2]/h,g=e((d+s)/u)!==e((v+s)/u)?-h:a(n(d)*h,n(v)*h),m=e((d-s)/u)!==e((v-s)/u)?h:o(n(d)*h,n(v)*h),E=e((d+t)/u)!==e((v+t)/u)?h*2:o(h-i(d)*h,h-i(v)*h);f.min.set(g,r[1],c<0?-E:0),f.max.set(m,r[3],c<0?0:E)}else f.min.set(r[0],r[1],0),f.max.set(r[2],r[3],0);f.getBoundingSphere(this.boundingSphere)}}applyClipRect(r){let c=this.getAttribute(Xn).count,f=this._chunkedBounds;if(f)for(let t=f.length;t--;){c=f[t].end;let e=f[t].rect;if(e[1]<r.w&&e[3]>r.y&&e[0]<r.z&&e[2]>r.x)break}this.instanceCount=c}updateAttributeData(r,c,f){const t=this.getAttribute(r);c?t&&t.array.length===c.length?(t.array.set(c),t.needsUpdate=!0):(this.setAttribute(r,new ja(c,f)),delete this._maxInstanceCount,this.dispose()):t&&this.deleteAttribute(r)}}const si=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,li=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,fi=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,ci=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function ui(l){const r=Jr(l,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Vt},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Dn(0,0,0,0)},uTroikaClipRect:{value:new Dn(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Vt},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new lt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Ha},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:si,vertexTransform:li,fragmentDefs:fi,fragmentColorTransform:ci,customRewriter({vertexShader:c,fragmentShader:f}){let t=/\buniform\s+vec3\s+diffuse\b/;return t.test(f)&&(f=f.replace(t,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),t.test(c)||(c=c.replace(fa,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:c,fragmentShader:f}}});return r.transparent=!0,r.forceSinglePass=!0,Object.defineProperties(r,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),r}const nn=new Tt({color:16777215,side:Xa,transparent:!0}),Yn=8421504,Kn=new Na,fr=new ze,jr=new ze,Bt=[],hi=new ze,Vr="+x+y";function Jn(l){return Array.isArray(l)?l[0]:l}let pa=()=>{const l=new ft(new Ht(1,1),nn);return pa=()=>l,l},va=()=>{const l=new ft(new Ht(1,1,32,1),nn);return va=()=>l,l};const di={type:"syncstart"},pi={type:"synccomplete"},ga=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],vi=ga.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class ma extends ft{constructor(){const r=new ii;super(r,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=Yn,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=Vr,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(r){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(r):(this._isSyncing=!0,this.dispatchEvent(di),Zo({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},c=>{this._isSyncing=!1,this._textRenderInfo=c,this.geometry.updateGlyphs(c.glyphBounds,c.glyphAtlasIndices,c.blockBounds,c.chunkedBounds,c.glyphColors);const f=this._queuedSyncs;f&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{f.forEach(t=>t&&t())})),this.dispatchEvent(pi),r&&r()})))}onBeforeRender(r,c,f,t,e,a){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(r){return ui(r)}get material(){let r=this._derivedMaterial;const c=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=nn.clone());if((!r||!r.isDerivedFrom(c))&&(r=this._derivedMaterial=this.createDerivedMaterial(c),c.addEventListener("dispose",function f(){c.removeEventListener("dispose",f),r.dispose()})),this.hasOutline()){let f=r._outlineMtl;return f||(f=r._outlineMtl=Object.create(r,{id:{value:r.id+.1}}),f.isTextOutlineMaterial=!0,f.depthWrite=!1,f.map=null,r.addEventListener("dispose",function t(){r.removeEventListener("dispose",t),f.dispose()})),[f,r]}else return r}set material(r){r&&r.isTroikaTextMaterial?(this._derivedMaterial=r,this._baseMaterial=r.baseMaterial):this._baseMaterial=r}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(r){this.geometry.detail=r}get curveRadius(){return this.geometry.curveRadius}set curveRadius(r){this.geometry.curveRadius=r}get customDepthMaterial(){return Jn(this.material).getDepthMaterial()}set customDepthMaterial(r){}get customDistanceMaterial(){return Jn(this.material).getDistanceMaterial()}set customDistanceMaterial(r){}_prepareForRender(r){const c=r.isTextOutlineMaterial,f=r.uniforms,t=this.textRenderInfo;if(t){const{sdfTexture:o,blockBounds:n}=t;f.uTroikaSDFTexture.value=o,f.uTroikaSDFTextureSize.value.set(o.image.width,o.image.height),f.uTroikaSDFGlyphSize.value=t.sdfGlyphSize,f.uTroikaSDFExponent.value=t.sdfExponent,f.uTroikaTotalBounds.value.fromArray(n),f.uTroikaUseGlyphColors.value=!c&&!!t.glyphColors;let i=0,s=0,u=0,h,d,v,g=0,m=0;if(c){let{outlineWidth:x,outlineOffsetX:_,outlineOffsetY:w,outlineBlur:U,outlineOpacity:D}=this;i=this._parsePercent(x)||0,s=Math.max(0,this._parsePercent(U)||0),h=D,g=this._parsePercent(_)||0,m=this._parsePercent(w)||0}else u=Math.max(0,this._parsePercent(this.strokeWidth)||0),u&&(v=this.strokeColor,f.uTroikaStrokeColor.value.set(v??Yn),d=this.strokeOpacity,d==null&&(d=1)),h=this.fillOpacity;f.uTroikaEdgeOffset.value=i,f.uTroikaPositionOffset.value.set(g,m),f.uTroikaBlurRadius.value=s,f.uTroikaStrokeWidth.value=u,f.uTroikaStrokeOpacity.value=d,f.uTroikaFillOpacity.value=h??1,f.uTroikaCurveRadius.value=this.curveRadius||0;let E=this.clipRect;if(E&&Array.isArray(E)&&E.length===4)f.uTroikaClipRect.value.fromArray(E);else{const x=(this.fontSize||.1)*100;f.uTroikaClipRect.value.set(n[0]-x,n[1]-x,n[2]+x,n[3]+x)}this.geometry.applyClipRect(f.uTroikaClipRect.value)}f.uTroikaSDFDebug.value=!!this.debugSDF,r.polygonOffset=!!this.depthOffset,r.polygonOffsetFactor=r.polygonOffsetUnits=this.depthOffset||0;const e=c?this.outlineColor||0:this.color;if(e==null)delete r.color;else{const o=r.hasOwnProperty("color")?r.color:r.color=new lt;(e!==o._input||typeof e=="object")&&o.set(o._input=e)}let a=this.orientation||Vr;if(a!==r._orientation){let o=f.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let n=a!==Vr&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(n){let[,i,s,u,h]=n;fr.set(0,0,0)[s]=i==="-"?1:-1,jr.set(0,0,0)[h]=u==="-"?-1:1,Kn.lookAt(hi,fr.cross(jr),jr),o.setFromMatrix4(Kn)}else o.identity();r._orientation=a}}_parsePercent(r){if(typeof r=="string"){let c=r.match(/^(-?[\d.]+)%$/),f=c?parseFloat(c[1]):NaN;r=(isNaN(f)?0:f/100)*this.fontSize}return r}localPositionToTextCoords(r,c=new Vt){c.copy(r);const f=this.curveRadius;return f&&(c.x=Math.atan2(r.x,Math.abs(f)-Math.abs(r.z))*Math.abs(f)),c}worldPositionToTextCoords(r,c=new Vt){return fr.copy(r),this.localPositionToTextCoords(this.worldToLocal(fr),c)}raycast(r,c){const{textRenderInfo:f,curveRadius:t}=this;if(f){const e=f.blockBounds,a=t?va():pa(),o=a.geometry,{position:n,uv:i}=o.attributes;for(let s=0;s<i.count;s++){let u=e[0]+i.getX(s)*(e[2]-e[0]);const h=e[1]+i.getY(s)*(e[3]-e[1]);let d=0;t&&(d=t-Math.cos(u/t)*t,u=Math.sin(u/t)*t),n.setXYZ(s,u,h,d)}o.boundingSphere=this.geometry.boundingSphere,o.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,Bt.length=0,a.raycast(r,Bt);for(let s=0;s<Bt.length;s++)Bt[s].object=this,c.push(Bt[s])}}copy(r){const c=this.geometry;return super.copy(r),this.geometry=c,vi.forEach(f=>{this[f]=r[f]}),this}clone(){return new this.constructor().copy(this)}}ga.forEach(l=>{const r="_private_"+l;Object.defineProperty(ma.prototype,l,{get(){return this[r]},set(c){c!==this[r]&&(this[r]=c,this._needsSync=!0)}})});new ra;new lt;const ot=180,pt=220,Qn=24,gi=10;function wt({text:l,fontSize:r,color:c,anchorX:f="left",anchorY:t="middle"}){const e=new ma;return e.text=l,e.fontSize=r,e.color=c,e.anchorX=f,e.anchorY=t,e.sync(),e}class mi{constructor(r){this.group=new pr,this.buttons=[],this.activeName=null,this.hintText=null,this.onSelect=r.onSelect;const c=new Tt({color:790810,transparent:!0,opacity:.72,depthWrite:!1}),f=new Ht(ot,pt,1,1),t=new ft(f,c);t.position.set(0,0,0),this.group.add(t);const e=wt({text:"Dream-Graph",fontSize:9,color:14870768});e.position.set(-ot/2+12,pt/2-18,1),this.group.add(e);const a=wt({text:"Configurations",fontSize:6.5,color:9741240});a.position.set(-ot/2+12,pt/2-34,1),this.group.add(a),this.statusText=wt({text:"Active: Planetary",fontSize:6,color:8246268}),this.statusText.position.set(-ot/2+12,-pt/2+30,1),this.group.add(this.statusText),this.hubText=wt({text:"Hub: -",fontSize:5.5,color:9741240}),this.hubText.position.set(-ot/2+12,-pt/2+18,1),this.group.add(this.hubText),this.hintText=wt({text:"",fontSize:5.5,color:9741240}),this.hintText.position.set(-ot/2+12,-pt/2+6,1),this.group.add(this.hintText);const o=pt/2-68;r.configs.forEach((n,i)=>{const s=o-i*(Qn+gi),u=new Ht(ot-24,Qn,1,1),h=new Tt({color:1120295,transparent:!0,opacity:.75}),d=new ft(u,h);d.position.set(0,s,2),d.userData={name:n.name};const v=wt({text:n.label,fontSize:7.5,color:14870768});v.position.set(-ot/2+20,s,3),this.group.add(d),this.group.add(v),this.buttons.push({name:n.name,mesh:d,label:v})})}setActive(r){this.activeName=r,this.buttons.forEach(c=>{const f=c.name===r;c.mesh.material.color.setHex(f?1920728:1120295),c.mesh.material.opacity=f?.9:.65,c.label.color=f?16317180:14870768,c.label.sync()})}setHover(r){this.buttons.forEach(c=>{c.name!==this.activeName&&(c.name===r?(c.mesh.material.color.setHex(2450411),c.mesh.material.opacity=.8,c.label.color=16317180,c.label.sync()):(c.mesh.material.color.setHex(1120295),c.mesh.material.opacity=.65,c.label.color=14870768,c.label.sync()))})}setStatus(r){this.statusText.text=r,this.statusText.sync()}setHub(r){this.hubText.text=r,this.hubText.sync()}setHint(r){this.hintText.text=r,this.hintText.sync()}updateHud(r){const c=new ze;r.getWorldDirection(c);const f=new ze(1,0,0).applyQuaternion(r.quaternion),t=new ze(0,1,0).applyQuaternion(r.quaternion),e=r.position.clone().add(c.multiplyScalar(220)).add(f.multiplyScalar(-140)).add(t.multiplyScalar(40));this.group.position.copy(e),this.group.quaternion.copy(r.quaternion),this.group.rotateY(.08)}getHitTargets(){return this.buttons.map(r=>r.mesh)}handleClick(r){r?.userData?.name&&this.onSelect&&this.onSelect(r.userData.name)}}const kt=je.node.minRadius,yi=.07,bi=.0016,xi=.08,wi=.0013,Si=.16,Ui=2200,qn=900,_i=1400,st=.38,Ti=document.getElementById("graph"),jt=je.colors,an=new URLSearchParams(window.location.search),ki=an.get("source")||"demo",Mi=an.get("view")||"all",Ai=an.get("graphUrl")||"universe.json",Zn=await so(ki==="canon"?Pn.EXTERNAL:Pn.LOCAL_DEMO,{externalUrl:Ai,view:Mi}),De={nodes:Zn.nodes,links:Zn.links};let Xt=new Map,it=new Map,ct=new Map,$n=new Map,yr="planetary",We=null,Ut=null,ya=0,$e=0,_t=1,qr="Planetary",Hr=0,ea=performance.now();const ba=new Ya(1,48,48),dr=new Map,xa=new Map,wa=new Set,Sa=new Map,Zr=new Map,Xr=new Map,Ci=new Tt({transparent:!0,opacity:0,depthWrite:!1,depthTest:!1}),cr=new Ka,Ce=Ja()(Ti).backgroundColor(je.colors.background).showNavInfo(!1).nodeRelSize(kt).linkOpacity(0).linkWidth(0).linkDirectionalParticles(0).graphData(De);Ce.d3VelocityDecay(.25);Ce.d3AlphaDecay(.04);Ce.scene().add(new Qa(16777215,.7));const Ua=new qa(16777215,.8);Ua.position.set(40,60,120);Ce.scene().add(Ua);const br=Ce.camera();br.fov=je.camera.fov;br.updateProjectionMatrix();const Qe=Ce.controls();Qe.enableDamping=!0;Qe.dampingFactor=.08;Qe.rotateSpeed=.6;Qe.zoomSpeed=.8;Qe.autoRotate=!0;Qe.autoRotateSpeed=Si;Ce.nodeLabel(l=>l.label||l.id);Ce.nodeThreeObject(l=>Fi());Ce.nodeThreeObjectExtend(!1);Ce.nodeVal(l=>Yt(l)/kt);const _a=Li(De.links);Ce.scene().add(_a.group);const Je=Pi();Ce.scene().add(Je.group);const on=[{name:"planetary",label:"Planetary"},{name:"mlp",label:"MLP"},{name:"dna",label:"DNA"},{name:"metro",label:"Metro"},{name:"lattice",label:"Lattice"}],Ve=new mi({configs:on,onSelect:l=>Kt(l)});Ve.setActive(yr);Ce.scene().add(Ve.group);const ta=new Za,$r=new Vt(0,0);let vr=null;const xr=(()=>{let l=null,r=null,c=.12,f=()=>{};const t=new Map,e=new Map,a=180,o=240,n=.3,i=3.5;function s(){l||(l=new AudioContext,r=l.createGain(),r.gain.value=c,r.connect(l.destination)),l.state==="suspended"?f(!0):f(!1)}function u(E,x,_,w){if(!l||l.state!=="running")return;const U=l.createOscillator(),D=l.createGain(),S=l.createBiquadFilter();U.type="sine",U.frequency.value=E,S.type="lowpass",S.frequency.value=420+Math.random()*180,S.Q.value=.8,U.connect(S),S.connect(D),D.connect(r);const T=l.currentTime+w,O=c*_;D.gain.setValueAtTime(1e-4,T),D.gain.exponentialRampToValueAtTime(O,T+.03),D.gain.exponentialRampToValueAtTime(1e-4,T+x),U.start(T),U.stop(T+x+.05)}function h(E){const x=je.node.minRadius,_=je.node.maxRadius,U=(Yt(E)-x)/(_-x);return 320-Math.min(1,Math.max(0,U))*170}function d(E){if(!l||l.state!=="running")return;const x=performance.now();E.forEach(_=>{const w=_.vx||0,U=_.vy||0,D=_.vz||0,S=Math.sqrt(w*w+U*U+D*D);if(S<n)return;const T=t.get(_.id)||0;if(x-T<a)return;t.set(_.id,x);const O=Math.min(1,S/i),G=h(_),K=(Math.random()-.5)*8,y=.16+O*.2,R=.08+O*.22;u(G+K,y,R,Math.random()*.04);const A=it.get(_.id);if(!A)return;let j=0;A.forEach(z=>{if(j>=2)return;const X=Xt.get(z);if(!X)return;const q=X.vx||0,F=X.vy||0,L=X.vz||0;if(Math.sqrt(q*q+F*F+L*L)<n*.7)return;const b=`${_.id}:${z}`,M=e.get(b)||0;if(x-M<o)return;e.set(b,x);const C=h(X)+(Math.random()-.5)*10,k=R*.7,N=.06+Math.random()*.09;u(C,y*.85,k,N),j+=1})})}function v(){s(),u(420+Math.random()*60,.18,.16,0)}function g(E){f=E}async function m(){l&&l.state==="suspended"&&(await l.resume(),f(!1))}return{tick:d,playSwitch:v,resumeIfNeeded:m,setHintCallback:g}})();xr.setHintCallback(l=>{Ve.setHint(l?"Click to enable audio":"")});function Mt(l){return l&&typeof l=="object"?l.id:l}function en(l){return l.group&&jt.type?.[l.group]||jt.nodeDefault}function Yt(l){return l.visualRadius&&Number.isFinite(l.visualRadius)?l.visualRadius:l.importance&&Number.isFinite(l.importance)?Math.min(je.node.maxRadius,Math.max(je.node.minRadius,l.importance*4)):kt}function Fi(){return new ft(ba,Ci)}function Ei(l){const r=String(l).toLowerCase();if(dr.has(r))return dr.get(r);const c=new lt(l),f=new io({color:c.clone().multiplyScalar(.6),emissive:c.clone(),emissiveIntensity:.2,roughness:.3,metalness:0});return f.onBeforeCompile=t=>{t.uniforms.rimColor={value:c},t.uniforms.rimPower={value:2.2},t.uniforms.rimStrength={value:.9},t.fragmentShader=t.fragmentShader.replace("#include <output_fragment>",["float rim = pow(1.0 - max(dot(normalize(vNormal), normalize(vViewPosition)), 0.0), rimPower);","vec3 rimLight = rimColor * rim * rimStrength;","gl_FragColor = vec4(outgoingLight + rimLight, diffuseColor.a);"].join(`
`))},dr.set(r,f),f}function Di(){const l=new Map;De.nodes.forEach(r=>{const c=en(r);l.has(c)||l.set(c,[]),l.get(c).push(r)}),l.forEach((r,c)=>{const f=Ei(c),t=new ao(ba,f,r.length);t.instanceMatrix.setUsage(oo),t.frustumCulled=!1,Ce.scene().add(t),wa.add(t),r.forEach((e,a)=>{const o=Yt(e);if(Sa.set(e.id,o),!Zr.has(e.id)){const n=sn(String(e.id))%1e3;Zr.set(e.id,n/1e3*Math.PI*2)}xa.set(e.id,{mesh:t,index:a})})})}function Ri(l){const r=l*bi;xa.forEach((c,f)=>{const t=ct.get(f);if(!t)return;const e=Sa.get(f)||kt,a=Zr.get(f)||0,o=1+Math.sin(r+a)*yi,n=St(new ze(t.x,t.y,t.z));cr.position.copy(n),cr.scale.setScalar(e*o),cr.updateMatrix(),c.mesh.setMatrixAt(c.index,cr.matrix)}),wa.forEach(c=>{c.instanceMatrix.needsUpdate=!0})}function Li(l){const r=l.length*4,c=new Float32Array(r*3),f=new Float32Array(r*3),t=new na;t.setAttribute("position",new Rn(c,3)),t.setAttribute("color",new Rn(f,3));const e=new aa({vertexColors:!0,transparent:!0,opacity:st,blending:$a}),a=new eo(t,e),o=new pr,n=new to(1,1,12),i=l.flatMap(()=>{const u=new ft(n,new Tt({color:16777215,transparent:!0,opacity:.75})),h=new ft(n,new Tt({color:16777215,transparent:!0,opacity:.75}));return o.add(u,h),[u,h]}),s=new pr;return s.add(a),s.add(o),{group:s,line:a,spikes:i,links:l}}function Pi(){const l=new pr;return l.visible=!1,{group:l,rings:[]}}function Ta(){if(Je.group.clear(),Je.rings=[],!We)return;const l=We.ringCount,r=64;for(let c=1;c<=l;c+=1){const f=We.ringRadii[c],t=[];for(let n=0;n<=r;n+=1){const i=n/r*Math.PI*2;t.push(new ze(Math.cos(i)*f,0,Math.sin(i)*f))}const e=new na().setFromPoints(t),a=new aa({color:4937059,transparent:!0,opacity:.22}),o=new ro(e,a);o.rotation.x=Math.PI*.32,Je.group.add(o),Je.rings.push(o)}Je.group.visible=!0}function Gi(){const{line:l,spikes:r,links:c}=_a,f=l.geometry.getAttribute("position"),t=l.geometry.getAttribute("color"),e=st*_t;l.material.opacity=e,c.forEach((a,o)=>{const n=Mt(a.source),i=Mt(a.target),s=Xt.get(n),u=Xt.get(i),h=ct.get(n)||{x:0,y:0,z:0},d=ct.get(i)||{x:0,y:0,z:0},v=new ze(h.x,h.y,h.z),g=new ze(d.x,d.y,d.z),m=g.clone().sub(v),E=Math.max(1e-4,m.length()),x=m.clone().normalize(),w=1+Math.sin($e*wi+Bi(a))*xi,U=s?Yt(s):kt,D=u?Yt(u):kt;let S=Math.min(E*.45,U*2.2)*w,T=Math.min(E*.45,D*2.2)*w;const O=U*.35,G=D*.35,K=Math.max(.001,E-U-D),y=S+T;if(y>K*.9){const he=K*.9/y;S*=he,T*=he}const R=v.clone().add(x.clone().multiplyScalar(U+S)),A=g.clone().add(x.clone().multiplyScalar(-(D+T))),j=R.clone().add(A).multiplyScalar(.5),z=St(R),X=St(j),q=St(A),F=o*12;f.array[F+0]=z.x,f.array[F+1]=z.y,f.array[F+2]=z.z,f.array[F+3]=X.x,f.array[F+4]=X.y,f.array[F+5]=X.z,f.array[F+6]=X.x,f.array[F+7]=X.y,f.array[F+8]=X.z,f.array[F+9]=q.x,f.array[F+10]=q.y,f.array[F+11]=q.z;const L=new lt(s?en(s):jt.link),p=new lt(u?en(u):jt.link),b=new lt(jt.link);t.array[F+0]=L.r,t.array[F+1]=L.g,t.array[F+2]=L.b,t.array[F+3]=b.r,t.array[F+4]=b.g,t.array[F+5]=b.b,t.array[F+6]=b.r,t.array[F+7]=b.g,t.array[F+8]=b.b,t.array[F+9]=p.r,t.array[F+10]=p.g,t.array[F+11]=p.b;const M=r[o*2],C=r[o*2+1],k=new Ln().setFromUnitVectors(new ze(0,1,0),x),N=new Ln().setFromUnitVectors(new ze(0,1,0),x.clone().multiplyScalar(-1));M.quaternion.copy(k),C.quaternion.copy(N),M.scale.set(O,S,O),C.scale.set(G,T,G);const P=v.clone().add(x.clone().multiplyScalar(U)),B=g.clone().add(x.clone().multiplyScalar(-D)),Y=P.clone().add(x.clone().multiplyScalar(S/2)),$=B.clone().add(x.clone().multiplyScalar(-T/2)),H=St(Y),W=St($);M.position.copy(H),C.position.copy(W),M.material.color.copy(L),C.material.color.copy(p),M.material.opacity=.7*_t,C.material.opacity=.7*_t}),f.needsUpdate=!0,t.needsUpdate=!0}function Oi(l){const r=je.node.minRadius,c=je.node.maxRadius,f=Math.max(.1,c-r);l.forEach((t,e)=>{const o=sn(t.id||String(e))%1e3/1e3;t.visualRadius=r+o*f})}function Ii(l,r){Xt=new Map(l.map(c=>[c.id,c])),it=new Map,r.forEach(c=>{const f=Mt(c.source),t=Mt(c.target);it.has(f)||it.set(f,new Set),it.has(t)||it.set(t,new Set),it.get(f).add(t),it.get(t).add(f)})}function sn(l){let r=0;for(let c=0;c<l.length;c+=1)r=r*31+l.charCodeAt(c)|0;return Math.abs(r)}function Bi(l){const r=l.id||`${Mt(l.source)}-${Mt(l.target)}`;if(Xr.has(r))return Xr.get(r);const f=sn(String(r))%1e3/1e3*Math.PI*2;return Xr.set(r,f),f}function ka(){const l=Ce.getGraphBbox?.();let r=null;if(l&&l.x&&l.y&&l.z){const t=l.x[1]-l.x[0],e=l.y[1]-l.y[0],a=l.z[1]-l.z[0],o=Math.max(1,Math.sqrt(t*t+e*e+a*a)*.5),n=no.degToRad(Ce.camera().fov||60);r=o/Math.sin(n/2)}const c=Ce.camera().position.length()||1,f=(r||c)*1.6;Qe.maxDistance=Math.max(f,200)}function ln(){ya=performance.now(),Qe.autoRotate=!1}function Ni(l){const r=l-ya>Ui;Qe.autoRotate=r}function St(l){const r=je.camera.curvatureRadius,c=je.camera.curvatureStrength,t=(l.x*l.x+l.y*l.y)/(r*r)*c;return new ze(l.x,l.y,l.z+t)}function zi(){const l=new Map;return De.nodes.forEach(r=>{l.set(r.id,{x:r.x||0,y:r.y||0,z:r.z||0})}),l}function tn(l){const r=Math.max(16,l-(tn.lastTime||l))/1e3;tn.lastTime=l,De.nodes.forEach(c=>{const f=ct.get(c.id);if(!f)return;const t=$n.get(c.id)||f;c.vx=(f.x-t.x)/r,c.vy=(f.y-t.y)/r,c.vz=(f.z-t.z)/r,c.x=f.x,c.y=f.y,c.z=f.z,c.fx=f.x,c.fy=f.y,c.fz=f.z,$n.set(c.id,{...f})})}function Wi(l){switch(l){case"mlp":return lo(De.nodes);case"dna":return fo(De.nodes);case"metro":return co(De.nodes);case"lattice":return uo(De.nodes);case"planetary":default:return We?.positions||ho(De.nodes)}}function Kt(l,r={}){const c=on.find(e=>e.name===l);if(!c)return;const f=zi();if(l==="planetary"){const e=r.hubId||We?.hubId;We=ia(De.nodes,De.links,{hubId:e}),Ta(),Je.group.visible=!0,Aa()}else Je.group.visible=!1;const t=Wi(l);r.instant?(Ut=null,ct=new Map(t),rn(1)):Ut=bo(f,t,ji()),yr=l,qr=c.label,Ve.setActive(l),Ve.setStatus(`Active: ${qr}`),r.silent||xr.playSwitch()}function ji(){return qn+Math.random()*(_i-qn)}function Vi(l){if(!Ut)return!1;const r=xo(Ut,l,ct);return rn(r.progress),r.done&&(Ut=null,rn(1)),!r.done}function rn(l){if(l<.25){const c=l/.25;_t=(st+(.15-st)*c)/st}else if(l>.75){const c=(l-.75)/.25;_t=(.15+(st-.15)*c)/st}else _t=.15/st;const r=Math.sin(Math.PI*l);dr.forEach(c=>{c.emissiveIntensity=.2+r*.15})}function Hi(l){yr!=="planetary"||Ut||De.nodes.forEach(r=>{const c=mo(r.id,We,l);ct.set(r.id,c)})}function Xi(){ta.setFromCamera($r,br);const r=ta.intersectObjects(Ve.getHitTargets())[0]?.object||null;r!==vr&&(vr=r,Ve.setHover(r?.userData?.name||null))}function Ma(){$e=performance.now(),Ni($e),Xi(),Yi($e),Vi($e)||Hi($e),tn($e),Ri($e),Gi(),Ki($e),Ve.updateHud(br),Qe.update(),xr.tick(De.nodes),requestAnimationFrame(Ma)}function Yi(l){Hr+=1;const r=l-ea;if(r<500)return;const c=Math.round(Hr*1e3/r);Hr=0,ea=l,Ve.setStatus(`Active: ${qr}  ${c} FPS`)}function Ki(l){if(!Je.rings.length)return;const r=(Math.sin(l*.0012)+1)*.5;Je.rings.forEach((c,f)=>{c.material.opacity=.16+r*.08+f*.002})}function Aa(){if(!We)return;const l=Xt.get(We.hubId),r=l?.label||l?.id||We.hubId;Ve.setHub(`Hub: ${r}`)}Ce.onNodeClick(l=>{l&&yr==="planetary"&&Kt("planetary",{hubId:l.id})});window.addEventListener("pointermove",l=>{const r=Ce.renderer().domElement.getBoundingClientRect();$r.x=(l.clientX-r.left)/r.width*2-1,$r.y=-((l.clientY-r.top)/r.height)*2+1});window.addEventListener("pointerdown",l=>{ln(),xr.resumeIfNeeded(),vr&&Ve.handleClick(vr)});window.addEventListener("wheel",ln,{passive:!0});window.addEventListener("keydown",l=>{if(ln(),l.key>="1"&&l.key<="5"){const r=Number(l.key)-1,c=on[r];c&&Kt(c.name)}l.key.toLowerCase()==="p"&&Kt("planetary")});window.addEventListener("resize",()=>{Ce.width(window.innerWidth).height(window.innerHeight),ka()});Oi(De.nodes);Ii(De.nodes,De.links);Di();We=ia(De.nodes,De.links);ct=new Map(We.positions);Ta();Aa();ka();Ve.setStatus("Active: Planetary");Ce.width(window.innerWidth).height(window.innerHeight);Kt("planetary",{instant:!0,silent:!0});Ma();
