function w(e){let t=e>>>0;return()=>{t+=1831565813;let r=Math.imul(t^t>>>15,1|t);return r^=r+Math.imul(r^r>>>7,61|r),((r^r>>>14)>>>0)/4294967296}}function g(e,t){return t[Math.floor(e()*t.length)]}function y(e,t,r){return Math.max(t,Math.min(r,e))}function E({nodeCount:e=90,linkFactor:t=2.2,seed:r=1337}={}){const o=w(r),c=y(e,60,120),h=["system","layer","artifact","actor","project"],a=Array.from({length:c},(s,i)=>{const u=g(o,h),f=y(o()*1.4+.2,.1,1.6);return{id:`n${i+1}`,label:`${u}-${i+1}`,group:u,importance:f}}),n=[],l=Math.floor(c*t);for(let s=1;s<a.length;s+=1){const i=a[s-1].id,u=a[s].id;n.push({source:i,target:u,weight:o()*.9+.1})}for(;n.length<l;){const s=g(o,a).id,i=g(o,a).id;if(s===i)continue;const u=`${s}-${i}`;n.some(f=>`${f.source}-${f.target}`===u)||n.push({source:s,target:i,weight:o()*.9+.1})}return{nodes:a,links:n}}const p={LOCAL_DEMO:"localDemo",EXTERNAL:"external"},d={type:"concept",visibility:"public",status:"expandable",semantics:{role:"content",abstraction:"medium"},rag:{index:!0,priority:.5}},L={knowledge:new Set(["domain","concept","character"]),system:new Set(["root","hub","module","spec","process","policy"])};async function O(e=p.LOCAL_DEMO,t={}){switch(e){case p.LOCAL_DEMO:return A(t.demoOptions||{},t.view||"all");case p.EXTERNAL:return b(t.externalUrl,t.view||"all");default:throw new Error(`Unknown graph source: ${e}`)}}async function A(e={},t){const r=E(e),o=m(r.nodes,r.links,t);return{nodes:o.nodes,links:o.links,meta:{source:p.LOCAL_DEMO,generated_at:new Date().toISOString()}}}async function b(e,t){const r=S(e||"universe.json"),o=await v(r);if(!o||!Array.isArray(o.nodes)||!Array.isArray(o.edges))throw new Error("Invalid universe.json schema: expected { nodes: [], edges: [] }");const c=o.nodes.map(n=>D(n)),h=o.edges.map(n=>({...n,type:n.type||"relates"})),a=m(c,h,t);return{nodes:a.nodes,links:a.links,meta:{source:p.EXTERNAL,url:r}}}function D(e){const t={...d.semantics,...e.semantics||{}},r={...d.rag,...e.rag||{}};return{...e,type:e.type||d.type,visibility:e.visibility||d.visibility,status:e.status||d.status,semantics:t,rag:r}}function m(e,t,r){if(r==="all")return{nodes:e,links:t};const o=L[r];if(!o)return{nodes:e,links:t};const c=new Set,h=e.filter(n=>{const l=n.type||d.type,s=l&&o.has(l);return s&&c.add(n.id),s}),a=t.filter(n=>{const l=typeof n.source=="object"?n.source.id:n.source,s=typeof n.target=="object"?n.target.id:n.target;return c.has(l)&&c.has(s)});return{nodes:h,links:a}}function S(e){try{return new URL(e,window.location.href).toString()}catch{throw new Error(`Invalid graphUrl: ${e}`)}}async function v(e){const t=await fetch(M(e));if(!t.ok)throw new Error(`Failed to load graph: ${t.status} ${t.statusText}`);return t.json()}function M(e){const t=new URL(e,window.location.href);return t.searchParams.set("t",Date.now().toString()),t.toString()}export{p as G,O as l};
