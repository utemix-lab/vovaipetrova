import{l as z}from"./adapter-CtpVqGLt.js";const m=document.getElementById("graph");if(!m)throw new Error("Missing #graph container");m.innerHTML="";const g=document.createElement("div");g.id="universeMap";const c=document.createElement("canvas");c.id="universeCanvas";g.appendChild(c);m.appendChild(g);const i=c.getContext("2d");if(!i)throw new Error("Canvas not supported");const t={nodes:[],links:[],clusters:new Map,nodePositions:new Map,visibleNodes:new Set,visibleLinks:new Set,focusedId:null,focusedIds:new Set,hoveredId:null,zoom:1,pan:{x:0,y:0},drag:null,filterTypes:new Set,types:[]};function b(){c.width=window.innerWidth,c.height=window.innerHeight,E(),u()}function P(e){return e.clusterId||e.type||"default"}function T(){t.clusters.clear(),t.nodePositions.clear(),t.nodes.forEach(e=>{const n=P(e);t.clusters.has(n)||t.clusters.set(n,{id:n,nodes:[],collapsed:!1,center:{x:0,y:0},radius:0}),t.clusters.get(n).nodes.push(e)})}function v(){const e=Array.from(t.clusters.values()),n=e.length||1,s=220+Math.sqrt(t.nodes.length)*12;e.forEach((o,a)=>{const d=a/n*Math.PI*2;if(o.center.x=Math.cos(d)*s,o.center.y=Math.sin(d)*s,o.radius=20+Math.sqrt(o.nodes.length)*4,o.collapsed){o.nodes.forEach(r=>{t.nodePositions.set(r.id,{x:o.center.x,y:o.center.y})});return}const l=o.radius+14;o.nodes.forEach((r,f)=>{const h=f/o.nodes.length*Math.PI*2,p=o.center.x+Math.cos(h)*l,y=o.center.y+Math.sin(h)*l;t.nodePositions.set(r.id,{x:p,y})})})}function Y(){t.visibleNodes.clear(),t.visibleLinks.clear(),t.nodes.forEach(e=>{(t.filterTypes.size===0||t.filterTypes.has(e.type))&&t.visibleNodes.add(e)}),t.links.forEach(e=>{const n=typeof e.source=="object"?e.source.id:e.source,s=typeof e.target=="object"?e.target.id:e.target,o=t.nodes.find(d=>d.id===n),a=t.nodes.find(d=>d.id===s);!o||!a||t.visibleNodes.has(o)&&t.visibleNodes.has(a)&&t.visibleLinks.add(e)}),u()}function x(e,n){return{x:(e-t.pan.x)/t.zoom,y:(n-t.pan.y)/t.zoom}}function L(e,n){return{x:e*t.zoom+t.pan.x,y:n*t.zoom+t.pan.y}}function I(e,n){const s=x(e,n);let o=null,a=1/0;t.visibleNodes.forEach(l=>{const r=t.nodePositions.get(l.id);if(!r)return;const f=r.x-s.x,h=r.y-s.y,p=Math.sqrt(f*f+h*h);p<a&&(a=p,o=l)});const d=14/t.zoom;return a<d?o:null}function N(e,n){const s=x(e,n);let o=null;return t.clusters.forEach(a=>{const d=a.center.x-s.x,l=a.center.y-s.y;Math.sqrt(d*d+l*l)<a.radius&&(o=a)}),o}function u(){if(i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,c.width,c.height),i.fillStyle="#050506",i.fillRect(0,0,c.width,c.height),i.setTransform(t.zoom,0,0,t.zoom,t.pan.x,t.pan.y),i.lineWidth=1/t.zoom,i.globalAlpha=.45,i.strokeStyle="#6b7280",t.visibleLinks.forEach(e=>{const n=typeof e.source=="object"?e.source.id:e.source,s=typeof e.target=="object"?e.target.id:e.target,o=t.nodePositions.get(n),a=t.nodePositions.get(s);!o||!a||(i.beginPath(),i.moveTo(o.x,o.y),i.lineTo(a.x,a.y),i.stroke())}),t.clusters.forEach(e=>{e.nodes.some(s=>t.visibleNodes.has(s))&&(i.globalAlpha=.18,i.fillStyle="#1f2937",i.beginPath(),i.arc(e.center.x,e.center.y,e.radius,0,Math.PI*2),i.fill())}),t.visibleNodes.forEach(e=>{const n=t.nodePositions.get(e.id);if(!n)return;const s=e.id===t.focusedId||t.focusedIds.has(e.id),o=e.id===t.hoveredId,a=s?6:o?5:4;i.globalAlpha=1,i.fillStyle=s?"#f59e0b":"#9ca3af",i.beginPath(),i.arc(n.x,n.y,a,0,Math.PI*2),i.fill()}),t.hoveredId){const e=t.nodes.find(s=>s.id===t.hoveredId),n=t.nodePositions.get(t.hoveredId);if(e&&n){i.setTransform(1,0,0,1,0,0),i.fillStyle="#e5e7eb",i.font="12px Segoe UI";const s=e.title||e.label||e.id,o=L(n.x,n.y);i.fillText(s,o.x+8,o.y-8)}}}function S(){t.filterTypes.clear(),t.types.forEach(e=>t.filterTypes.add(e))}function E(){if(t.nodePositions.size===0)return;let e=1/0,n=-1/0,s=1/0,o=-1/0;t.nodePositions.forEach(y=>{e=Math.min(e,y.x),n=Math.max(n,y.x),s=Math.min(s,y.y),o=Math.max(o,y.y)});const a=Math.max(1,n-e),d=Math.max(1,o-s),l=.7,r=c.width/a*l,f=c.height/d*l;t.zoom=Math.min(4,Math.max(.2,Math.min(r,f)));const h=(e+n)/2,p=(s+o)/2;t.pan.x=c.width/2-h*t.zoom,t.pan.y=c.height/2-p*t.zoom}function w(e,n){const s=z(e);t.nodes=s.nodes,t.links=s.links,t.types=Array.from(new Set(s.nodes.map(o=>o.type).filter(Boolean))).sort(),T(),v(),S(),Y(),E()}function X(e){const n=new CustomEvent("graph:nodeFocus",{detail:{id:e}});window.dispatchEvent(n)}function F(e){const n=new CustomEvent("graph:setFocusedIds",{detail:{ids:e}});window.dispatchEvent(n)}window.addEventListener("graph:nodeFocus",e=>{e.detail?.id&&(t.focusedId=e.detail.id,u())});window.addEventListener("graph:setFocusedIds",e=>{Array.isArray(e.detail?.ids)&&(t.focusedIds=new Set(e.detail.ids),u())});c.addEventListener("mousemove",e=>{const n=I(e.clientX,e.clientY);n?.id!==t.hoveredId&&(t.hoveredId=n?n.id:null,u())});c.addEventListener("mousedown",e=>{t.drag={x:e.clientX,y:e.clientY,panX:t.pan.x,panY:t.pan.y}});c.addEventListener("mouseup",e=>{if(!t.drag)return;if(Math.abs(e.clientX-t.drag.x)+Math.abs(e.clientY-t.drag.y)<5){const s=N(e.clientX,e.clientY);if(s){s.collapsed=!s.collapsed,v(),u(),t.drag=null;return}const o=I(e.clientX,e.clientY);o&&(t.focusedId=o.id,X(o.id),F([o.id]),u())}t.drag=null});c.addEventListener("mousemove",e=>{t.drag&&(t.pan.x=t.drag.panX+(e.clientX-t.drag.x),t.pan.y=t.drag.panY+(e.clientY-t.drag.y),u())});c.addEventListener("wheel",e=>{e.preventDefault();const n=Math.exp(-e.deltaY*.001),{x:s,y:o}=x(e.clientX,e.clientY);t.zoom=Math.min(4,Math.max(.3,t.zoom*n)),t.pan.x=e.clientX-s*t.zoom,t.pan.y=e.clientY-o*t.zoom,u()},{passive:!1});window.addEventListener("resize",b);b();const M=new URLSearchParams(window.location.search).get("dataUrl");M?fetch(M).then(e=>e.json()).then(e=>w(e)).catch(e=>console.error(e)):w(A(280));function A(e){const n=["actor","artifact","layer","project","system","concept"],s=["core","orbit","tools","labs","meta","archive"],o=[],a=[],d=(()=>{let r=1337;return()=>(r=r*16807%2147483647,(r-1)/2147483646)})();for(let r=0;r<e;r+=1)o.push({id:`node-${r}`,title:`Node ${r+1}`,type:n[Math.floor(d()*n.length)],clusterId:s[Math.floor(d()*s.length)]});const l=Math.floor(e*2.2);for(let r=0;r<l;r+=1){const f=o[Math.floor(d()*e)].id;let h=o[Math.floor(d()*e)].id;h===f&&(h=o[(Math.floor(d()*(e-1))+1)%e].id),a.push({source:f,target:h})}return{schema:"cosmos-map.v0.1",nodes:o,links:a}}
