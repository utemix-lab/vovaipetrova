# Windows and Layers — краткое руководство

Цель: зафиксировать простую, машинно‑дружественную нотацию для описания правок UI, логики и мостов между окнами.

## !CRITICAL: Композиция панелей 16:9

**Эти правила НЕ ИЗМЕНЯТЬ без согласования — сломает визуальную целостность.**

### Структура

```
┌─────────────┬─────────────┬─────────────┐
│             │             │   System    │
│    Story    │   Graph /   ├─────────────┤
│    (W1)     │   Segment   │   Service   │
│             │    (W4)     │    (W3)     │
└─────────────┴─────────────┴─────────────┘
      1fr          1fr           1fr
```

- **Grid:** 3 равные колонки (`1fr 1fr 1fr`)
- **Right-column:** содержит System + Service (по `1fr` каждая)
- **Segment:** появляется в центральной колонке поверх графа (контекстное окно)

### Поведение при hover

| Состояние | Активная панель | Неактивные панели |
|-----------|-----------------|-------------------|
| **transform** | `scale(1.02)` | **НЕТ** (остаются `scale(1)`) |
| **opacity** | `1` | `0.5` |
| **z-index** | `12` | — |
| **transform-origin** | `center center` | `center center` |

**!CRITICAL:** Неактивные панели НЕ УМЕНЬШАЮТСЯ — это сохраняет композицию 16:9.

### При narrative-expanded

- Все панели: `transform: none !important`, `opacity: 1`
- Narrative-screen перекрывает всю композицию

### CSS файл

Критические правила находятся в `render/src/scenes/visitor.css` с пометкой `/* !CRITICAL */`.

---

## Нотация

### Окна (Windows)

Дополнительно: поведение Visitor Scene зафиксировано в `docs/visitor-scene.md` (рычаги, точки, preactive ответы).

### Слои (Layers)

- UI  — интерфейс (кнопки, расположение, подписи, хоткеи)
- LOGIC — внутренняя механика и состояния внутри окна (режимы, стейт‑машины, кеши)
- BRIDGE — мосты / передачи данных между окнами

### Формат маркировки примера

- `W1→W2.BRIDGE`: как Story передаёт выбор в System

## Краткое описание окон

### W1: Story

- Суть: онтология, страницы, переходы и описания.
- Правила (3–5):
  - `W1.UI`: В Story нет инструментов для выполнения сервисных запросов — только навигация и выбор контекста.
  - `W1.LOGIC`: State в Story ограничен навигацией и отображением контента (no processing heavy logic).
  - `W1→W2.BRIDGE`: Передаётся только выбранный контекст/узел (draft) — остальные трансформации делает System.

### W2: System

- Суть: внутренние режимы, практики, управление запросами, обработка контекста.
- Правила (3–5):
  - `W2.UI`: Кнопки режимов должны быть ярко помечены и иметь явные хоткеи (описание в UI слое).
  - `W2.LOGIC`: Режимы (например Query Mode) — отдельные state‑машины, document stability (stable|experimental|sketch).
  - `W2→W3.BRIDGE`: System формирует и валидирует payload для Service; пока draft, можно менять.

### W3: Service

- Суть: выдача по запросам, интеграция с внешними API/каталогами.
- Правила (3–5):
  - `W3.UI`: В Service только результаты и minimal controls (refresh, retry).
  - `W3.LOGIC`: Логика запросов отделена от UI; кеширование и rate limiting документированы.
  - `W1←W3.BRIDGE`: Результаты могут быть переданы обратно в Story как read‑only данные.

### W4: Segment (контекстное)

- Суть: карточка единицы знаний из каталога. Появляется при необходимости, не постоянное окно.
- Позиция: центр экрана, поверх графа (между Story и System/Service).
- Контекст по воркбенчам:
  - **VSTablishment**: карточка VST-инструмента / плагина
  - **Animation**: карточка мультфильма / анимации
  - **AI Models**: карточка ИИ-модели
  - **Services**: карточка сервиса / программы
- Правила:
  - `W4.UI`: Структура аналогична Story — виджет, текст (3 строки), мини-окно 16:9.
  - `W4.LOGIC`: Отображает данные из каталога (catalogs/). Появляется при выборе элемента.
  - `W1→W4.BRIDGE`: Story передаёт ID выбранного элемента каталога.
  - `W4→W2.BRIDGE`: Segment может передать контекст в System для дальнейшей обработки.
- Stability: **experimental**

## Stability (короткая нотация)

- Добавляйте ярлык Stability: stable | experimental | sketch
- Пример: `W2:System — набор режимов (sketch), но концепция Practicies/Capabilities (stable)`

---
Это краткий справочник — держите текст коротким и машинно‑читаемым. Каждая правка или таск должна начинаться с подписи области (Scope).
