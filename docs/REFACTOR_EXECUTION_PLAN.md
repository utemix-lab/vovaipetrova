# Refactor Execution Plan (Agent-Mandatory)

Этот план должен выполняться последовательно и не может быть пропущен.

## Общие правила

1. Перед каждым шагом: прочитать `.agent/context.yml` и `docs/AGENT_TASK_TEMPLATE.md`.
2. Каждый шаг фиксируется в чате:
   - «Что делаю сейчас»
   - «Что сделал»
   - «Что будет следующим»
3. После каждого шага: запустить `npm run arch-lint` и `npm run check:fast`.
4. Любая правка в ключевых модулях требует импорт `architecture/dna` и `@ArchProto`.

## Шаги (выполнять по порядку)

### Шаг 0 — Подготовка безопасного старта
- Убедиться, что ветка чистая и есть checkpoint‑коммит.
- Зафиксировать текущую фазу из `render/src/architecture/dna.ts`.

### Шаг 1 — Минимальная React‑обёртка графа
- Создать React‑точку входа (App + GraphScene) без изменения логики графа.
- Обеспечить совместимость с текущей Vite сборкой.
- Зафиксировать минимальный стейт (selectedNode) и синхронизацию с 3D.

### Шаг 2 — Абстракция GraphEngine
- Ввести интерфейс `IGraphEngine`.
- Вынести текущий Three.js код в `ThreeGraphEngine`.
- Включить базовые события и управление фокусом.

### Шаг 3 — Декларативный UI‑слой
- Перевести один UI‑компонент (например, Inspector) на React.
- Связать его с общим стейтом графа.

### Шаг 4 — Анимации
- Добавить Framer Motion для переходов (минимальный кейс).
- Проверить, что анимации отражают «агентное внимание».

## Формат отчёта в чате (обязателен)

```
Этап: <номер/название>
Сейчас: <кратко, что делаю>
Сделано: <2-4 пункта>
Далее: <следующий шаг и критерий готовности>
```
