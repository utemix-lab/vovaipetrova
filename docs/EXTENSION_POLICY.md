# Extension Policy — Политика расширения графа

**Дата:** 18 февраля 2026  
**Статус:** Обязательный документ  
**Применяется к:** VST Semantic Graph и любым USG-совместимым графам  

---

## Назначение

Этот документ определяет **когда и как** расширять семантический граф.

Без этой политики через 500 узлов:
- появятся дубликаты типов (`Articulation`, `PlayingArticulation`, `ExecutionArticulation`)
- размоется граница между узлами и атрибутами
- начнётся семантическая эрозия

---

## 1. Когда создавать новый узел?

### Узел создаётся, если концепт:

| Критерий | Описание |
|----------|----------|
| **Повторяем** | Встречается минимум в 2+ инструментах/контекстах |
| **Объясним** | Имеет собственное определение (definition) |
| **Связываем** | Участвует в логических связях с другими концептами |
| **Фильтруем** | Может использоваться как критерий фильтрации в UI |

### Примеры

✅ **Создать узел:**
- "Legato" — повторяется, имеет определение, связан с механизмами
- "Cinematic" — жанр, используется для фильтрации
- "Warm" — характер, объясним, связан с синтезом

❌ **НЕ создавать узел:**
- "Chaos Dial" — уникальная ручка одного инструмента
- "Version 2.5.1" — техническая деталь
- "Blue interface" — визуальное свойство

---

## 2. Когда использовать local_feature?

### Local feature допускается, если свойство:

| Критерий | Описание |
|----------|----------|
| **Уникально** | Существует только у одного объекта |
| **Не логично** | Не участвует в семантических связях |
| **Не фильтруемо** | Не нужно для поиска/фильтрации |

### Формат

```json
{
  "id": "serum",
  "local_features": [
    {
      "name": "Chaos Oscillator",
      "description": "Unique random waveform generator"
    }
  ]
}
```

### Правило перехода

Если `local_feature` начинает встречаться в 3+ инструментах:
→ **Создать узел** и заменить local_features на связи.

---

## 3. Когда создавать новый тип узла?

### Новый тип создаётся, если:

1. Концепт **не вписывается** в существующие типы
2. Появляется минимум в **3+ узлах**
3. Имеет **уникальные связи**, отличные от существующих типов
4. Участвует в **объяснениях** или **операторах**

### Процедура добавления

1. Обсудить необходимость (не добавлять спонтанно)
2. Определить:
   - `domain`
   - `abstraction_level`
   - `required_fields`
   - `allowed_outgoing` связи
3. Добавить в `node-types.json`
4. При необходимости обновить `relation-types.json`
5. Запустить `validator.js`

### Примеры

✅ **Создать новый тип:**
- `Engine` — движок синтеза (Kontakt, PLAY, Sine Player) — отличается от Instrument
- `Preset` — пресет инструмента — имеет уникальные связи

❌ **НЕ создавать новый тип:**
- `StringArticulation` — это просто `PerformanceArticulation` с фильтром
- `OrchestralGenre` — это просто `Genre` с parent

---

## 4. Когда создавать новый тип связи?

### Новая связь создаётся, если:

1. Отношение **семантически отличается** от существующих
2. Имеет **уникальные ограничения** `from → to`
3. Используется минимум в **5+ случаях**

### Запрещённые связи

| Тип | Почему запрещён |
|-----|-----------------|
| `HAS_THING` | Аморфная, не семантическая |
| `RELATED` | Слишком общая (используй `RELATED_TO` с контекстом) |
| `LINK` | Не несёт смысла |

### Процедура добавления

1. Определить `from` и `to` типы
2. Определить семантику (глагол действия)
3. Добавить в `relation-types.json`
4. Обновить `node-types.json` → `allowed_outgoing`
5. Запустить `validator.js`

---

## 5. Иерархия решений

```
Новая сущность появилась
         │
         ▼
   Повторяема? ──────────────────────────────────────┐
         │                                            │
        YES                                          NO
         │                                            │
         ▼                                            ▼
   Объяснима? ──────────────────────┐          local_feature
         │                          │
        YES                        NO
         │                          │
         ▼                          ▼
   Вписывается в                local_feature
   существующий тип?
         │
    ┌────┴────┐
   YES       NO
    │         │
    ▼         ▼
  Создать   Создать
   узел     новый тип
            (если 3+ случаев)
```

---

## 6. Валидация перед добавлением

### Чек-лист для нового узла

- [ ] `node_type` из реестра
- [ ] `domain` указан
- [ ] `definition` написан
- [ ] Связи используют зарегистрированные типы
- [ ] Нет дубликата ID

### Чек-лист для нового типа

- [ ] Добавлен в `node-types.json`
- [ ] Указаны `required_fields`
- [ ] Указаны `allowed_outgoing`
- [ ] Обновлён `relation-types.json` (если нужно)
- [ ] Валидатор проходит

### Команда валидации

```bash
cd worlds/vovaipetrova/catalogs
node validator.js --verbose
```

---

## 7. Антипаттерны

### ❌ Что НЕ делать

| Антипаттерн | Почему плохо |
|-------------|--------------|
| Создавать узел для каждого свойства | Раздувает граф |
| Использовать строковые массивы | Теряется семантика |
| Добавлять тип без 3+ примеров | Преждевременная абстракция |
| Копировать типы с минимальными отличиями | Семантическая эрозия |
| Игнорировать валидатор | Накопление ошибок |

### ✅ Что делать

| Паттерн | Почему хорошо |
|---------|---------------|
| Использовать существующие типы | Консистентность |
| Добавлять связи вместо атрибутов | Семантическая сила |
| Запускать валидатор после изменений | Раннее обнаружение ошибок |
| Документировать новые типы | Понятность для будущего |

---

## 8. Версионирование

При значительных изменениях в типах:

1. Увеличить версию в `node-types.json`
2. Добавить запись в CHANGELOG
3. Обновить документацию

---

## 9. Связанные документы

| Документ | Описание |
|----------|----------|
| `UNIVERSAL_SEMANTIC_GRAPH_STANDARD.md` | Базовый стандарт |
| `VST_ONTOLOGY_PROFILE.md` | Профиль VST-графа |
| `catalogs/node-types.json` | Реестр типов узлов |
| `catalogs/relation-types.json` | Реестр типов связей |
| `catalogs/validator.js` | Автоматическая валидация |

---

## 10. Главное правило

> **Сомневаешься — не создавай.**
> 
> Лучше подождать, пока концепт докажет свою повторяемость,
> чем создать лишний тип и потом мигрировать данные.

---

*Этот документ обязателен к прочтению перед любым расширением графа.*
