# ARCHITECTURE TRACKS — v3.0

**Дата:** 13 февраля 2026

> **Статус системы:** [`STATUS.md`](../STATUS.md) — главная точка входа.

---

## Контекст

Разработка, описание и анализ системы организованы по **трекам (Tracks)** — независимым плоскостям рассмотрения одной и той же системы.

**Треки не являются частями системы**, а представляют собой **ракурсы её понимания** и работы с ней.

Каждый трек отвечает на свой вопрос и обеспечивает дисциплину мышления, чтобы не смешивать уровни.

---

## Общие принципы

```
Система едина — есть один мир, один движок, один набор операторов, один UI.
```

- **Tracks = ракурсы / методология**, а не модули
- Ни один трек не определяет другой
- Связи между треками возможны только через **явно определённые интерфейсы**
- Цель — многослойная читаемость и управление проектом без смешения уровней

---

## TRACK 0 — Meta / Product / Reflexive Layer

**Вопрос:** Что такое Платформа как самостоятельный продукт?

### Назначение

- Позиционирование платформы
- Презентация, демонстрация, интерактивная «Кабина платформы»
- Само-описание системы и режим разговора системы о себе

### Примеры

- HF Spaces демо-интерфейс
- Интерфейс с LLM, объясняющей устройство платформы
- Режим Platform-only без привязки к Миру

### Ограничения

- Не изменяет Ontology
- Не изменяет Schema
- Не создаёт сущности Мира
- Может использовать Operators

**Важно:** Track 0 — надстройка над системой, а не часть онтологии или движка.

---

## TRACK 1 — Ontology (Universe Layer)

**Вопрос:** Что существует в Мире?

### Содержит

- Типы узлов (Character, Domain, Workbench, Collab, System Nodes)
- Типы связей (operates_in, has, focuses_on, participates_in, intersects)
- Graph Invariance Principle
- Distinction Projection Layer vs Graph

### Не содержит

- UI-режимы
- LLM
- Operators
- Платформенную логику

### Принцип

```
Graph = invariant.
Онтология не меняется инструментами.
Она описывает существующее.
```

---

## TRACK 2 — Schema / Engine Layer

**Вопрос:** Как онтология реализована технически?

### Содержит

- `schema.json`
- Структуры данных
- Контракты
- Ограничения
- Формальные модели

### Важно

```
Schema может не совпадать полностью с Ontology.
Schema может быть оптимизированной и нормализованной.
```

```
Schema ≠ UI
Schema ≠ Narrative
```

---

## TRACK 3 — Operators / Epistemic Mechanics

**Вопрос:** Как система действует? Как узнаём?

> **Концепция:** [`OPERATORS_CONCEPT.md`](./OPERATORS_CONCEPT.md) — полное описание.

### Содержит

- **Epistemic Operators** — PROJECT, FILTER, EXPAND, INTERSECT
- **Catalogs** — внешние данные, живущие вне графа
- **Pointer-tags** — ключи доступа к каталогам
- Трансформации графа
- Аналитические механики
- Интеграцию LLM

### Ключевое разделение

| Механизм | Назначение |
|----------|------------|
| Graph (Track 1) | Что существует (онтология) |
| Catalogs | На что указываем (данные) |
| Operators | Как узнаём (эпистемология) |
| Projections (Track 4) | Как отображаем (визуализация) |

### Принцип

```
Operators используют Graph + Catalogs,
но не создают узлы графа.
Результат оператора — временный взгляд, не онтология.
```

**Кабины** — интерфейс доступа к Operators, всегда остаются Track 3 + Track 4.

---

## TRACK 4 — Projection / UI / Cryptocosm Layer

**Вопрос:** Как система отображается?

### Содержит

- Художественную раскладку узлов
- Метафорические связи
- Режимы Universe / Cryptocosm
- Подсветки
- Кабины как интерфейс
- **Загрузку и отображение ассетов**

### Принцип

```
Projection = mutable
Graph = invariant
```

- UI-типы не являются онтологическими
- UI-типы не обязаны соответствовать schema-типам
- **Cryptocosm** — художественная проекция платформы, а не альтернативная онтология

---

## Архитектура слоёв Платформы

```
┌─────────────────────────────────────────────────────────────────────┐
│                         ПЛАТФОРМА                                   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                      ENGINE (ядро)                           │   │
│  │                                                              │   │
│  │  - MeaningEngine, Schema, Graph                              │   │
│  │  - Операторы (PROJECT, FILTER, EXPAND, ...)                  │   │
│  │  - CatalogRegistry, CatalogLoader                            │   │
│  │  - Валидация, контракты                                      │   │
│  │                                                              │   │
│  │  НЕ знает об ассетах. НЕ рендерит. Только данные и логика.  │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                              │                                      │
│                              ▼ данные (JSON)                        │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                      RENDER (UI)                             │   │
│  │                                                              │   │
│  │  - React-компоненты                                          │   │
│  │  - Загружает ассеты из Мира по путям из каталогов            │   │
│  │  - Отображает страницы, узлы, каталоги                       │   │
│  │  - Кэширует и оптимизирует ассеты                            │   │
│  │                                                              │   │
│  │  Знает об ассетах. Рендерит. Работает с UI.                  │   │
│  └─────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
                               │
                               ▼ запрашивает
┌─────────────────────────────────────────────────────────────────────┐
│                         МИР (World)                                 │
│                                                                     │
│  catalogs/                   assets/                                │
│  ├── vst-plugins.json        ├── vst/                               │
│  │   cover: "assets/..."     │   ├── serum.jpg                      │
│  ├── films.json              │   └── ...                            │
│  │   poster: "assets/..."    ├── films/                             │
│  └── ...                     │   └── ...                            │
│                              └── companies/                         │
│  graph.json                      └── ...                            │
│  schema.json                                                        │
│                                                                     │
│  Ассеты — данные Мира, не Платформы.                               │
│  Каталоги содержат пути к ассетам, но не сами ассеты.              │
└─────────────────────────────────────────────────────────────────────┘
```

### Разделение ответственности

| Слой | Знает об ассетах? | Загружает? | Рендерит? |
|------|-------------------|------------|-----------|
| **Engine** | Нет (только пути в данных) | Нет | Нет |
| **Render** | Да | Да | Да |
| **World** | Да (хранит) | — | — |

### Поток данных для ассетов

1. **Engine** читает каталог → `{ id: "serum", cover: "assets/vst/serum.jpg" }`
2. **Engine** передаёт данные в **Render**
3. **Render** видит путь `cover` → загружает файл из **World**
4. **Render** отображает изображение

Engine работает с **метаданными**, Render — с **файлами**

---

## Принцип читаемости системы

| Что читает | Через что |
|------------|-----------|
| Мир читаем Платформой | Graph |
| Платформа читаема LLM | Спецификация |
| Система читаема человеком | UI |
| Платформа может рассказывать о себе | Track 0 |

**Это не графоцентричность, а многослойная просматриваемость.**

---

## Критические запреты для агента

| Запрет | Объяснение |
|--------|------------|
| UI не может определять онтологию | Track 4 ≠ Track 1 |
| Schema не может определять Narrative | Track 2 ≠ Track 4 |
| Operators не могут изменять Ontology | Track 3 ≠ Track 1 |
| Meta-режим не может вмешиваться в Graph | Track 0 ≠ Track 1 |
| Проекция не равна структуре | Projection ≠ Graph |

---

## Итоговая модель

| Track | Уровень | Отвечает на вопрос |
|-------|---------|-------------------|
| **0** | Meta/Product | Что такое Платформа? |
| **1** | Ontology | Что существует? |
| **2** | Schema/Engine | Как это реализовано? |
| **3** | Operators | Как это действует? |
| **4** | Projection/UI | Как это отображается? |

---

## Статус реализации

| Track | Статус |
|-------|--------|
| Track 0 | Впервые формализован |
| Track 1 | Стабилизирован |
| Track 2 | Частично реализован |
| Track 3 | **Полностью реализован** (194 теста) |
| Track 4 | Активно проектируется |

---

## Связанные документы

| Документ | Описание |
|----------|----------|
| `../worlds/vovaipetrova/ONTOLOGY.md` | Спецификация онтологии v1.0 |
| `../ARCHITECTURE.md` | Архитектура платформы |
| `../engine/WORLD_CONTRACT.md` | Контракт Engine ↔ World |
| `../engine/docs/OPERATORS_API.md` | API эпистемических операторов |
| `./OPERATORS_CONCEPT.md` | Концепция Track 3 |
| `../repair-shop/ROADMAP.md` | Дорожная карта проекта |
