# UI Standards — Стандарты интерфейса

**Track 4: Projection/UI**  
**Статус:** stable  
**Связанные документы:** `windows.md`, `ARCHITECTURE_TRACKS.md`

---

## S-Naming Convention (Система именования)

Все окна интерфейса называются на букву **S** — стилистический ход.

### Типы окон

| Тип | Окна | Описание |
|-----|------|----------|
| **Постоянные** | Scope, System, Service | Всегда видны в интерфейсе |
| **Вложенные** | Story | Мини-окно внутри Scope, не везде присутствует |
| **Вызываемые** | Slate, Storage, Sanctum | Открываются через виджеты на страницах воркбенчей |

### Окна интерфейса

| Окно | Назначение | Особенности |
|------|------------|-------------|
| **Scope** | Главное окно навигации по графу | Содержит Story (мини-окно) |
| **System** | Системная информация | Постоянное |
| **Service** | Сервисные функции | Постоянное |
| **Story** | Мини-окно с 3D-фигурой и ассетом | Название скрыто в свёрнутом состоянии |
| **Slate** | Новостная лента персонажа | Вызывается виджетом |
| **Storage** | Граф воркбенча (VST-граф) | Вызывается виджетом, имеет кнопочную навигацию |
| **Sanctum** | Внутренняя механика персонажа (LLM) | Вызывается виджетом |

**Источник:** Переименования в коде: `story-panel` → `scope-panel`, `narrative-screen` → `story-screen`

---

## Категории виджетов

### Таблица форм виджетов

| Категория | Форма | Размер | Назначение | CSS-класс |
|-----------|-------|--------|------------|-----------|
| **Навигационные** | Круг ⚫ | ⌀48px | Навигация по основному графу | `.widget-nav` |
| **Окон** | Квадрат ⬛ | 48×48px | Вызов дополнительных окон | `.widget-window` |
| **Практик** | Треугольник △ | 48×48px | Практики (со срезанными углами) | `.widget-practice` |

### Навигационные виджеты (круглые)

Ассоциация с шаром/узлом графа. Используются для навигации между узлами.

| Тип узла | Иконка | Файл |
|----------|--------|------|
| Character | character-plug.png | `assets/widgets/` |
| Domain | domain-plug.png | `assets/widgets/` |
| Workbench | workbench-plug.png | `assets/widgets/` |
| Collab | collab-plug.png | `assets/widgets/` |
| Hub | hub-plug.png | `assets/widgets/` |
| Root | root-plug.png | `assets/widgets/` |

### Виджеты окон (квадратные)

Вызывают дополнительные окна. Расположены на страницах воркбенчей.

| Виджет | Окно | Файл | Описание |
|--------|------|------|----------|
| **Slate** | Slate | slate-plug.png | Новостная лента персонажа |
| **Storage** | Storage | storage-plug.png | Граф воркбенча (VST-граф) |
| **Sanctum** | Sanctum | sanctum-plug.png | Внутренняя механика (LLM) |

**Расположение на странице воркбенча:**
```
┌─────────────────────────────────────────┐
│ ДОМЕНЫ        ВОРКБЕНЧИ       КОЛЛАБЫ   │  ← Навигационные (круглые)
│ ⚫ ⚫ ⚫        ⚫ ⚫            ⚫ ⚫       │
│                                         │
│ SLATE         STORAGE        SANCTUM    │  ← Окон (квадратные)
│ ⬛             ⬛              ⬛         │
└─────────────────────────────────────────┘
```

### Виджеты практик (треугольные)

*Будет определено позже.*

---

## Рабочий процесс Track 4

```
Детали → Паттерны → Стандарты → Рефакторинг → Код
```

| Этап | Описание |
|------|----------|
| **Детали** | Работа с конкретными элементами UI |
| **Паттерны** | Выявление повторяющихся решений |
| **Стандарты** | Фиксация в этом документе |
| **Рефакторинг** | Унификация кода под стандарты |
| **Код** | Применение CSS-переменных |

### Комплекс задач

| Область | Описание |
|---------|----------|
| **Стандарты** | Унификация цветов, шрифтов, отступов, анимаций |
| **Шаблоны страниц** | Character, Workbench, Domain, Collab |
| **Компоненты** | Виджеты, мини-окна, точки, панели |
| **Механики** | Hover, bounce, glow, состояния |

---

## Шаблон страницы Scope (Page Template)

Все страницы окна Scope следуют единому шаблону из 3+ блоков:

### Блок 1: Header (node-toc)

```
┌─────────────────────────────────────────┐
│ [Корневой виджет]  Название — тип       │
│                    Роль в системе — ... │
│                    Технический профиль  │
└─────────────────────────────────────────┘
```

- **CSS-класс:** `.node-toc`
- **Содержит:** корневой виджет + текст (T2)
- **Отступы:** `--panel-inset` по краям

### Блок 2: Story (мини-окно)

```
┌─────────────────────────────────────────┐
│ ┌─────────────┐  ┌─────────────────────┐│
│ │  3D-фигура  │  │      Ассет          ││
│ │  (octahedron│  │      (изображение)  ││
│ │   /icosa)   │  │                     ││
│ └─────────────┘  └─────────────────────┘│
│           [точки навигации]             │
└─────────────────────────────────────────┘
```

- **CSS-класс:** `.story-screen` (ранее `.narrative-screen`)
- **Содержит:** shape-area (3D) + asset-area + dots + label
- **Варианты:** Chladni-эффект для VSTablishment

#### Состояния окна Story

| Состояние | Кнопки | Название | Описание |
|-----------|--------|----------|----------|
| **Шаг 0 (свёрнутое)** | Только "Вперед" | Скрыто | Навигационный режим, 3D-фигура видна |
| **Шаг 1+ (свёрнутое)** | Назад, Вперед, Развернуть | Скрыто | Можно развернуть |
| **Развёрнутое** | Назад, Вперед, Свернуть (×) | "Story" | Режим повествования |

**Правила:**
- Переход на шаг 0 = автосворачивание
- Кнопка "Развернуть" (+) меняется на "Свернуть" (×) при разворачивании
- Название "Story" появляется только в развёрнутом состоянии

**Источник:** `bindNarrativeScreen()` в `visitor.js`

#### 3D-фигуры в Story

| Страница | Фигура | Название | Статус |
|----------|--------|----------|--------|
| **Characters** | Икосаэдр | `icosa` | ✅ Утверждено |
| **Domains** | Куб | `cube` | ✅ Утверждено |
| **Vova (Character)** | Октаэдр | `octa` | ✅ Утверждено |
| Universe | Октаэдр | `octa` | ⏳ Временно |
| Cryptocosm | Октаэдр | `octa` | ⏳ Временно |
| Workbench | Октаэдр | `octa` | ⏳ Временно |
| Collab | Октаэдр | `octa` | ⏳ Временно |
| Domain | Октаэдр | `octa` | ⏳ Временно |

**Источник:** `initMiniShape()` в `visitor.js`

### Блок 3: Widget Groups — Навигационные (widget-groups-row)

```
┌─────────────────────────────────────────┐
│ ДОМЕНЫ        ВОРКБЕНЧИ       КОЛЛАБЫ   │
│ ⚫ ⚫ ⚫        ⚫ ⚫            ⚫ ⚫       │  ← Круглые виджеты
└─────────────────────────────────────────┘
```

- **CSS-класс:** `.widget-groups-row`
- **Содержит:** `.widget-group` с `.section-title` (T1) + круглые виджеты
- **Отступы:** `--panel-inset` между группами, `--panel-inset-widgets` между виджетами

### Блок 4: Widget Groups — Окон (только Workbench)

```
┌─────────────────────────────────────────┐
│ SLATE         STORAGE        SANCTUM    │
│ ⬛             ⬛              ⬛         │  ← Квадратные виджеты
└─────────────────────────────────────────┘
```

- **CSS-класс:** `.widget-windows-row`
- **Содержит:** виджеты вызова дополнительных окон
- **Только для:** страниц воркбенчей

### Вертикальная разметка виджетов (зацементировано)

Унифицированные отступы для всех групп виджетов:

| От | До | Отступ | CSS-переменная |
|----|-----|--------|----------------|
| Story | Названия групп | 12px | `--panel-inset-inner` |
| Названия | Виджеты | 10px | `calc(--panel-inset - 6px)` |
| Между группами | — | 16px | `--panel-inset` |
| Между виджетами в группе | — | 4px | `--panel-inset-widgets` |

**Применяется к:**
- `.widget-groups-row` (навигационные виджеты)
- `.widget-windows-row` (виджеты окон)

**Источник:** `visitor.css` → комментарии "ВИДЖЕТЫ ОКОН"

### Применение по типам страниц

| Тип | Блок 1 | Блок 2 | Блок 3 | Блок 4 |
|-----|--------|--------|--------|--------|
| **Character** | ✅ | ✅ Story | ✅ domains, workbenches, collabs | ❌ |
| **Workbench** | ✅ | ✅ Story/Chladni | ✅ навигационные | ✅ Slate, Storage, Sanctum |
| **Collab** | ✅ | ✅ Story | ❌ | ⏳ (возможно позже) |
| **Domain** | ✅ | ✅ Story | ✅ characters, practices | ❌ |
| **Hub** | ✅ | ❌ 3D-фигура (2x) | ✅ characters/domains | ❌ |
| **Root** | ✅ | ✅ Story | ✅ hubs, roots | ❌ |

#### Особенности страниц хабов

Хабы (Characters, Domains) — **транспортные узлы** без повествования:
- **НЕ содержат окно Story** — нечего рассказывать
- Вместо Story показывается **увеличенная 3D-фигура** (2x от стандартного размера)
- CSS-класс: `.hub-shape-container` (высота 440px)
- Функция: `updateStoryWithHub()` в `visitor.js`

### Таблица соответствия имён и подсказок (tooltips)

| Node ID | Tooltip (hover) | Секция виджетов | Примечание |
|---------|-----------------|-----------------|------------|
| `characters` | Characters | — (без заголовка) | Hub |
| `domains` | Domains | Домены | Hub |
| `universe` | Universe | — | Root |
| `cryptocosm` | Cryptocosm | — | Root |

**Источник:** `VISUAL_CONFIG.nodeTypes.hub.tooltipById` в `visual/config.js`

---

## Scope Highlight (Подсветка корневого виджета)

**Правило (зацементировано):**

При hover на корневой виджет (`.vova-scope-widget`) подсвечивается **СУММА** подсветок всех виджетов на странице:

1. Все узлы виджетов + их соседи в графе
2. Все рёбра, связанные с этими узлами
3. Все вершины 3D-фигуры
4. Все рамки виджетов (`.widget-scope-highlighted`)

### Применение

| Страница | Scope Highlight |
|----------|-----------------|
| Character | ✅ |
| Workbench | ✅ |
| Collab | ✅ |
| Domain | ✅ |
| Hub | ✅ |
| Root | ✅ |

### Реализация

| Компонент | Файл | Функция |
|-----------|------|---------|
| Привязка событий | `visitor.js` | `bindVovaScopeWidget()` |
| Сбор nodeIds | `visitor.js` | `HighlightManager.scope()` |
| Вычисление подсветки | `highlightModel.js` | `applyScope()` |

**Источник:** Комментарии в `visitor.js` → "SCOPE HIGHLIGHT"

---

## Цветовая палитра

### Основные цвета

| Переменная | Значение | Назначение |
|------------|----------|------------|
| `--accent-cyan` | `#22d3ee` | Основной акцент (semi-active, hover, borders) |
| `--accent-yellow` | `#fbbf24` | Активный акцент (active, selected) |
| `--panel-bg` | `rgba(8, 12, 20, 0.88)` | Фон панелей |
| `--panel-border` | `rgba(34, 211, 238, 0.35)` | Границы панелей |
| `--panel-border-thick` | `rgba(34, 211, 238, 0.6)` | Толстые границы (hover) |
| `--panel-glow` | `rgba(34, 211, 238, 0.12)` | Свечение панелей |

### Текстовые цвета

| Переменная | Значение | Назначение |
|------------|----------|------------|
| `--text-primary` | `#e0e8f0` | Основной текст |
| `--text-secondary` | `#8899aa` | Вторичный текст |
| `--text-muted` | `#556677` | Приглушённый текст |

### Семантические цвета (UI states)

| Переменная | Значение | Назначение |
|------------|----------|------------|
| `--color-semi-active` | `#22d3ee` | Полуактивное состояние (hover) |
| `--color-semi-active-soft` | `rgba(34, 211, 238, 0.15)` | Мягкий фон semi-active |
| `--color-active` | `#fbbf24` | Активное состояние (selected) |
| `--color-active-soft` | `rgba(251, 191, 36, 0.2)` | Мягкий фон active |
| `--color-active-glow` | `rgba(251, 191, 36, 0.25)` | Свечение active |

### Фоны

| Контекст | Значение |
|----------|----------|
| Body background | `#050608` |
| Graph background | Transparent (3D scene) |

---

## Типографика

### Шрифты

| Переменная | Значение | Назначение |
|------------|----------|------------|
| `--font-tech` | `'Orbitron', monospace` | Заголовки, labels, технический текст |
| `--font-body` | `Tahoma, sans-serif` | Основной текст, описания (системный шрифт, хорошая кириллица) |

### Типографическая шкала (T1-T6)

| Код | Название | Применение |
|-----|----------|------------|
| **T1** | Widget Group Titles | Названия групп виджетов и виджетов окон |
| **T2** | Node Header Info | 3 строки справа от корневого виджета |
| **T3** | Panel Headers | Scope, Storage, System, Service |
| T4 | *(зарезервировано)* | — |
| T5 | *(зарезервировано)* | — |
| T6 | *(зарезервировано)* | — |

### T1: Widget Group Titles

```css
--typo-t1-font: monospace;             /* Унифицированный для кириллицы и латиницы */
--typo-t1-size: 11px;
--typo-t1-transform: uppercase;
--typo-t1-spacing: 0.1em;
--typo-t1-color: var(--text-secondary); /* #8899aa */
```

**Используется в:** `.section-title`

**Примеры:**
- Навигационные группы: ДОМЕНЫ, ВОРКБЕНЧИ, КОЛЛАБЫ, ХАБЫ, КОРЕНЬ
- Виджеты окон: SLATE, STORAGE, SANCTUM

**Примечание:** Используем `monospace` вместо `Orbitron`, т.к. Orbitron не поддерживает кириллицу.

### T2: Node Header Info

```css
--typo-t2-font: var(--font-body);       /* Tahoma */
--typo-t2-size: 13px;
--typo-t2-line-height: 1;
--typo-t2-color: rgba(224, 232, 240, 0.75);
```

**Используется в:** `.vova-root-info`

**Принцип выравнивания:**
- Строки привязаны к верхней границе виджета
- `justify-content: flex-start` + `gap: 4px`
- Фиксированное расстояние между строками
- Нижняя граница — произвольная

### T3: Panel Headers

```css
--typo-t3-font: var(--font-tech);       /* Orbitron */
--typo-t3-size: 11px;
--typo-t3-transform: uppercase;
--typo-t3-spacing: 0.15em;
--typo-t3-color: var(--accent-cyan);    /* #22d3ee */
--typo-t3-opacity: 0.7;
```

**Используется в:** `.panel-3s .panel-header`

### Размеры шрифтов (legacy)

| Элемент | Размер | Шрифт | Код |
|---------|--------|-------|-----|
| Body | `15px` | `--font-body` | — |
| Panel header | `11px` | `--font-tech` | **T3** |
| Section title | `11px` | `--font-tech` | **T1** |
| Node info | `13px` | `--font-body` | **T2** |
| Narrative title | `12px` | `--font-tech` | — |
| Narrative detail | `13px` | `--font-body` | — |

### Стили текста

| Элемент | Стиль |
|---------|-------|
| Panel header | `uppercase`, `letter-spacing: 0.15em` |
| Section title (T1) | `uppercase`, `letter-spacing: 0.1em` |
| Body text | `letter-spacing: 0.02em` |

---

## Система отступов

### !CRITICAL: Единые переменные

```css
:root {
  --panel-inset: 16px;        /* Края большого окна, вертикальные отступы, между группами виджетов */
  --panel-inset-inner: 12px;  /* Края мини-окна, виджет→текст */
  --panel-inset-dots: 6px;    /* Расстояние между точками */
  --panel-inset-widgets: 4px; /* Расстояние между виджетами в группе */
}
```

### Применение отступов

| Контекст | Переменная | Значение |
|----------|------------|----------|
| Padding панели (header) | `--panel-inset` | 16px |
| Padding панели (content) | `0 --panel-inset --panel-inset` | 0 16px 16px |
| Gap между элементами content | `--panel-inset` | 16px |
| Края мини-окна (HUD) | `--panel-inset-inner` | 12px |
| Виджет → текст | `--panel-inset-inner` | 12px |
| Между группами виджетов | `--panel-inset` | 16px |
| Между виджетами в группе | `--panel-inset-widgets` | 4px |
| Между точками | `--panel-inset-dots` | 6px |

### Компенсация анимации

```css
.widget-group {
  gap: calc(var(--panel-inset) - 6px); /* 10px — компенсация подпрыгивания виджетов */
}
```

---

## Размеры элементов

### Виджеты

| Элемент | Размер |
|---------|--------|
| `.widget-frame` | `52px × 52px` |
| `.node-widget` padding | `2px` |
| Итого виджет | `56px × 56px` |
| `.node-toc` height | `56px` (фиксированная) |

### Точки (dots)

| Элемент | Размер |
|---------|--------|
| `.scene-dot` | `14px × 14px` |
| `.narrative-dot` | `14px × 14px` |

### Мини-окно (narrative-screen)

| Свойство | Значение |
|----------|----------|
| Aspect ratio | `16:9` (padding-top: 56.25%) |
| Border radius | `16px` |
| Border | `1px solid var(--panel-border)` |

---

## Механики интерфейса

### Hover-эффекты

| Элемент | Эффект |
|---------|--------|
| Панель | `opacity: 1`, другие панели `opacity: 0.5` |
| Виджет | `animation: widget-bounce 0.28s` (translateY -6px) |
| Мини-окно | `border-color: var(--accent-cyan)`, `box-shadow: 0 0 16px var(--panel-glow)` |
| Точка | `background: var(--accent-cyan)` |

### Анимации

```css
@keyframes widget-bounce {
  0%   { transform: translateY(0); }
  55%  { transform: translateY(-6px); }
  100% { transform: translateY(0); }
}
```

### Состояния виджетов

| Состояние | Визуал |
|-----------|--------|
| Default | Border: `rgba(34, 211, 238, 0.2)` |
| Hover | Border: `var(--accent-cyan)`, bounce animation |
| Semi-active | Border: `var(--color-semi-active)`, glow |
| Active | Border: `var(--color-active)`, yellow glow |

### Панели при hover

| Состояние | Активная панель | Неактивные панели |
|-----------|-----------------|-------------------|
| transform | `scale(1.02)` | `scale(1)` — НЕ УМЕНЬШАЮТСЯ |
| opacity | `1` | `0.5` |
| z-index | `12` | — |

---

## Шаблоны страниц

### Шаблон "Персонаж" (character)

Структура:
1. **Корневой виджет** + информация (3 строки)
2. **Мини-окно** (narrative-screen) с октаэдром
3. **Группы виджетов** (Домены, Воркбенчи, Коллабы)

Октаэдр:
- Количество шаров = количество виджетов на странице
- Максимум 6 шаров для октаэдра
- Вращается автоматически

### Шаблон "Воркбенч" (workbench)

Зависит от типа воркбенча:
- **VSTablishment**: Chladni-эффект + виджеты-флаги (6 шт.)
- **Другие**: narrative-screen + виджеты

---

## CSS файлы

| Файл | Назначение |
|------|------------|
| `render/src/scenes/visitor.css` | Основные стили Visitor Scene |
| `render/src/style.css` | Глобальные стили, точки |

### Критические правила

Помечены комментарием `/* !CRITICAL */` — не изменять без согласования.

---

## Механика орбит VSTablishment — УТВЕРЖДЕНО ✅

**Статус:** `!STABLE` — НЕ ТРОГАТЬ без согласования  
**Дата утверждения:** 21 февраля 2026  
**Файлы:**
- `render/src/effects/NodeOrbits.js` — логика орбит
- `render/src/scenes/visitor.js` — интеграция (функции `*VSTablishmentOrbit*`)
- `render/src/scenes/visitor.css` — стили `.widget-window--hover-from-orbit`

### Описание

Три орбиты с спутниками вокруг узла VSTablishment в 3D-графе. Каждый спутник соответствует виджету окна (Slate, Storage, Sanctum).

### Визуальная схема

```
        ┌─────────────────────────────────────┐
        │           SANCTUM (внешняя)          │
        │    ┌───────────────────────────┐    │
        │    │      STORAGE (средняя)     │    │
        │    │    ┌─────────────────┐    │    │
        │    │    │  SLATE (внутр.) │    │    │
        │    │    │    ● VSTabl.    │    │    │
        │    │    │       ○         │    │    │  ← Спутники
        │    │    └─────────────────┘    │    │
        │    │            ○              │    │
        │    └───────────────────────────┘    │
        │                  ○                   │
        └─────────────────────────────────────┘
```

### Состояния спутников

| Состояние | Цвет | Размер | Условие |
|-----------|------|--------|---------|
| **Обычное** | Голубой `#22d3ee` | 1.0x | По умолчанию |
| **Hover** | Жёлтый `#fbbf24` | 1.4x | Hover на виджет ИЛИ на спутник |
| **Active** | Жёлтый `#fbbf24` | 1.4x | Панель открыта |

### Двусторонняя связь виджет ↔ спутник

| Действие | Эффект на виджет | Эффект на спутник |
|----------|------------------|-------------------|
| **Hover на виджет** | Bounce + жёлтая рамка + подмена лого | Жёлтый + увеличение |
| **Hover на спутник** | Bounce + жёлтая рамка + подмена лого | Жёлтый + увеличение |
| **Click на виджет** | Голубая рамка (active) | Жёлтый (остаётся) + поле орбиты |
| **Click на спутник** | Голубая рамка (active) | Жёлтый (остаётся) + поле орбиты |

### Поля орбит (при клике)

| Виджет | Поле | Описание |
|--------|------|----------|
| **Slate** | Диск | От центра до первой орбиты |
| **Storage** | Кольцо | От первой до второй орбиты |
| **Sanctum** | Кольцо | От второй до третьей орбиты |

### Ключевые функции (visitor.js)

```javascript
createVSTablishmentOrbits()      // Создание орбит при переходе на VSTablishment
destroyVSTablishmentOrbits()     // Уничтожение при уходе со страницы
highlightVSTablishmentOrbit()    // Подсветка при hover
clearVSTablishmentOrbitHighlight() // Сброс подсветки
activateVSTablishmentOrbit()     // Активация при клике (поле + жёлтый)
deactivateVSTablishmentOrbit()   // Деактивация при закрытии панели
setupOrbitSatelliteInteraction() // Raycasting для взаимодействия со спутниками
```

### Параметры орбит (NodeOrbits.js)

```javascript
ORBIT_CONFIG = {
  slate:   { radius: 12, speed: 0.3,  satelliteSize: 1.2 },
  storage: { radius: 18, speed: 0.25, satelliteSize: 1.2 },
  sanctum: { radius: 24, speed: 0.2,  satelliteSize: 1.2 }
}
```

---

## Связанные документы

- `docs/windows.md` — структура окон и мостов
- `docs/ARCHITECTURE_TRACKS.md` — Track 4: Projection/UI
- `docs/CHLADNI_CONCEPT.md` — Chladni-эффект для VSTablishment
